[{"title":"旅行的意义是什么?","url":"/2022/02/15/旅行的意义是什么/","content":"喜欢独自旅行，“在路上”已成为一种生活姿态。\n\n经常被问到“旅行的意义是什么”，想想在人生不同阶段，答案也有所不同。\n旅行，一开始是出于炫耀，当在每一个到过的地方贴上“到此一游”的标签后，也就有了不甘人后的底气，有了谈资，继而增添了履历，满足了虚荣心，这是一种眼睛的旅行。  \n***\n<!--more-->\n\n后来是为了学习。“读万卷书，行万里路。”读书是一种纸上的旅行，旅行是一种路上的读书，谁都无法代替谁，当用开放心态去触摸未知世界时，生活会变得充实而灵动，这是一种头脑的旅行。\n再后来发现，旅行就是旅行，自有独特价值。于行者而言，星辰与大海既是初心，也是终点；既在路上，也在当下；既是远方，也是家园；这是一种心灵的旅行。 \n***\n> “旅人叩过每个陌生人的门/才找到自己的家/人只有在外面四处漂泊/才能到达内心最深的殿堂。” ------泰戈尔\n***\n\n一路走来，欣赏过那么多壮丽的景色，了解过那么多奇特的风情，接触过那么多陌生的脸孔，发生过那么多感人的故事，历经过那么多艰苦的磨练，不为炫耀，不为猎奇，更非走向虚无，而是更加认识自己。 路上是一个不断怀疑、否定、推翻、重建与求证的过程，一个忍受痛苦与挣扎的蜕变与重生的过程，一个不断告别过去、享受当下与寻找未来的过程。\n\n\n如果风景与经历没有刻在心上，没有在远行中成长，那走得再远，也只是邮差。 “一个人的行走范围,就是他的世界。”当反思生活中的种种成败得失时，也许远行中曾经流连的一处风景、一个细节、一种心态就会涌上心头，让思考更宽广、更扎实，让人生选择时有丰富的可能性，而不会被眼前的世界所局限。\n\n\n旅行的意义并不在于一个个具体的世俗目的，但事实上旅行的“名利”价值无处不在，而且是构建人生坐标的基石。 知乎上有个高赞的问答：“我读过很多书，但后来大部分都忘记了，你说这样的阅读究竟有什么意义？”“当我还是个孩子时，我吃过很多食物，现在已经记不起来吃过什么了。但可以肯定的是，它们中的一部分已经长成我的骨头和肉。”读书如此，旅行亦如此。   \n旅行是一场感动，一场旅心，一场修行。走出去是为了走回来，只有清楚世界的方位，才能找到自身的定位。  \n当跋涉过岁月与山河，挣扎过月亮与六便士，旅行成为身体和灵魂的一部分后，你会发现自己想要什么样的风景，什么样的生活，继而找到一条适合自己的路，找到自己最舒服的状态。那时，你已找到归途，找到自我，找到心安之家了；那时，你已懂得善待自己，成全自己，成为自己了。\n\n***"},{"title":"2021的尾声—My Lonely Moment","url":"/2022/01/31/2021的尾声—My-Lonely-Moment/","content":"在 2021 的最后，独自一人   \n窗外弥漫的雾气   \n一瞬，又一瞬  \n“之后能做什么呢”  \n转身，  \n光芒涌现  \n\n---\n<!--more-->\n\n\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: '4d215f84a8d12d66',\n    autoPlay: false\n});\n</script>"},{"title":"柯达克罗姆彩色反转片的冲洗（转）","url":"/2021/10/29/柯达克罗姆彩色反转片的冲洗（转）/","content":"# 关于柯达克罗姆彩色反转片的概况\n\n柯达公司从1936年开始生产外式法柯达克罗姆色彩反转片，目前共生产三个品种，即：柯达克罗姆25、柯达克罗姆40和柯达克罗姆64。25型和64型是日光型，40型是灯光片。\n柯达克罗姆彩色反转片的感光度都比较低，25型为ASA25,40型为ASA40，64型为ASA64。它们的共同特点是颗粒细、清晰度高和色彩还原好，主要供作为幻灯片使用。\n柯达克罗姆胶片的冲洗工艺代号为K14，但原厂既不不公布配方，也不供应成药，只能寄回原厂或原厂指定的代理公司冲洗。\n***\n<!--more-->\n* * *\n\n# 柯达克罗姆彩色胶片的构造\n\n柯达克罗姆彩色胶片的构造与一般多层彩色胶片没有根本的区别，其基本结构如下\n## 结构\n\n| | |\n|---|---|\n| 1 | 感蓝光乳剂层 |\n| 2 | 黄滤色层 |\n| 3 | 感绿光乳剂层 |\n| 4 | 感红光乳剂层 |\n| 5 | 片基 |\n| 6 | 防光晕层 |\n\n柯达克罗姆胶片也是在醋酸纤维片基上依次涂布着感蓝光乳剂层、黄滤色层、感绿光乳剂层和感红光乳剂层，片基的背面涂有碳黑的防光晕层。但是它在蓝、绿、红三层乳剂中含有丙烯酸乙酯和丙烯酸的共聚体，这样一方面可以取消明胶间的隔层，另一方面可以提高在显影过程中外式法彩色显影的上色率，同时也可以防止颜色穿层的现象。  \n\n# 外式法色彩显影的工艺过程：\n\n柯达克罗姆胶片，实际上是一种黑白分色多层乳剂的感光材料，在乳剂中并不含有成色剂。  \n经过拍摄曝光在红、绿、蓝三个感光层产生潜影，在冲洗的时候，首先和一般反转片一样，要进行首次黑白显影，把三层感光层的潜影全部还原为金属银的负像。  \n然后把各层残留着的未曝光的卤化银再进行分层曝光和分层彩色显影，这就和一般的反转片不同了。\n1. 先把胶片背面（即片基面）对着红光进行反转曝光，接着进行青色彩显，使感红层获得青色正像\n2. 再把胶片的乳剂面（即上层）对着蓝光进行反转曝光，接着进行黄色彩显，使感蓝层得到黄色正像\n3. 然后对中间感绿层用绿光进行反转曝光\n4. 接着进行品红色彩显\n5. 最后再经漂白、定影、水洗等过程  \n即获得与被摄景物颜色相同的彩色正像。\n在进行外式法彩色显影时，可以根据成色剂的特性来调整显影液的配方，有时也可以更换彩色显影剂，用于调整色彩还原和提高胶片的上色率。\n\n# 外式法彩色显影的成色剂：\n\n冲洗加工柯达克罗姆，由于胶片乳剂不含有成色剂，必须用外式法进行彩色显影，因此对成色剂的选择特别重要，它直接影响彩色还原质量和色彩平衡。通过试验我们进一步体会到，对黄、品红、青三种成色剂的要求是十分严格的，有以下一些特点：\n1. 彩色画面上所生成黄、品红、青三种染料的光谱特性应与胶片所具有的蓝、绿、红乳剂的感光特性相适应。  \n2. 在彩色显影过程中，成色剂的上色率要高，但彩色灰雾要较低。   \n3. 在彩色显影过程中，彩色影像应与银影像相符合，不能产生染料的扩散与渗透现象。  \n4. 在冲洗加工过程中，应能经过得住酸、碱、醛等溶液的处理，而不致变色或褪色。  \n5. 成色剂应能溶解于有机溶剂和氢氧化钠溶液中，也能溶解于彩色显影液中而不会产生沉淀。  \n\n\n# 冲洗工艺过程\n| | 工序 | 温度（℃）| 时间（min）|\n|---|---|---|---|\n| 1 | 预坚膜 | 24 | 3 |\n| 2 | 水洗 | 20～24 | 0.5 |\n|3| 首显  |       24    |                    4|\n|4  |停显|         22～24     |           3|\n|5  |水洗      |   20～24   |             10|\n|6 | 红光曝光|\n|7 | 青显影  |   24        |                10|\n|8  |黑白显影|  22～24   |             2|\n|9 | 停显  |       22～24   |             2|\n|10| 水洗 |       20～24     |          10|\n|11 |蓝光曝光|\n|12 |黄显影|     24    |                  14|\n|13 |黑白显影 |22～24  |             2|\n|14| 停影 |       22～24    |           2|\n|15| 水洗    |    20～24    |          10|\n|16 |绿光曝光|\n|17| 品红显影| 24  |                    10|\n|18 |停影       | 22～24    |           2|\n|19| 水洗 |       20～24    |          10|\n|20 |漂白 |       22～24 |             5|\n|21| 水洗    |    20～24     |        10|\n|22 |定影 |       22～24 |             5|\n|23 |水洗 |       20～24  |           10|\n|24 |稳定 |       22～24 |             1|\n|25| 干燥|\n\n## 〖注〗\n### 红曝光：\n必须选用与胶片感色性相对应的红滤色镜（或滤色片）对红感光层进行反转曝光，红感光层是涂布在底层，即片基之上，所以，红曝光时，须将胶片片基面对着红光源。  \n我们使用的红滤镜是`柯达雷登70号`，将红色滤色镜装在彩色放大机的滤色镜夹具中，插入光源前，把放大机镜头光圈全部打开，将红光投影在黑纸上以防反光，然后将柯达克罗姆胶片平放在投影台上，放大机镜头距胶片0.5米，打开光源后对胶片进行分段曝光，`每段曝光5分钟`，这些都是在暗室中进行。  \n对于滤色镜的选择是十分重要的，这主要取决于他的波长和光谱透光特性，如果要改换滤色镜，需通过试验效果后确定。\n\n### 青彩色显影：\n胶片红曝光后，装入显影罐中，然后将青成色剂溶解加入显影液中，调好温度，胶片进行青彩显，在`温度24摄氏度下显影10分钟`。  \n为了全部地还原底层乳剂中的卤化银，在青色显影之后，须再用黑白显影液进行补充显影。  \n同时为了控制、调整青色画面密度，还可以根据情况在青彩显液中加入适当的黑白显影剂，如米吐尔溶液，一般我们在1000毫升青显影液内加入1%的米吐尔溶液5-10毫升，这对青色密度的影响效果显著。  \n#### 对青显影的要求是：  \n应控制青色密度、灰雾和反差，因为青色显影效果，它也会影响后面黄显影与品红显影密度的上色率，如果青色灰雾大，会造成色彩不平衡。  \n`对于青显影液最好是配好就用，用多少配多少，用后即倒掉，以保证药液稳定。`\n\n### 黑白显影：\n这次黑白显影的作用主要是为了全部地还原底层乳剂中青显影后剩余的卤化银进行补充显影。\n\n### 蓝曝光：\n柯达克罗姆胶片的蓝感光层是在胶片的上层，因此要把胶片乳剂面对着蓝光进行反转曝光，要注意蓝滤色镜的选择，对于它的波长和光谱透光特性应十分严格，以防止穿层现象。  \n我们使用的滤色镜是`柯达雷登47B`。蓝曝光操作方法和红曝光一样，只是胶片乳剂面向上，对准蓝光源，也是采用分段曝光，在暗室中进行。\n\n### 黄彩色显影：\n胶片蓝曝光后，装入显影罐中，然后将黄色成色剂按照配制黄显影液要求溶解后加入显影液中，调好温度后，胶片进入黄彩色显影，在`温度24摄氏度`下，`显影14分钟`。  \n#### 对黄显影的要求是：\n黄上色率要高，灰雾要小。选用的黄色成色剂经显影后，画面里的黄色中不能有带有红色，黄色透明度要好。  \n`黄显影液也是随配好随用，用多少配多少，使用后即倒掉，以保证冲洗质量。`\n\n### 黑白显影：\n黄显影后，随即进行黑白补充显影，使黄乳剂层中已曝光而未显影的残余卤化银全部还原成金属银，以防止在品红灰雾显影时影响品红的上色率和增加灰雾。\n\n\n### 品红灰雾显影：\n显影液中加入品红成色剂后再加入适当的灰雾剂，使乳剂中的银盐全部灰化，进行显影还原。  \n同时为了控制品红画面密度，也可以根据情况在品红彩色显影液中加入适当的黑白显影液，如米吐尔溶液，一般我们在1000毫升品红显影液内加入1%的米吐尔溶液3-5毫升，即可控制品红密度。\n\n# 配方\n\n## 预坚液 PH值9\n\n| | |\n|---|---|\n|水 | 800毫升 |\n|亚硫酸氢钠 | 1克 |\n|四硼酸钠 |  20克 |\n|甲醛 | 20毫升 |\n|无水硫酸钠 |  100克 |\n|溴化钾  | 1克 |\n|加水至1000毫升| |\n\n## 首显液 PH值10.5\n\n| | |\n|---|---|\n| 水              |  800毫升 |\n| 米吐尔             | 4克 |\n| 无水亚硫酸钠      | 50克 |\n| 海得尔（对苯二酚）              | 4克 |\n| 无水碳酸钠       | 30克 |\n| 氢氧化钠          | 1克 |\n| 硫氰酸钾        | 1克 |\n| 溴化钾          | 3克 |\n| 六硝基苯并咪唑1% | 5毫升 |\n| 加水至1000毫升|  |\n\n## 停显液\n\n| | |\n|---|---|\n|水                           | 800毫升 |\n|98%醋酸              |   20毫升 |\n|加水至1000毫升 | |\n\n## 青彩色显影液 PH值11.3\n\n| | |\n|---|---|\n|水                          |   600毫升 |\n|无水亚硫酸钠          | 10克 |\n|磷酸钠                     | 25克 |\n|盐酸羟胺               |  1克 |\n|溴化钾                   |  1克 |\n|六硝基苯并咪唑1%|  10毫升 |\n|CD-2                     |  2克 |\n|加水至800毫升 | |\n### 〖注〗  \n在使用前取青成色剂1克，溶解于10%含有氢氧化钠溶液的20毫升中，成色剂完全溶解后加入上述显影液中，然后将显影液加水至1000毫升，胶片经红曝光后，即可进行青显影。  \n其中CD-2化学成分名称为：2-氨基-5-二乙基氨基甲苯盐酸盐。\n\n## 黄彩色显影液 PH值11.5\n\n| | |\n|---|---|\n|水                         |   600毫升 |\n|无水亚硫酸钠          |  5克 |\n|磷酸钠                    |  25克 |\n|氢氧化钠                |  2克 |\n|溴化钾                  |   2克 |\n|盐酸羟胺              |    0.5克 |\n|六硝基苯并咪唑1%  | 10毫升 |\n|TSS                       |  2.8克 |\n|加水至800毫升 | |\n\n\n### 〖注〗  \n在使用前取黄色成色剂1.2克，用20毫升丙酮溶液溶解黄成色剂，完全溶解后再加入上述显影液中，然后将显影液加水至1000毫升。  \n胶片经蓝曝光后，即可进行黄显影。  \n其中TSS化学成分名称为：对氨基二乙基苯胺硫酸盐。\n\n## 黑白显影液：\n\n| | |\n|---|---|\n|水                        |   700毫升 |\n|米吐尔                |    3克 |\n|无水亚硫酸钠   |       45克 |\n|海得尔（对苯二酚）                |    12克 |\n|无水碳酸钠       |      60克 |\n|溴化钾               |     2克 |\n|加水至1000毫升 | |\n\n### 〖注〗\n使用时一份药液加一份水冲淡后显影，即1：1。\n\n## 品红彩色显影液 PH值11.75\n\n| | |\n|---|---|\n|水      |                     800毫升|\n|无水亚硫酸钠    |      4克|\n|TSS          |              4克|\n|氢氧化钠        |         1克|\n|一水合氨      |           8毫升|\n|对硝基苯乙腈      |    1克|\n|加水至1000毫升 |\n\n### 〖注〗  \n品红彩显液配方法：    \n配方中除成色剂及灰雾剂（氢氧化胺），其他药品可先溶解配成储备液。在使用前将对硝基苯乙腈（品红成色剂）1克放入20毫升丙酮溶液和10毫升乙醇溶解中溶解，然后再加上上述显影液中，将水加至1000毫升，待其它准备工作完成后（如调好显影液温度等），胶片进入品红显影前再加入氢氧化胺8毫升（灰雾剂），此时，立即将胶片进行品红显影。  \n其中TSS化学成分名称为：对氨基二乙基苯胺硫酸盐。\n\n## 漂白液 PH值6.9\n\n| | |\n|---|---|\n|水     |                     800毫升|\n|铁氰化钾      |          50克|\n|溴化钾         |          10克|\n|加水至1000毫升| |\n\n## 定影液 PH值8.5\n\n| | |\n|---|---|\n|水    |                     700毫升|\n|海波     |                 200克|\n|无水亚硫酸钠   |    10克|\n|加水至1000毫升| |\n\n## 稳定液\n\n| | |\n|---|---|\n|水       |                    800毫升|\n|皂角素（湿润剂）|  1克|\n|甲醛              |         10毫升|\n|加水至1000毫升| |\n\n\n# 样片\n[Kelly-Shane Fuller](https://www.flickr.com/people/54110121@N02/#)  \n[Paweł Pająk](https://www.flickr.com/photos/doctorspider/)\n\n# PDF\n<details markdown='1'><summary>展开/收起</summary>\n{% pdf https://ntsc.rec709.cf:2083/Documents/z50_03.pdf %}\n</details>\n"},{"title":"提升Intel 4代处理器性能锁定全核倍频","url":"/2021/09/20/enhance_haswell/","content":"Z系列可以直接解锁全核倍频。对于B和H系列，如果你的主板BIOS选项中有 （CPU倍频 all core），也可以解锁全核倍频\n<!-- more -->\n* * *\n# 工具\n1. 主板BIOS（2015年3月左右或者官方超频BIOS)\n2. [UEFI Tool](https://github.com/wanghurui/whrblog/releases/tag/Blog)\n\n# 替换BIOS中的微码\n运行`UEFI.BIOS.Updater.1.66 `文件夹中的`ubu.bat`。`ubu.bat`可以自己识别文件夹中的BIOS文件，如果没有自动识别，提示载入一个文件，选择bios文件即可。\n## 更新CPU微码\n\n![image.png](https://i.loli.net/2021/09/20/oMhPRSwUak18Ocn.png)\n\n## 更新HasWell架构微码\n输入7回车，更新CPU微码\n\n![image.png](https://i.loli.net/2021/09/20/nb7tU8vcVZ5G61M.png)  \n输入1回车，更新HasWell架构微码\n![image.png](https://i.loli.net/2021/09/20/bgHBlJXjqrQn5o2.png)  \n## 解锁HasWell限制\n输入7回车，解锁HasWell限制\n![image.png](https://i.loli.net/2021/09/20/d34Ho7UmFQchx8G.png)  \n![image.png](https://i.loli.net/2021/09/20/31oLk86umDrlOwW.png)    \n\n输入0回车，完成BIOS编辑  \n输入1回车，将新BIOS保存到当前目录\n输入任意键结束程序，程序目录下便有最新的BIOS了\n\n\n# 刷写BIOS\n把它放入_FAT32_格式U盘根目录中  \n详细刷写BIOS请参考主板官网的帮助\n\n# 设置BIOS为all core\n\ncpu倍频必须必须选择所有内核（all core），否则解锁无效。在All core 填入你的CPU单核最大频率即可。如E3 1231V3 单核最大倍频为38  \n\n保存退出重启电脑即可\n\n----\n如果你打开电脑，打开CPUZ发现所有核心都运行在了最高倍频，那么恭喜，你锁住了。🎉\n\n如果没有，请继续往下看。\n\n# Oops！我没锁住🤔\n> Make a screenshot of `regedit` with expanded key `HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0`  \n\n> ![image.png](https://i.loli.net/2021/07/20/Mo9ZYUlrVO5cPWI.png)\n\n> Your BIOS has microcode with `0x06` version, but Windows update it to `0x28` version.\nDelete or rename file `C:\\Windows\\System32\\mcupdate_GenuineIntel.dll`\n\n[https://www.bios-mods.com/forum/Thread-Biostar-B85W-CPU-frequency-problem](https://www.bios-mods.com/forum/Thread-Biostar-B85W-CPU-frequency-problem)\n\n大意就是我修改了BIOS中的微码为`0x06`，但是系统把微码更新成了`0x28`。  \n### 删除系统微码\n\n在PE中删除或重命名系统微码文件`C:\\Windows\\System32\\mcupdate_GenuineIntel.dll`\n\n![image.png](https://i.loli.net/2021/07/20/3BbGqs95YDdMVIj.png)  \n还是锁不住🤔\n\n### 使用ThottleStop锁倍频\n> Show FIVR and TPL information in ThrottleStop.\n\n![image.png](https://i.loli.net/2021/07/21/mzlWRBYjx3sKS9F.png)  \n设置ThottleStop中的FIVR的Turbo Ratio Limits为CPU单核最大倍频。修改即时生效。\n\n最后把ThottleStop设置为开机启动就行了\n\n----\n\n🎉如果你锁住了，可以送我一条评论吗🎉\n\n----\n\n\n参考资料\n- [https://www.bios-mods.com/forum/Thread-Biostar-B85W-CPU-frequency-problem](https://www.bios-mods.com/forum/Thread-Biostar-B85W-CPU-frequency-problem)\n- [https://zhuanlan.zhihu.com/p/54535319](https://zhuanlan.zhihu.com/p/54535319)\n- [https://www.techpowerup.com/forums/threads/how-can-i-get-throttlestop-to-auto-load-when-windows-starts-up.230371/](https://www.techpowerup.com/forums/threads/how-can-i-get-throttlestop-to-auto-load-when-windows-starts-up.230371/)"},{"title":"解读MTF曲线","url":"/2021/07/01/解读mtf曲线/","content":"\n> Modulation Transfer Function（调制传递函数）是分析镜头的解像比较科学的方法，这种测定光学频率的方式是以一个mm的范围内能呈现出多少条线来度量，其单位以line/mm来表示。所以当一支镜头能做到所入即所出的程度那就表示这支镜头是所谓的完美镜头，但是因为镜片镜头的设计往往还有很多因素影响所以不可能有这种理想化的镜头。\n<!-- more -->\n* * *\n\n1.横坐标轴代表与画面中心的距离，从左到右代表从中心到边缘的成像 （全画幅镜头的横轴约22mm，残幅镜头的横轴约13mm） 2.纵坐标轴代表MTF值 3.黑色线条表示最大光圈，蓝色线条表示f/8光圈 4.粗线表示10线/mm，细线表示30线/mm 5.实线表示拍摄从中心呈放射状纹样的成像性能，用字母“S”表示 6.虚线表示拍摄线条呈同心圆向外扩展状纹样的成像性能，用字母“M”表示   \\[caption id=\"\" align=\"aligncenter\" width=\"670\"\\][![](https://z3.ax1x.com/2021/07/01/RD2Yo4.png)](https://z3.ax1x.com/2021/07/01/RD2Yo4.png) https://www.canon.com.cn/product/ef/index/lensmtf.html\\[/caption\\]\n\n* * *\n\n1\\. MTF值越接近1越好，即MTF线越高越好 2.粗线约高，说明镜头的反差表现越好 3.细线越高，说明镜头的分辨率越好 4. MTF曲线越平坦，说明边缘和中心的成像差距越小 5.实线和虚线越接近，说明镜头的焦外成像越好 6.蓝线说明镜头f/8时的成像水平，近似于镜头的最佳成像水平 7.黑线说明镜头最大光圈时的成像水平，大光圈的价值所在","tags":["摄影"],"categories":["uncategorized"]},{"title":"Digispark模拟HID键盘控制BIOS","url":"/2021/04/05/通过digispark模拟键盘控制bios/","content":"<details markdown='1'><summary>展开/收起</summary>\n有一个穷鬼，十分喜欢折腾电脑硬件，可他的父母并不支持他的兴趣爱好，他们认为生为学生就应该心无杂念的一心想着读书。几年过去了，穷鬼的电脑开始渐渐的赶不上时代了，他看了看他的CPU，不由自主地叹了口气：“Pentium E5300…\n\n“ 在他的不懈努力之下，从[K](krunk.cn)那里抢来了一块Q6600和一块9600GT 又过了几年，又从一个不知名的仓库里拆出了一块Q9300。 \n  没过多久，他收到一个快递，拆开一看竟然是印着自己名字的GT1030，那天，是他的生日。 一年后，穷鬼上了高中，发现处理器还是差那么亿点点，他看了看自己空空荡荡的钱包，一咬牙，买了一块X5450，装CPU的那天，他心里想着，装上了这块CPU你就无敌了…… 欧耶，点亮了！ 关机。 来BIOS里超个外频。欸，🌿🌿🌿，怎么点不亮了，#￥%……他发现了一个问题，每次开机前要断电， BIOS恢复后才能开机。 🌿那岂不是保存不了超频。 在默频用了一段时间后，他突发奇想，是否可以用arduino做badusb，在开机时模拟键盘，自动设置BIOS呢？他翻出来尘封已久的arduino……\n最后选择了digispark作为badusb\n</details>\n\n# Digispark？\n\nDigispark是一款类似于Arduino Uno基于Attiny85的微控制器开发板。可用于制作Badusb设备， BadUSB是一种通过重写U盘固件伪装成USB输入设备(键盘,网卡)用于恶意用途的usb设备。杀毒软件由于无法接触到usb固件，所以对它也无可奈何  \n***\n<!--more-->\n\n# 点个灯\n\n尝试烧写一个示例程序。\n```\n//_因为此开发板有两种类型，并且这两种的LED接的引脚不一样，所以下面的代码中，同时在操作两个引脚。_\nvoid setup() {\n  pinMode(0, OUTPUT); //LED on Model B \n  pinMode(1, OUTPUT); //LED on Model A \n} \nvoid loop() { \n  digitalWrite(0, HIGH); // turn the LED on (HIGH is the voltage level) \n  digitalWrite(1, HIGH); delay(300); // wait for a second \n  digitalWrite(0, LOW); // turn the LED off by making the voltage LOW \n  digitalWrite(1, LOW); delay(300); // wait for a second \n}\n```\n\n这款开发板比较特殊，先点击下载按钮，当出现如下提示时再插入开发板（而不是插好等下载）\n```\n项目使用了 718 字节，占用了 (11%) 程序存储空间。最大为 6012 字节。\n全局变量使用了9字节的动态内存。\nRunning Digispark Uploader...\nPlug in device now... (will timeout in 60 seconds)\n```\n这段时间是用来烧写程序的，因为烧写时引导程序需要通过USB接口与计算机沟通，所以这时候计算机才能识别到开发板。5秒后，内部的boot loader会退出烧写模式，并加载用户程序，所以计算机就识别不到它了，并且此时led才能正常闪烁。<details markdown='1'><summary>展开/收起</summary>\n```\nRunning Digispark Uploader...\nPlug in device now... (will timeout in 60 seconds)\n> Please plug in the device ... \n> Press CTRL+C to terminate the program.\n> Device is found!\nconnecting: 16% complete\nconnecting: 22% complete\nconnecting: 28% complete\nconnecting: 33% complete\n> Device has firmware version 2.2\n> Device signature: 0x1e930b \n> Available space for user applications: 6522 bytes\n> Suggested sleep time between sending pages: 7ms\n> Whole page count: 102  page size: 64\n> Erase function sleep duration: 714ms\nparsing: 50% complete\n> Erasing the memory ...\nerasing: 55% complete\nerasing: 60% complete\nerasing: 65% complete\n>> Eep! Connection to device lost during erase! Not to worry\n>> This happens on some computers - reconnecting...\n>> Reconnected! Continuing upload sequence...\n> Starting to upload ...\nwriting: 70% complete\nwriting: 75% complete\nwriting: 80% complete\n> Starting the user app ...\nrunning: 100% complete\n>> Micronucleus done. Thank you!\n```\n</details>\n\n* * *\n\n# 撸代码\n\n在GitHub上有一个为digispark一键生成代码的project > [AutoMator](https://github.com/Catboy96/Automator) \n![长这样](https://i.loli.net/2021/03/22/7cPFRJKUSrx5kIs.png)\n\n```\n#include \n\nvoid loop() {}\n\nvoid setup() {\nDigiKeyboard.sendKeyStroke(0);\nDigiKeyboard.delay(1000);\n//START\nDigiKeyboard.delay(15000);\n//ENTER BIOS\nDigiKeyboard.sendKeyStroke(KEY\\_F1);\nDigiKeyboard.delay(1000);\n//TO ADVANCED\nDigiKeyboard.sendKeyStroke(KEY\\_RIGHT\\_ARROW);\nDigiKeyboard.delay(600);\n//ENTER JUMPERFREE CONFIGURATION\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//SET OVERCLOCKING MODE\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//MANUAL\nDigiKeyboard.sendKeyStroke(KEY\\_UP\\_ARROW);\nDigiKeyboard.delay(600);\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//TO CPU FREQUENCY\nDigiKeyboard.sendKeyStroke(KEY\\_DOWN\\_ARROW);\nDigiKeyboard.delay(600);\n//ENTER CPU FREQUENCY\nDigiKeyboard.print(\"380\");\nDigiKeyboard.delay(600);\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//BACK TO ADVANCED\nDigiKeyboard.sendKeyStroke(KEY\\_ESC);\nDigiKeyboard.delay(600);\n//TO CPU CONFIGURATION\nDigiKeyboard.sendKeyStroke(KEY\\_DOWN\\_ARROW);\nDigiKeyboard.delay(600);\n//ENTER CPU CONFIGURATION\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//TO C1E SUPPORT\nDigiKeyboard.sendKeyStroke(KEY\\_DOWN\\_ARROW);\nDigiKeyboard.delay(600);\n//SET C1E SUPPORT\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//DISABLE C1E SUPPORT\nDigiKeyboard.sendKeyStroke(KEY\\_UP\\_ARROW);\nDigiKeyboard.delay(600);\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\nDigiKeyboard.delay(600);\n//SAVE && EXIT\nDigiKeyboard.sendKeyStroke(KEY\\_F10);\nDigiKeyboard.delay(600);\nDigiKeyboard.sendKeyStroke(KEY\\_ENTER);\n}\n```\n\n# 编译失败了\n```\nconst unsigned char ascii\\_to\\_scan\\_code\\_table \\[119\\]' previously defined here\nconst unsigned char ascii\\_to\\_scan\\_code\\_table\\[\\] PROGMEM = {\n```\n\n这个错误由`digispark.h`中键位表不全所致。代码中如出现`KEY_RIGHT_ARROW`等未定义的键时会导致编译出错。 在`digispark.h`中补全键位表即可\n```\n#define KEY\\_UP\\_ARROW 0x52\n#define KEY\\_DOWN\\_ARROW 0x51\n#define KEY\\_LEFT\\_ARROW 0x50\n#define KEY\\_RIGHT\\_ARROW 0x4F\n#define KEY\\_ESC 0x29\n```\n[![](https://i.loli.net/2021/03/21/SbuWnvKVU5BrYzh.png)](https://i.loli.net/2021/03/21/SbuWnvKVU5BrYzh.png)\n\n# 怎么没反应🧐\n\n好欸，BIOS认digispark是个键盘了 等 再等 再等等 并没有反应 在digispark论坛中，很多人反应digispark模拟的hid键盘并不能在BIOS中使用 [https://digistump.com/board/index.php?topic=1096.0](https://digistump.com/board/index.php?topic=1096.0 \"https://digistump.com/board/index.php?topic=1096.0\") [https://digistump.com/board/index.php?topic=2922.0](https://digistump.com/board/index.php?topic=2922.0 \"https://digistump.com/board/index.php?topic=2922.0\") 有大佬提出通过替换`digispark.h`和`usbconfig.h`文件可以解决这个问题[https://github.com/bkgarry/DigikeyboardBIOS](https://github.com/bkgarry/DigikeyboardBIOS)\n\n> These two files (DigiKeyboard.h and usbconfig.h) replace the original digikeyboard files in the following windows directory.\n> `%localappdata%\\\\Arduino15\\\\packages\\\\digistump\\\\hardware\\\\avr\\\\1.6.7\\\\libraries\\\\DigisparkKeyboard`\n> (please note that the path may change for different versions of the digistump files and Arduino IDE)\n> \n> %localappdata% is the environmental variable to take you to your user's local appdata so the path will work.\n> \n> Once these files have been replaced, recompile your existing code to your digispark and you will be able to use the same script to run your keyboard commands within a system BIOS)\n\n# Working🤗\n\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: '0314c74e2e4534b5',\n    autoPlay: false\n});\n</script>\n\n![](https://i.loli.net/2021/04/11/Wa3gVdvxGiuzPXD.jpg)","categories":["uncategorized"]},{"title":"DIY适马佳能AF镜头兼容性修复(\\\"rechip\\\")","url":"/2020/12/22/diy适马佳能af镜头兼容性修复rechip/","content":"原文：[Github](https://github.com/marcan/sigmafix) & [Twitter](https://twitter.com/marcan42/status/1046781328148979712?s=09 \"@marcan42\")\n\n翻译/校对：[Given](https://2890.ltd/)\n\n使用佳能EF卡口的旧的适马镜头不能在新的佳能机身上工作，因为适马不完全反向工程EF协议，没有实现所有需要的命令。这是一个DIY修复方法，使用ATtiny13单片机来修改协议，使镜头重新兼容数码EOS机身。\n<!-- more -->\n有些人喜欢称之为 \"rechip\"，\"rechip\"实际上是指官方的修复，包括更换镜头中的芯片。但这个修正是一个附加的修正，并没有替换镜头中现有的芯片，所以更应该称之为 \"modchip\"。\n\n* * *\n\n# 功能介绍\n\n**_低功耗_**：该修复在活动模式下（例如拍摄、自动对焦、实时视图模式或更改镜头设置时）消耗约500µA，在睡眠模式下（在标准模式下或相机关闭时，在几秒钟不活动后自动进入）消耗不到1µA。因此，它不会对电池寿命产生可衡量的影响。 **_被动式_**：本方案不像其他方案那样通过DCL线路由MCU处理，而是使用一个电阻，仅在必要时主动覆盖DCL。因此，在协议的正常运行中，它的影响为零，只改变需要改变的一个位。 **_正确的EF协议_**：与其他版本不同，这个版本正确解析EF协议，并跟踪命令长度。它还有一个超时功能，如果出了问题，可以与命令重新同步。 \\[dogevideo\\]57b05519765a9df3\\[/dogevideo\\]\n\n* * *\n\n# [编译](https://github.com/wanghurui/sigmafix/releases/tag/1.0)\n\n输入`make`来编译工程(需要avra编译器)，或者`make flash`来用avrdude flash (默认使用 usbtiny 编译器，但你可以使用 `make PROGRAMMER=foo`来改变编译器类型)。如果你使用其他的编程方法，不要忘了刷写保险丝 （`LFUSE=0x72 HFUSE=0xfb`）。\n\n* * *\n\n# 安装方法\n\n安装时，需要剪断相机到镜头的DCL线，并在线路上插入一个220Ω的电阻，然后将编程后的ATtiny13接上，如下图所示。\n\n```\n                                   Camera side\n                    =========================================\n                    DGND  LCLK  DLC  DCL  VDD  PGND/DET  VBAT\n                     |     |     |    |    |      |       |\n      ATtiny13    ,------------------------+      |       |\n     __________   |  |     |     |    |    |      |       |\n    |o         |  |  |     |     |    \\    |      |       |\n   1|RESET  VCC|8-'  |     |     | 220/    |      |       |\n   2|PB3    PB2|7    |     |     |  Ω \\    |      |       |\n   3|PB4    PB1|6----------+     |    /    |      |       |\n ,-4|GND    PB0|5---------------------+    |      |       |\n |  |__________|     |     |     |    |    |      |       |\n `-------------------+     |     |    |    |      |       |\n                     |     |     |    |    |      |       |\n                    DGND  LCLK  DLC  DCL  VDD  PGND/DET  VBAT\n                    =========================================\n                                    Lens side\n```\n\n[![安装示例](https://cdn.hyh.ink/imger/2020/12/21/sigmafix_lens_diagram.jpg)](https://cdn.hyh.ink/imger/2020/12/21/sigmafix_lens_diagram.jpg)\n\n* * *\n\n# 问题\n\n佳能EF镜头同时接受`12 YY`和`13 YY`两个命令，以`YY`步数（符号为uint8）改变光圈。旧的胶片佳能机身使用`12 YY`，而新的数码机身使用`13 YY`。看来适马并没有通过尝试所有可能的命令来完全逆向工程协议，而只是实现了当时佳能机身使用的命令。因此，老的适马镜头只支持`12 YY`。如果这样的镜头用在新机身上，光圈永远不会移动。光圈有一个位子反馈给相机：是否在全开位置。相机会根据它所期望的光圈位置来检查这一点。因此，这些老镜头的行为如下：如果光圈是大开（常见情况），镜头只会在相机光圈设置为全开（匹配）的情况下拍摄，否则相机会抛出一个错误。如果光圈不是全开（比如被手动移动了，或者在关机时取下了镜头），那么相机会允许用其他光圈设置拍照，但光圈当然也不会移动。\n\n* * *\n\n# 解决方法\n\n把命令13补成命令12。他们之间只有一个比特的差异差。由于协议是MSB优先，所以只要前面7个位都收到后，即可完成，也就是说不需要延迟或缓冲协议，而是可以近乎实时完成。\n\n* * *\n\n# 原理\n\n代码的大部分时间都是处于在睡眠模式下的。当LCLK为低电平时（在命令开始时），它通过低电平INT0中断唤醒芯片。中断处理程序什么也不做，只是从掉电模式返回。然后，主程序禁用中断以防止其重新启动，并接收命令字节。唤醒延迟是这样的：当LCLK为高电平时，芯片正好可以对第一个命令位进行采样，这是预期的采样时间。 在接收到7个命令位后，代码会检查命令0x12/0x13。如果命令匹配，则等待下一个位周期，然后强制DCL为低。这将任何0x13命令改写成0x12，然后等待镜头通过LCLK脉冲确认命令。 由于命令可以有参数，而且没有明确的框架来区分参数和命令，因此代码中包含了所有256个可能的命令以及预期参数长度的表格（根据佳能镜头进行检查）。如果有任何参数字节，它就会读取这些字节，而不进行任何进一步的处理，然后回到睡眠模式，等待下一条命令。 为了在出现故障时实现超时，定时器0设置了0-700µs的超时，并在每个命令开始时启动，同时允许中断。只有当镜头应答一个命令时，它才会停止。如果定时器过期，它就会触发一个中断，该中断不会返回，而是从复位向量重新启动整个程序。这与佳能镜头的行为类似，如果一个命令字节的时间超过700µs，它将启动一个协议复位。\n\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: '57b05519765a9df3',\n    autoPlay: false\n});\n</script>\n","tags":["IT","折腾","摄影"],"categories":["uncategorized"]},{"title":"DIY Arduino 入射式测光表","url":"/2020/11/23/diy-arduino-入射式测光表/","content":"\n> A Lightmeter/Flashmeter for photographers, based on Arduino. Components: \n>* Arduino NANO v.3 \n>* BH1750 light sensor \n>* SSD1306 128\\*96 OLED SPI Display \n>* Buttons   \n>\n>Thanks [@morozgrafix](https://github.com/morozgrafix) for creating schematic diagram for this device. The lightmeter based on Arduino as a main controller and BH1750 as a metering cell.   \n> \n> Information is displayed on SSD1306 OLED display. The device is powered by 2 AAA batteries. Functions list:\n> *   Ambient light metering\n>*   Flash light metering\n>*   ND filter correction\n>*   Aperture priority\n>*   Shutter speed priority\n>*   ISO range 8 - 4 000 000\n>*   Aperture range 1.0 - 3251\n>*   Shutter speed range 1/10000 - 133 sec\n>*   ND Filter range ND2 - ND8192\n>*   Displaying amount of light in Lux.\n>*   Displaying exposure value, EV\n>*   Recalculating exposure pair while one of the parameter changing\n>*   Battery information\n>*   Power 2xAAA LR03 batteries\n\n> Detailed information on my site: [https://www.pominchuk.com/lightmeter/](https://www.pominchuk.com/lightmeter/)\n\n![](https://s2.loli.net/2022/02/03/s6LuUXAYDWKbwnT.jpg)\n---\n<!-- more -->\n\nDIY测光表测光模式相当于相机内中央平均测光。在大多数拍摄情况下中央平均测光是一种非常实用的测光模式，在拍摄人像旅游照等对于中央亮度起到决定性作用的拍摄场景时，应用广泛。\n\n\n# 所需元件\n\n    1.  Arduino nano\n    2.  BH1750光强度模块\n    3.  0.96寸 7针SPI接口oled屏幕（SSD1306）\n\n![](https://s2.loli.net/2022/02/03/25gABb6LoY4qKQu.jpg)\n# 源码&&焊接\n```\n#include <SPI.h>\n#include <Wire.h>\n#include <Adafruit\\_GFX.h>\n#include <Adafruit\\_SSD1306.h>\n#include <BH1750.h>\n#include <EEPROM.h>\n#include <avr/sleep.h>\n#define SCREEN\\_WIDTH 128 // OLED display width, in pixels\n#define SCREEN\\_HEIGHT 64 // OLED display height, in pixels\n\n// Declaration for SSD1306 display connected using software SPI (default case):\n#define OLED\\_DC                 11\n#define OLED\\_CS                 12\n#define OLED\\_CLK                8 //10\n#define OLED\\_MOSI               9 //9\n#define OLED\\_RESET              10 //13\nAdafruit\\_SSD1306 display(SCREEN\\_WIDTH, SCREEN\\_HEIGHT,\n  OLED\\_MOSI, OLED\\_CLK, OLED\\_DC, OLED\\_RESET, OLED\\_CS);\n\nBH1750 lightMeter;\n\n#define DomeMultiplier          2.17                    // Multiplier when using a white translucid Dome covering the lightmeter\n#define MeteringButtonPin       2                       // Metering button pin\n#define PlusButtonPin           3                       // Plus button pin\n#define MinusButtonPin          4                       // Minus button pin\n#define ModeButtonPin           5                       // Mode button pin\n#define MenuButtonPin           6                       // ISO button pin\n#define MeteringModeButtonPin   7                       // Metering Mode (Ambient / Flash)\n//#define PowerButtonPin          2\n\n#define MaxISOIndex             57\n#define MaxApertureIndex        70\n#define MaxTimeIndex            80\n#define MaxNDIndex              13\n#define MaxFlashMeteringTime    5000                    // ms\n\nfloat   lux;\nboolean Overflow = 0;                                   // Sensor got Saturated and Display \"Overflow\"\nfloat   ISOND;\nboolean ISOmode = 0;\nboolean NDmode = 0;\n\nboolean PlusButtonState;                // \"+\" button state\nboolean MinusButtonState;               // \"-\" button state\nboolean MeteringButtonState;            // Metering button state\nboolean ModeButtonState;                // Mode button state\nboolean MenuButtonState;                // ISO button state\nboolean MeteringModeButtonState;        // Metering mode button state (Ambient / Flash)\n\nboolean ISOMenu = false;\nboolean NDMenu = false;\nboolean mainScreen = false;\n\n// EEPROM for memory recording\n#define ISOIndexAddr        1\n#define apertureIndexAddr   2\n#define modeIndexAddr       3\n#define T\\_expIndexAddr      4\n#define meteringModeAddr    5\n#define ndIndexAddr         6\n\n#define defaultApertureIndex 12\n#define defaultISOIndex      11\n#define defaultModeIndex     0\n#define defaultT\\_expIndex    19\n\nuint8\\_t ISOIndex =          EEPROM.read(ISOIndexAddr);\nuint8\\_t apertureIndex =     EEPROM.read(apertureIndexAddr);\nuint8\\_t T\\_expIndex =        EEPROM.read(T\\_expIndexAddr);\nuint8\\_t modeIndex =         EEPROM.read(modeIndexAddr);\nuint8\\_t meteringMode =      EEPROM.read(meteringModeAddr);\nuint8\\_t ndIndex =           EEPROM.read(ndIndexAddr);\n\nint battVolts;\n#define batteryInterval 10000\ndouble lastBatteryTime = 0;\n\n#include \"lightmeter.h\"\n\nvoid setup() {  \n  pinMode(PlusButtonPin, INPUT\\_PULLUP);\n  pinMode(MinusButtonPin, INPUT\\_PULLUP);\n  pinMode(MeteringButtonPin, INPUT\\_PULLUP);\n  pinMode(ModeButtonPin, INPUT\\_PULLUP);\n  pinMode(MenuButtonPin, INPUT\\_PULLUP);\n  pinMode(MeteringModeButtonPin, INPUT\\_PULLUP);\n\n  //Serial.begin(115200);\n\n  battVolts = getBandgap();  //Determins what actual Vcc is, (X 100), based on known bandgap voltage\n\n  Wire.begin();\n  lightMeter.begin(BH1750::ONE\\_TIME\\_HIGH\\_RES\\_MODE\\_2);\n  //lightMeter.begin(BH1750::ONE\\_TIME\\_LOW\\_RES\\_MODE); // for low resolution but 16ms light measurement time.\n\n  display.begin(SSD1306\\_SWITCHCAPVCC, 0x3D);\n  display.setTextColor(WHITE);\n  display.clearDisplay();\n\n  // IF NO MEMORY WAS RECORDED BEFORE, START WITH THIS VALUES otherwise it will read \"255\"\n  if (apertureIndex > MaxApertureIndex) {\n    apertureIndex = defaultApertureIndex;\n  }\n\n  if (ISOIndex > MaxISOIndex) {\n    ISOIndex = defaultISOIndex;\n  }\n\n  if (T\\_expIndex > MaxTimeIndex) {\n    T\\_expIndex = defaultT\\_expIndex;\n  }\n\n  if (modeIndex < 0  modeIndex > 1) {\n    // Aperture priority. Calculating shutter speed.\n    modeIndex = 0;\n  }\n\n  if (meteringMode > 1) {\n    meteringMode = 0;\n  }\n\n  if (ndIndex > MaxNDIndex) {\n    ndIndex = 0;\n  }\n\n  lux = getLux();\n  refresh();\n}\n\nvoid loop() {  \n  if (millis() >= lastBatteryTime + batteryInterval) {\n    lastBatteryTime = millis();\n    battVolts = getBandgap();\n  }\n  \n  readButtons();\n\n  menu();\n\n  if (MeteringButtonState == 0) {\n    // Save setting if Metering button pressed.\n    SaveSettings();\n\n    lux = 0;\n    refresh();\n    \n    if (meteringMode == 0) {\n      // Ambient light meter mode.\n      lightMeter.configure(BH1750::ONE\\_TIME\\_HIGH\\_RES\\_MODE\\_2);\n\n      lux = getLux();\n\n      if (Overflow == 1) {\n        delay(10);\n        getLux();\n      }\n\n      refresh();\n      delay(200);\n    } else if (meteringMode == 1) {\n      // Flash light metering\n      lightMeter.configure(BH1750::CONTINUOUS\\_LOW\\_RES\\_MODE);\n\n      unsigned long startTime = millis();\n      uint16\\_t currentLux = 0;\n      lux = 0;\n\n      while (true) {\n        // check max flash metering time\n        if (startTime + MaxFlashMeteringTime < millis()) { break; } currentLux = getLux(); delay(16); if (currentLux > lux) {\n          lux = currentLux;\n        }\n      }\n\n      refresh();\n    }\n  }\n}\n```\n\n## 运行库\n\n- Adafruit_Circuit_Playground\n- Adafruit_Sensor\n- Adafruit_SSD1306\n- Adafruit-GFX-Library\n- BH1750\n\n2020.11.23\n\n# 立个flag 2022-02-03\n- [ ] 重新设计PCB\n","tags":["IT","折腾","摄影"],"categories":["uncategorized"]},{"title":"用ESP8266扩展家中局域网","url":"/2020/08/07/用esp8266扩展家中局域网/","content":"\nvia [https://github.com/rubfi/esp\\_wifi\\_repeater](https://github.com/rubfi/esp_wifi_repeater)\n\n# [![](https://image.krunk.cn/images/2020/08/07/image66b4119bcffcf74e.png)](https://image.krunk.cn/images/2020/08/07/image66b4119bcffcf74e.png)\n\n# ESP无线中继器\n\n这是一个在esp8266作为WiFi NAT路由器的概念和实现。它可以作为现有WiFi网络的无线AP扩展。esp以STA和soft-AP模式透明转发任何IP的流量。因为它使用NAT转发，所以在网络端和连接的站点上都不需要路由条目。站点在192.168.4.0/24网络中默认通过DHCP配置，并从现有的WiFi网络接收其DNS地址。 经过测试，ESP无线中继器可以在两个方向上实现约 5 Mbps，因此即使流媒体也是可能的。ESP无线中继器还允许远程监控（或数据包嗅探），例如使用 Wireshark。\n<!-- more -->\n# 烧录\n\n在 Windows 上，可以使用\"ESP8266 下载工具\"在 [https://espressif.com/en/support/download/other-tools](https://espressif.com/en/support/download/other-tools) 从固件目录下载两个文件 0x000000.bin 和 0x10000.bin。_（对于 ESP-01，将闪存大小更改为\"8Mbit\"）_\n\n> 使用 V2.0.0 SDK 编译的固件无法在某些 ESP-01 模块上启动。如果遇到这些问题，请使用目录firmware\\_sdk\\_1.5.4（地址 0x00000 和 0x40000）。 我用的D1 mini也只能用firmware\\_sdk\\_1.5.4编译的固件启动\n\n[![](https://image.krunk.cn/images/2020/08/07/image.png)](https://image.krunk.cn/images/2020/08/07/image.png)\n\n# 使用\n\n固件烧录完成后可以使用putty连接ESP的com口，波特率115200以修改固件默认配置 [![](https://image.krunk.cn/images/2020/08/07/image5a41c56eb0cdadb9.png)](https://image.krunk.cn/images/2020/08/07/image5a41c56eb0cdadb9.png) 固件从以下默认配置开始:\n\n*   ssid: ssid, pasword: password\n*   ap\\_ssid: MyAP, ap\\_password: none, ap\\_on: 1, ap\\_open: 1\n*   network: 192.168.4.0/24\n\n这意味着它通过AP sid，密码连接到互联网，并提供一个开放的AP与ap\\_ssid:MyAP。此默认值可以在文件user\\_config. h 中更改。可以使用控制台接口覆盖默认值并持续保存为闪存。此控制台可通过 115200 波特的串行端口或 tcp 端口 7777（例如，从连接的 STA 获得\"telnet 192.168.4.1 7777\"）。 控制台使用以下命令:\n\n*   help: prints a short help message\n*   show \\[configstats\\]: prints the current config or some statistics  _eg：show config_\n*   set \\[ssidpasswordap\\_ssidap\\_password\\] _value_: changes the named config parameter \n    \n    set ssid TP-LINK\\_B9C0\n    \n     \n    \n    set password ！@#￥%……&\\*（（\n    \n     \n*   set ap\\_open \\[01\\]: selects, wheter the soft-AP uses WPA2 security (ap\\_open=0) or no password (ap\\_open=1)\n*   set ap\\_on \\[01\\]: selects, wheter the soft-AP is disabled (ap\\_on=0) or enabled (ap\\_on=1)\n*   set network _ip-addr_: sets the IP address of the internal network, network is always /24, router is always x.x.x.1\n*   set speed \\[80160\\]: sets the CPU clock frequency\n*   set vmin _voltage_: sets the minimum battery voltage in mV. If Vdd drops below, the ESP goes into deep sleep. If 0, nothing happens\n*   set vmin\\_sleep _time_: sets the time interval in seconds the ESP sleeps on low voltage\n*   set config\\_port _portno_: sets the port number of the console login (default is 7777, 0 disables remote console config)\n*   portmap add \\[TCPUDP\\] _external\\_port_ _internal\\_ip_ _internal\\_port_: adds a port forwarding\n*   portmap remove \\[TCPUDP\\] _external\\_port_: deletes a port forwarding\n*   save \\[dhcp\\]: saves the current config parameters \\[+ the current DHCP leases\\] to flash\n*   quit: terminates a remote session\n*   reset \\[factory\\]: resets the esp, optionally resets WiFi params to default values\n*   lock: locks the current config, changes are not allowed\n*   unlock _password_: unlocks the config, requires password of the network AP\n*   scan: does a scan for APs\n*   monitor \\[onoff\\] _port_: starts and stops monitor server on a given port\n\n[![](https://image.krunk.cn/images/2020/08/07/image40a310f55c3654de.png)](https://image.krunk.cn/images/2020/08/07/image40a310f55c3654de.png)\n\n# 状态指示灯\n\n在默认配置 GPIO2 配置驱动器状态 LED（连接到 GND）与以下指示：\n\n*   常亮：已启动，但未成功连接到 AP\n*   闪烁（1 秒）：工作，连接到 AP\n*   非正常闪烁：工作，内部网络中的流量\n\n在user\\_config.h 中，可以配置备用 GPIO 端口。当配置为 GPIO1 时，它可与 ESP-01 板上的蓝色 LED 一起使用。但是，由于 GPIO1 ist 也是 UART-TX 引脚，这意味着串行控制台不工作。\n\n# MQTT 支持\n\n自版本 1.3 以来，路由器具有一个构建中的 MQTT 客户端（感谢 Tuan PM的库[https://github.com/tuanpmt/esp\\_mqtt](https://github.com/tuanpmt/esp_mqtt)。这可以帮助将路由器/中继器集成到 IoT 中。家庭自动化系统可以例如，根据有关当前关联站的信息做出决策，它可以打开和中继器（例如，根据时间安排），或者简单地用于监视负载。路由器可以连接到本地 MQTT 代理或云中的公开代理。但是，当前它不支持 TLS 加密。 默认情况下，MQTT 客户端处于禁用状态。可以通过将配置参数\"mqtt\\_host\"设置为不同于\"无\"的主机名来启用它。要配置 MQTT，可以设置以下参数：\n\n*   set mqtt\\_host _IP\\_or\\_hostname_: IP or hostname of the MQTT broker (\"none\" disables the MQTT client)\n*   set mqtt\\_user _username_: Username for authentication (\"none\" if no authentication is required at the broker)\n*   set mqtt\\_user _password_: Password for authentication\n*   set mqtt\\_id _clientId_: Id of the client at the broker (default: \"ESPRouter\\_xxxxxx\" derived from the MAC address)\n*   set mqtt\\_prefix _prefix\\_path_: Prefix for all published topics (default: \"/WiFi/ESPRouter\\_xxxxxx/system\", again derived from the MAC address)\n*   set mqtt\\_command\\_topic _command\\_topic_: Topic subscribed to receive commands, same as from the console. (default: \"/WiFi/ESPRouter\\_xxxxxx/command\", \"none\" disables commands via MQTT)\n*   set mqtt\\_interval _secs_: Set the interval in which the router publishs status topics (default: 15s, 0 disables status publication)\n*   set mqtt\\_mask _mask\\_in\\_hex_: Selects which topics are published (default: \"ffff\" means all)\n\nMQTT 参数可以使用\"显示 mqtt\"命令显示。\n\n*   _prefix\\_path_/Uptime: System uptime since last reset in s (mask: 0x0020)\n*   _prefix\\_path_/Vdd: Voltage of the power supply in mV (mask: 0x0040)\n*   _prefix\\_path_/Bpsin: Bytes/s from stations into the AP (mask: 0x0800)\n*   _prefix\\_path_/Bpsout: Bytes/s from the AP to stations (mask: 0x1000)\n*   _prefix\\_path_/Ppsin: Packets/s from stations into the AP (mask: 0x0200)\n*   _prefix\\_path_/Ppsout: Packets/s from the AP to stations (mask: 0x0400)\n*   _prefix\\_path_/Bin: Total bytes from stations into the AP (mask: 0x0080)\n*   _prefix\\_path_/Bout: Total bytes from the AP to stations (mask: 0x0100)\n*   _prefix\\_path_/NoStations: Number of stations currently connected to the AP (mask: 0x2000)\n*   _prefix\\_path_/join: MAC address of a station joining the AP (mask: 0x0008)\n*   _prefix\\_path_/leave: MAC address of a station leaving the AP (mask: 0x0010)\n*   _prefix\\_path_/IP: IP address of the router when received via DHCP (mask: 0x0002)\n*   _prefix\\_path_/ScanResult: Separate topic for the results of a \"scan\" command (one message per found AP) (mask: 0x0004)\n*   _prefix\\_path_/response: The router publishes on this topic the command line output (mask: 0x0001)\n\n# 电源管理\n\n中继器监控其电流电源电压（显示在\"show stats\"命令中）。如果_vmin（_在 mV 中，默认 0）设置为值 > 0，并且电源电压低于此值，则它将进入_深度睡眠模式 vmin\\_sleep_秒。如果您已将 GPIO16 连接到 RST（很难在 ESP-01 上焊接），它将在此间隔后重新启动，尝试重新连接，并将继续测量。 [![](https://image.krunk.cn/images/2020/08/07/image9c31a7ebc2011e84.png)](https://image.krunk.cn/images/2020/08/07/image9c31a7ebc2011e84.png)\n\n* * *\n\n# 运行截图\n\n[![Z0_GSZR0CDRLTNBEUF.png](https://image.krunk.cn/images/2020/08/12/Z0_GSZR0CDRLTNBEUF.png)](https://image.krunk.cn/images/2020/08/12/Z0_GSZR0CDRLTNBEUF.png) [![4VQ0LYHQLDXMCM91P.png](https://image.krunk.cn/images/2020/08/12/4VQ0LYHQLDXMCM91P.png)](https://image.krunk.cn/images/2020/08/12/4VQ0LYHQLDXMCM91P.png)","tags":["IT","折腾"],"categories":["uncategorized"]},{"title":"太阳神HELIOS 44M-4","url":"/2020/05/07/太阳神helios-44m-4/","content":"[![](https://history.whrblog.online/2019/04/07/image-bed-1/20200507134351.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20200507134351.jpg)\n<!-- more -->\n# Helios 44\n\n* * *\n\n>   Helios 44型135镜头自1950年年初开始研制，基于卡尔-蔡司-耶拿的Biotar 2/58镜头的光学设计，最初被称为“BTK”，即BioTar Krasnogorskij，大意为克拉斯诺戈尔斯克的Biotar镜头。该镜头1958年开始在KMZ工厂正式生产，后来螺口的格里奥斯44镜头搬迁到白俄罗斯明斯克的BELOMO厂生产，卡口镜头依然在KMZ厂生产。1972年，格里奥斯44M问世，标志着该镜头开始向现代镜头演变；1981年格里奥斯44M -4定型，此后逐渐延伸出一个庞大的镜头家族。 Helios 44镜头有多重卡口，除了早期的插刀式之外，还有PK卡口、L39螺口和M42螺口。 Helios 44镜头均采用双高斯结构，使得该镜头可以轻松提供F2的大光圈，同时能够自动校正很多像差。但是由于早期双高斯结构设计上的问题，光圈全开时像场边缘部位的球形畸变校正不彻底，导致焦外光斑被压缩成椭圆形状，越靠近边缘变形越厉害，当焦外是明亮的杂乱光斑时能够形成所谓“漩涡散景”，即大家通常所说的漩焦。 Helios 44镜头版本繁多，如 Helios-44、Helios-44-2、Helios-44-7、Helios-44M、Helios-44M-4、以及后续的Helios-44M-5、Helios-44M-6和Helios-44M-7等。最早因为Helios-44-2有八片光圈，故有“八羽怪”的别称 Helios-44-2有两个用于控制光圈的光圈环，一个是无级调整光圈大小的光圈环，另一个环带有刻度，用于锁定最小光圈，以便在最大光圈下取景完毕后能迅速回到想用的光圈进行拍摄。 从Helios-44M开始，加入了自动顶针，光圈环减少为一个并带有刻度。镜头前面是对焦环，后面是光圈环，使用起来的感觉和如今的手动头一样。从Helios-44M-4开始，开始采用多层镀膜技术，分辨率大为提高\n\n* * *\n\n\n[![IMG_0008.md.jpg](https://image.krunk.cn/images/2020/05/08/IMG_0008.md.jpg)](https://image.krunk.cn/images/2020/05/08/IMG_0008.md.jpg) \n[![IMG_0010.md.jpg](https://image.krunk.cn/images/2020/05/08/IMG_0010.md.jpg)](https://image.krunk.cn/images/2020/05/08/IMG_0010.md.jpg)\n[![](https://i.loli.net/2020/05/08/I2APli6fuxDFqLa.png)](https://i.loli.net/2020/05/08/I2APli6fuxDFqLa.png)\n[![](https://i.loli.net/2020/05/09/j2nG6PfvbEKoZzC.jpg)](https://i.loli.net/2020/05/09/j2nG6PfvbEKoZzC.jpg)\n\n* * *\n\n# 样片\n\n[![](https://history.whrblog.online/2019/04/07/image-bed-1/20200503165489.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20200503165489.jpg) [![](https://i.loli.net/2020/05/11/mlf62tdD3BULeIM.jpg)](https://i.loli.net/2020/05/11/mlf62tdD3BULeIM.jpg) Canon Kiss X3 f2 0.5‘ ISO 100 [![FUJIFILM XT3 f4](https://history.whrblog.online/2019/04/07/image-bed-1/DSCF1296.JPG)](https://history.whrblog.online/2019/04/07/image-bed-1/DSCF1296.JPG) [![FUJIFILM XT3 f8](https://history.whrblog.online/2019/04/07/image-bed-1/DSCF1291.JPG)](https://history.whrblog.online/2019/04/07/image-bed-1/DSCF1291.JPG) \n\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: 'abb6a1f3fefd5245',\n    autoPlay: false\n});\n</script>\n\n","tags":["折腾","摄影"],"categories":["uncategorized"]},{"title":"4.7 玄风飞行基地","url":"/2020/04/08/4-7/","content":"\n![](https://image.krunk.cn/images/2020/04/13/IMG_0155.md.jpg)\n<!-- more -->\n\\[dogevideo\\]1e4b3e5ea84bd042\\[/dogevideo\\]","tags":["Date","Hexo","R.C"],"categories":["uncategorized"]},{"title":"极致细节的无损视频","url":"/2020/03/25/lossless_video_on_500D_with_magiclantern/","content":"<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: 'c7f76db19e56338b'\n});\n</script>\n\n<!-- more -->\n说出来可能不信，器材是09年的佳能500D加上外挂[Magic lantern](http://magiclantern.fm)固件","tags":["IT","折腾","摄影"],"categories":["uncategorized"]},{"title":"在单片机上运行Linux（转载）","url":"/2020/03/11/在avr单片机上运行linux/","content":"\n# 介绍\n\n在Linux论坛中，常见的问题是询问Linux的最低规格是多少。常见的答案是，它需要32位体系结构，一个MMU和至少一兆字节的RAM以适合内核。该项目旨在（并成功）的粉碎这些概念。您在右侧看到的开发板基于ATmega1284p。我也使用ATmega644a取得了同样的成功。该主板没有其他处理器，并且可以启动Linux 2.6.34。实际上，它甚至可以显示完整的Ubuntu堆栈，包括（如果有时间等的话）X和gnome。\n<!-- more -->\n[![board1.jpg](https://image.krunk.cn/images/2020/03/11/board1.jpg)](https://image.krunk.cn/images/2020/03/11/board1.jpg)\n\n# **内存**\n\n完整的Linux安装需要兆字节或RAM和带有MMU的32位CPU。这个项目具有所有这些。首先让我们解决RAM。如您所见，板上有一个老式的30针SIMM内存模块。这些已用于基于80286的PC。它与ATmega接口，我编写了代码来访问它以及在规范内对其进行刷新（SDRAM需要不断刷新以避免丢失数据）。有多快？刷新中断每62ms发生一次，占用1.5ms，因此占用了不到3％的CPU。为了便于编程，一次访问一个字节访问RAM。这导致每秒大约300 KB的最大带宽。\n\n# 存储\n\n随着对RAM要求的降低，我们有两个要处理。存储不是很难解决的问题。SD卡很容易与使用SPI对话，而我的项目做到了这一点。1GB SD卡可以正常工作，尽管512Mb对于该特定文件系统（Ubuntu Jaunty）而言已足够。ATmega确实有一个硬件SPI模块，但是由于某种原因，它并没有完全解决问题，因此我在接口上做一些改动。它仍然足够快-大约每秒200千字节。这也给项目增加了一个很好的感觉-可以在任何具有足够引脚的微控制器上完成-无需使用硬件模块。 [![board3.jpg](https://image.krunk.cn/images/2020/03/11/board3.jpg)](https://image.krunk.cn/images/2020/03/11/board3.jpg)\n\n# 中央处理器\n\n剩下的就是讨厌的32位CPU和MMU要求。那么，AVR没有MMU，而是8位的。为了克服这一障碍，我编写了一个ARM仿真器。ARM是我最熟悉的体系结构，它非常简单，可以轻松编写一个仿真器。为什么要写一个而不是移植一个？好吧，移植别人的代码是没有意思的，再加上我看到的所有仿真器都不是以易于移植到8位设备的方式编写的。原因之一：AVR编译器坚持将ints设置为16位，这样简单的事情如“（1 << 20）”会给您带来麻烦，并产生零。相反，您需要执行“（1UL << 20）”。不用说拖曳其他人的未知代码库，寻找所有假定为int且可能会失败的地方将是一场灾难。另外，我希望有机会编写一个不错的模块化ARM仿真器。所以我做了。\n\n# 其它功能\n\n该板与现实世界的通信是通过串行端口进行的。目前，它连接到运行minicom的PC上的串行端口，但是可以替代地将键盘和字符LCD连接到板上，使其完全独立。板上也有两个LED。它们发出SD卡访问信号。一读，一写。板上也有一个按钮。按住一秒钟，它将在串行端口上吐出模拟CPU的当前有效速度。AVR的主频为24MHz（比其现有的20MHz略有超频）\n\n# 速度有多快？\n\nuARM当然不是速度恶魔。引导到bash提示符（“ `init = / bin / bas`h”内核命令行）大约需要2个小时。然后再花4个小时来启动整个Ubuntu（“ exec init”，然后登录）。启动X需要更长的时间。有效的仿真CPU速度约为6.5KHz，与您期望的在8位微控制器上仿真32位CPU和MMU相当。**奇怪的是**，系统一旦启动，就可以使用了。您可以输入命令并在一分钟内得到答复。也就是说，实际上您**可以**使用它。例如，我今天用它来格式化SD卡。这绝对不是最快的方法，但我认为它可能是_最便宜_，_最慢_，_最容易组装的_，_最低的零件数量_和_最低端的_ Linux PC。该板是用电线手工焊接的，甚至不需要印刷电路板。\n\n# 有关仿真器的详细信息\n\n该仿真器是非常模块化的，可以随意扩展以仿真其他SoC和硬件配置。仿真的CPU是ARMv5TE。前一阵子，我开始支持ARMv6，但是由于不需要，它从未完成（如代码所示）。仿真的SoC是PXA255。由于设计的模块化，您可以替换SoC.c并使用相同的ARMv5TE内核制造一个全新的SoC，或者替换该内核，或者随意替换外围设备。这是有目的的，因为我的意思是该代码也可以作为ARM SoC工作原理的合理清晰演示。CPU模拟器本身的代码不太干净，因为它是一个CPU模拟器。它是几年前写的超过6个月的空闲时间，然后放在一边。最近专门针对该项目复活了它。仿真器实现了一个i-cache来加快处理速度。AVR上**有很多**功能，与我的外部RAM不同，AVR可以以每秒5兆字节的速度访问内部存储器。我从来没有实现过d-cache，但是它在待办事项列表中。对块设备的访问未模拟为SD设备。事实证明这太慢了。相反，我编写了一个半虚拟化的磁盘设备（pvdisk，请参阅pvDisk.tar.bz2，GPL许可证），该设备使用无效的操作码来调用仿真器并访问磁盘。我映像中的ramdisk加载了该pvdisk，然后将chroots加载到/ dev / pvd1。ramdisk作为“ rd.img”包含在内。我使用的“机器类型”是PalmTE2。为什么？因为我对硬件非常熟悉，所以它是我看到的第一个pxa255机器类型。\n\n# 超级终端？\n\n您可以使用特殊的操作码向仿真器请求一些服务。在手臂上是`0xF7BBBBBB`，在拇指上是0xBBBB。选择它们是因为它们在ARM保证未定义的范围内。在R12中传递超级调用号，在R0..R3中传递参数，将返回值放置在R0中。来电：\n\n*   0 =停止仿真\n*   1 =打印十进制数\n*   2 =打印字符\n*   3 =获取滑枕尺寸\n*   4 =块设备操作（R0 =操作R1 =扇区编号）。请注意，它们不写仿真RAM，而是填充仿真器内部缓冲区，仿真来宾使用另一个超级调用（每次一个字）访问该缓冲区。我本来打算实现DMA，但从未尝试过。操作：\n    *   0 = getInfo（如果扇区num为零，则返回num个扇区；如果扇区num为1，则返回以字节为单位的扇区大小）\n    *   1 =扇区读取\n    *   2 =扇区写入\n*   5 =块设备缓冲区访问（R0 =值输入/值输出，R1 =字号，如果写则R2 = 1，否则为0）\n\n# 支持Thumb？\n\n完全支持Thumb。不过，我作弊了一点，将每个thumb指令解码为等效的ARM指令，然后使用arm模拟器功能执行该指令。它没有其他方法快，但是它很简单并且代码很小。可以使用256KB的查询表，但是我觉得256KB对于微控制器的闪存来说太大了。有些thumb指令不能转换为ARM，而是可以正确处理。\n\n# 自己建立\n\n出于非商业目的，您绝对可以这样做。接线如下。RAM DQ0..DQ7-> AVR C0..C7。RAM A0..A7-> AVR A0..A7。RAM A8..A11-> AVR B0..B3。RAM nRAS nCAS nWE-> AVR D7 B4 B5。SD DI SCK DO-> AVR B6 B7 D6。LED读写-> AVR D2 D3（LED的另一脚接地）。按钮-> AVR D4（另一条腿接地）。内存可以是任何30针16MB SIMM，并且可以每64ms进行4K周期的CAS-RAS刷新之前的CAS。我所用的（OWC）可以在线购买，价格为几美元。原理图如图所示。点击查看大图 [![uARM_big.png](https://image.krunk.cn/images/2020/03/11/uARM_big.png)](https://image.krunk.cn/images/2020/03/11/uARM_big.png)  \n\n# 源代码？\n\n有点混乱，但确实有效。趁热获取：[LINK](http://dmitry.gr/images/uARM.zip)。许可证对于非商业用途，只要您将许可证文件与源保持在一起并发布所有更改，如果用于商业用途，请与我联系，我们会达成协议。要构建仿真器以在PC上进行尝试，请键入“ make”\n\n*   使用“ ./uARM DISK\\_IMAGE”。要构建优化的PC版本，\n*   使用“ make BUILD = opt”。为AVR构建，\n*   使用“ make BUILD = avr”。它目前针对ATmega1284p。\n*   要以ATmega644为目标，除了更改makefile之外，还要减少icache.h中的数字，以使icache足够小以适合644中的内部RAM。归档文件中还包括1284p的最终十六进制文件。\n\n## 启动过程\n\n为了节省AVR中的代码空间，仿真器中几乎没有启动代码。实际上，“ ROM”总共有50个字节：8个字节可切换到拇指模式，还有一些拇指代码可读取SD卡的第一个扇区并以拇指模式跳至该扇区（请参见EmbeddedBoot.c）。SD卡的MBR具有另一个引导加载程序（以拇指模式编写）。这一节着眼于MBR，找到了活动分区并将其内容加载到RAM的末尾。然后，它跳转到目标ram地址+ 512（请参阅mbrBoot.c）。这里有第三大引导加载程序ELLE（请参阅ELLE.c）。这将重定位虚拟磁盘，设置ATAGS，然后调用内核。提供所有二进制文件和源文件，以便您可以随意制作自己的图像。引导过程应让人联想到PC引导。:)包含的mkbootimg。sh工具可用于制作启动分区的工作映像。完整的工作磁盘映像？[链接](https://mega.nz/#!0wQSSSbT!VHOZ3XhWDeyxMb8yvuCBw-GfJkpYNnnjIgl9SKWLi6Q)。  \n\n[via](http://dmitry.gr/?r=05.Projects&proj=07.%20Linux%20on%208bit)","tags":["IT","Linux","折腾"],"categories":["uncategorized"]},{"title":"ESP8266+Blynk做一个根开机棒","url":"/2020/01/24/esp8266blynk做一个根开机棒/","content":"\n[![IMG_20200124_131834-01.jpg](https://image.krunk.cn/images/2020/01/24/IMG_20200124_131834-01.md.jpg)](https://image.krunk.cn/images/2020/01/24/IMG_20200124_131834-01.jpg)\n<!-- more -->\n# 介绍\n\n这个应用程序是为启动服务器编写的，只支持启动一个设备。它需要在源码中配置WOL服务器以及配置服务器的静态IP。\n\n# Devices\n\n1.  ESP8266\n2.  Arduino IDE（所需库文件[ESP8266Ping](https://github.com/dancol90/ESP8266Ping),[ESP8266 Plug-in](https://github.com/esp8266/Arduino),[Blynk](https://github.com/blynkkk/blynk-library/releases/download/)）\n3.  Blynk\n\nVariable name | Default value | Comment\n----- | ---------- | -------------------------\nauth | Blynk_AuthToken | Blynk Auth Token (You get after the project was created in Blynk)\nssid | WiFi_SSID | Your WiFi network name\npass | WiFi_Password | Your WiFi network password\nip | 192.168.0.123 | Static IP for your WOL Server\ngateway | 192.168.0.1 | Your Gateway IP address\nbcastAddr | 192.168.0.255 | Your Broadcast IP address\nsubnet | 255.255.255.0 | Your Subnet Mask IP address\ndns | 1.1.1.1 | IP address of your preferred DNS server\ndevice_ip | 192.168.0.234 | Static IP address of device to be turned on (used for ping)\nmacAddr | aa:bb:cc:dd:ee:ff | Mac address of device to be turned on (important for the magic packet)\nemail | example@example.com | Email address for notifications (when the device could not be turned on within the set time limit)\ndevice_name | NAS | The short name of your device that turns on\nboot_time | 45 | Maximum time to wait for the device to turn on (used for notification, read the known issues!)\n--------------------\n\n\n# 需要更改的代码\n```\n//WiFi config\nconst char auth\\[\\] = \"Blynk\\_AuthToken\";  //Blynk Auth Token (You get after the project was created in Blynk)\nconst char ssid\\[\\] = \"WiFi\\_SSID\"; \nconst char pass\\[\\] = \"WiFi\\_Password\";\n\nconst IPAddress ip(192, 168, 0, 123); //Static IP for your WOL Server\nconst IPAddress gateway(192, 168, 0, 1);\nconst IPAddress bcastAddr(192, 168, 0, 255);\nconst IPAddress subnet(255, 255, 255, 0);\nconst IPAddress dns(1, 1, 1, 1);  //IP address of your preferred DNS server\n\n//WOL device config\nconst IPAddress device\\_ip(192, 168, 0, 234); //Static IP address of device to be turned on (used for ping)\nbyte macAddr\\[6\\] = {0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff};  //Mac address of device to be turned on (important for the magic packet)\n\n//Alert config\nconst char email\\[\\] = \"example@example.com\";\nconst char device\\_name\\[\\] = \"NAS\";\nconst uint16\\_t boot\\_time = 45;//number for countdown (It does not represent seconds, but it's close, read the known issues!)\n```\n[![-1.jpg](https://image.krunk.cn/images/2020/01/24/-1.jpg)](https://image.krunk.cn/images/2020/01/24/-1.jpg)\n\n# Code\n```\n//#define DEBUG\n#ifdef DEBUG\n#define BLYNK\\_PRINT Serial\n//#define BLYNK\\_DEBUG\n//#define ENABLE\\_DEBUG\\_PING\n#endif\n\n#define BLYNK\\_NO\\_BUILTIN//disable built-in analog and digital operations.\n//#define BLYNK\\_NO\\_INFO//disable providing info about device to the server. (saving time)\n\n#include <ESP8266WiFi.h>\n#include <BlynkSimpleEsp8266.h>\n#include <WiFiUdp.h>\n#include <ESP8266Ping.h> \n\n//blynk colors\n#define BLYNK\\_GREEN\"#23C48E\"\n#define BLYNK\\_BLUE\"#04C0F8\"\n#define BLYNK\\_YELLOW\"#ED9D00\"\n#define BLYNK\\_RED\"#D3435C\"\n#define BLYNK\\_DARK\\_BLUE\"#5F7CD8\"\n\n//WiFi config\nconst char auth\\[\\] = \"Blynk\\_AuthToken\";\nconst char ssid\\[\\] = \"WiFi\\_SSID\";\nconst char pass\\[\\] = \"WiFi\\_Password\";\n\nconst IPAddress ip(192, 168, 0, 123);\nconst IPAddress gateway(192, 168, 0, 1);\nconst IPAddress bcastAddr(192, 168, 0, 255);\nconst IPAddress subnet(255, 255, 255, 0);\nconst IPAddress dns(1, 1, 1, 1);\n\n//WOL device config\nconst IPAddress device\\_ip(192, 168, 0, 234);\nbyte macAddr\\[6\\] = {0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff};\n\n//Alert config\nconst char email\\[\\] = \"example@example.com\";\nconst char device\\_name\\[\\] = \"NAS\";\nconst uint16\\_t boot\\_time = 45;//number for countdown (It does not represent seconds, read the known issues!)\n\n//WOL\n#define MAGIC\\_PACKET\\_LENGTH 102\n#define PORT\\_WAKEONLAN 9\nbyte magicPacket\\[MAGIC\\_PACKET\\_LENGTH\\];\nunsigned int localPort = 9;\n\nWiFiUDP udp;\n\n//pins\n#define STATE\\_PINV0\n#define BUTTON\\_PINV1\n#define PING\\_TIME\\_PINV2\n#define RSSI\\_PINV3\n\n//state\nstruct WOLServerState {\nbool IsOnline;\nuint16\\_t boot\\_time;\nbool boot\\_error;\nuint16\\_t ping;\nuint32\\_t previousMillis;\nuint32\\_t interval;\n};\nWOLServerState currentState = { false, 0, false, 0, 0, 5000UL };\n\nvoid setup() {\n#ifdef DEBUG\nSerial.begin(115200);\n#endif\n\nconnectWiFi();\nconnectBlynk();\n\n//if (Blynk.connected()) {\nif (udp.begin(localPort) == 1) {\nBLYNK\\_LOG(\"udp begin OK\");\nbuildMagicPacket();\n} else {\ndelay(500);\nESP.restart();\n}\n//}\n}\n\nvoid connectWiFi() {\nWiFi.mode(WIFI\\_STA);\nWiFi.hostname(\"WOL server\");\nWiFi.config(ip, dns, gateway, subnet);\nWiFi.begin(ssid, pass);\n\nint count = 0;\nwhile (WiFi.status() != WL\\_CONNECTED) {\ndelay(250);\ndigitalWrite(LED\\_BUILTIN, HIGH);\ndelay(250);\ndigitalWrite(LED\\_BUILTIN, LOW);\n\ncount++;\nif (count > 20) {\ndelay(500);\nESP.restart();\n}\n}\n\n//BLYNK\\_LOG(\"WiFi connected, IP: %s\", WiFi.localIP().toString());\n}\n\nvoid connectBlynk() {\nBlynk.config(auth);\nBlynk.disconnect();\n\nint count = 0;\nwhile (Blynk.connect(10000) == false) {\ndelay(250);\ndigitalWrite(LED\\_BUILTIN, HIGH);\ndelay(250);\ndigitalWrite(LED\\_BUILTIN, LOW);\n\ncount++;\nif (count > 20) {\ndelay(500);\nESP.restart();\n}\n}\n\nBLYNK\\_LOG(\"Blynk connected\");\n}\n\nvoid loop() {\n// Reconnect WiFi\nif (WiFi.status() != WL\\_CONNECTED) {\nconnectWiFi();\nreturn;\n}\n\n// Reconnect to Blynk Cloud\nif (!Blynk.connected()) {\nconnectBlynk();\nreturn;\n}\n\nuint32\\_t currentMillis = millis();\nif (currentMillis - currentState.previousMillis >= currentState.interval) {\ncurrentState.previousMillis = currentMillis;\n\nif (currentState.boot\\_time == 0) {\ncurrentState.interval = 5000UL;\n} else {\ncurrentState.boot\\_time--;\nif (currentState.boot\\_time == 0) {\ncurrentState.boot\\_error = true;\nBlynk.email(email, \"{DEVICE\\_NAME} : Alert\", String(device\\_name) + \" could not be turned on!\");\n}\n}\n\nif (Ping.ping(device\\_ip, 1)) {\ncurrentState.IsOnline = true;\ncurrentState.boot\\_error = false;\ncurrentState.boot\\_time = 0;\ncurrentState.ping = Ping.averageTime();\n} else {\ncurrentState.IsOnline = false;\ncurrentState.ping = 0;\n}\n}\n\nBlynk.run();\n}\n\n// Generate magic packet\nvoid buildMagicPacket() {\nmemset(magicPacket, 0xFF, 6);\nfor (int i = 0; i < 16; i++) { int ofs = i \\* sizeof(macAddr) + 6; memcpy(&magicPacket\\[ofs\\], macAddr, sizeof(macAddr)); } } //BLYNK\\_CONNECTED() { // Blynk.syncVirtual(BUTTON\\_PIN); //} // BOOT PC button handler of application BLYNK\\_WRITE(BUTTON\\_PIN) { if (!currentState.IsOnline && currentState.boot\\_time == 0) { BLYNK\\_LOG(\"AppButtonWakeOnLan: value=%d\", param.asInt()); udp.beginPacket(bcastAddr, PORT\\_WAKEONLAN); udp.write(magicPacket, MAGIC\\_PACKET\\_LENGTH); udp.endPacket(); currentState.boot\\_time = boot\\_time; currentState.interval = 1000UL; } } BLYNK\\_READ(STATE\\_PIN) { Blynk.virtualWrite(RSSI\\_PIN, WiFi.RSSI()); Blynk.virtualWrite(PING\\_TIME\\_PIN, currentState.ping); if (currentState.IsOnline) { Blynk.setProperty(STATE\\_PIN, \"color\", BLYNK\\_GREEN); Blynk.virtualWrite(STATE\\_PIN, String(device\\_name) + \" is Online\"); Blynk.setProperty(BUTTON\\_PIN, \"color\", BLYNK\\_DARK\\_BLUE); Blynk.setProperty(BUTTON\\_PIN, \"offLabel\", String(device\\_name) + \" running...\"); Blynk.setProperty(BUTTON\\_PIN, \"onLabel\", String(device\\_name) + \" running...\"); } else if (!currentState.IsOnline && currentState.boot\\_time > 0) {\nBlynk.setProperty(STATE\\_PIN, \"color\", BLYNK\\_BLUE);\nBlynk.virtualWrite(STATE\\_PIN, \"Waiting for ping...\");\n\nBlynk.setProperty(BUTTON\\_PIN, \"color\", BLYNK\\_YELLOW);\nBlynk.setProperty(BUTTON\\_PIN, \"offLabel\", currentState.boot\\_time);\nBlynk.setProperty(BUTTON\\_PIN, \"onLabel\", \"Waiting for ping...\");\n} else if (!currentState.IsOnline && currentState.boot\\_time == 0 && currentState.boot\\_error) {\nBlynk.setProperty(STATE\\_PIN, \"color\", BLYNK\\_RED);\nBlynk.virtualWrite(STATE\\_PIN, \"Oops! Something happened, Try It Again!\");\n\nBlynk.setProperty(BUTTON\\_PIN, \"color\", BLYNK\\_YELLOW);\nBlynk.setProperty(BUTTON\\_PIN, \"offLabel\", \"Try It Again\");\nBlynk.setProperty(BUTTON\\_PIN, \"onLabel\", \"Magic Packet has been sent\");\n} else {\nBlynk.setProperty(STATE\\_PIN, \"color\", BLYNK\\_RED);\nBlynk.virtualWrite(STATE\\_PIN, String(device\\_name) + \" is Offline\");\n\nBlynk.setProperty(BUTTON\\_PIN, \"color\", BLYNK\\_BLUE);\nBlynk.setProperty(BUTTON\\_PIN, \"offLabel\", \"Turn On\");\nBlynk.setProperty(BUTTON\\_PIN, \"onLabel\", \"Magic Packet has been sent\");\n}\n}\n```\n\n# Blynk\n\n![TIM20200124142924.jpg](https://image.krunk.cn/images/2020/01/24/TIM20200124142924.md.jpg) ![](https://camo.githubusercontent.com/51545377e6fb634a2db39a6f43c8f83f7cafd31c/68747470733a2f2f7777772e656d7369742e736b2f536861726564436f6e74656e742f4769744875622f455350383236365f426c796e6b5f574f4c5f5365727665722f325f7468756d626e61696c2e706e67)  \n\n[via](https://github.com/Pnoxi/ESP8266_Blynk_WOL_Server)\n","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"行摄北疆","url":"/2019/08/18/新疆/","content":"\n\n## 2019.8.17 ##\n\n飞机承载着我对遥远北疆的热忱，在滑行道上缓缓升腾，在气流的颠簸里，我知道我此时已在离北疆越来越近的路途上了，那是个令人心驰神往的名词------北疆。\n\n从平原到戈壁，从绿洲到雪山。造物主的鬼斧神工恍若中国水墨的手笔一般，那奇妙的白茫茫的雾爬进了我们的视野，模糊了云层的日光，并把那高空底下的层峦叠嶂幻化成了迷一般的幢幢怪影。 终于来到了向往已久的天山北麓，大自然用五彩斑斓的画笔给黄土高坡添置了别样的色彩，新疆------触手可及。 \n<!-- more -->\n[![](https://i.loli.net/2021/06/15/aPrDQYqlKEcwdF8.jpg)](https://i.loli.net/2021/06/15/aPrDQYqlKEcwdF8.jpg) \n[![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0431.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0431.JPG) \n[![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0455.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0455.JPG) \n[![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0449.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0449.JPG) \n雪山，雪岭无限延伸；雪峰，肃立威严。北国的冬雪尚未化尽，一座座山峦此起彼伏、银装素裹、延绵千里，那盘踞的身形恍若九天银河洒落人间阅尽千帆。那山脚下干的树枝虬劲疏落，在蓝天夏日的背景下仿佛国画，偏爱空白，也颇留意趣。有时有一群飞鸟循声觅食，在夕阳里，徒留几声凄清的脆鸣，袅袅于空谷山间。\n\n\n\n* * *\n\n## 2019.8.18 ##\n行驶在独库公路上才能感到真正的孤独，裸露的岩壁，空无一人的公路，满是落石的路基。在这里，每一块岩石都在诉说这不同的故事。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0633.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0633.JPG) 雪山半掩琵琶半遮面似得躲在云层后面，不由得增加了几分神秘感。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0648.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0648.JPG) 在这条一天可以体验四季的路上，每一个峰回路转都有别样的一番景致，正如移步换景一般，上一帧还是深不见底大峡谷，下一帧就变成了沟壑纵横的雪山。从针叶林到高山草甸再到雪线......甚是迷人。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0644.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0644.JPG) 翻越雪山，一扫之前裸露的岩石滩，取而代之的是那郁郁葱葱的高山草甸，那是天公的神来之笔，满眼的苍翠从眼前开始延伸，直至渺远的他方，我想它可能是上苍对人世浮沉的些微怜悯。而那悠然的牛羊带着那偶尔露怯的眼神，惊慌地穿过公路，晃悠悠朝着远处走去，印着薄日的光，留下几个淡淡背影……极目远眺，那是修建独库公路的人在这片荒凉的土地挥着汗洒下泪，而我此时正踏在祖国的这方土地之上，闻着这方泥土淳朴的芬芳，我想那当是工人们灵魂的芬芳。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0695.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0695.JPG)\n\n\n\n* * *\n\n## 2019.8.19 ##\n再次飞驰在独库公路上，太阳渐渐地从云层后露了出来，晨曦撒在远处巍峨的雪山上，犹如戴上了金顶。远山层峦叠起，草地色泽丰富，湖泊清如明镜，牛羊马儿悠闲自得。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0755.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0755.JPG) 平直的公路，向前飞驰的轿车，耳边呼呼的风声，再一次把我们带入雪山，驶向南疆，太阳又羞答答地躲在了云层之后。延绵的山路像绸带一般缠绕在延绵的雪上。 海拔一点点上升，车外气温一点点下降，我们距离雪线的距离也越来越近。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0816.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0816.JPG) 越过雪线，翻过那重峦叠嶂，气势滂沱的天山山脉，又是延绵不断的下坡路，但是景致与北疆截然不同：这些“远看成岭侧成峰，远近高低各不同”的红色岩壁，静静的屹立在广袤的戈壁滩上，那是一种岑峦迭起的壮丽，是一种傲风凌雪的气度，更是一种气定山河的坦荡。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0846.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0846.JPG) 库车大峡谷集雄、静、险、幽、神为一体，无不赞美叫绝。两侧红色峡谷陡峭险峻，谷内蜿蜒曲折、幽静深邃。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0868.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0868.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0864.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0864.JPG) 再折回，天气如同孩子似得，豆大的雨点从天上打下来。再向前，翻回之前的雪山。随着海拔的再次上升，豆大的雨点变成了鹅毛一般的大雪。穿出隧道，雪花如同幕布一样飘落。在这里我终于体验到了千里冰封万里雪飘的北国风光。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0921.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0921.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0954.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0954.JPG)\n\n\n\n* * *\n## 2019.8.20 ##\n那拉提在准噶尔蒙古语中意为“最先见到太阳的地方” 挺拔的胡杨，环绕的山峦，哈萨克牧民的毡房，成群的牛羊，无不被它的美丽所震撼。 向前远眺，一望无际的草原，牛羊成群，骏马飞腾，哈萨克牧民那纯白的毡房点缀其间；路边各色的野花，风吹过沙沙作响，及腰的野草…… “天苍苍，野茫茫，风吹草低见牛羊”好像就是为那拉提所写。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0998.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_0998.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1057.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1057.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1060.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1060.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1063.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1063.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1197.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1197.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1208.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1208.JPG) [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1217.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1217.JPG)\n\n\n\n* * *\n## 2019.8.21 ##\n雪白的云朵装着天空那无边的喜悦，如同棉花糖一般轻飘飘地浮游飘动着，恍若触手可及，在明净的天边演绎着斑斓的人生，千姿百态。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1282.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1282.JPG) 八卦城，相对称的结构，如同八卦一般放射状圆形的布局，街道如神奇迷宫般，街街相通，路路相连，极具有神秘色彩。相传乌孙王建城时，以太极坛为中心，八匹马朝着八个方向规划，形成一个八卦形态。 [![](https://image.krunk.cn/images/2020/08/30/20b5f65246814ef9a457cb0caefd5b3f.jpg)](https://image.krunk.cn/images/2020/08/30/20b5f65246814ef9a457cb0caefd5b3f.jpg)\n\n\n![](https://history.whrblog.online/2019/04/07/image-bed-1/07-89.JPG)\n\n![](https://image-cdn.krunk.cn/images/2019/10/16/IMG_1394-Panorama_zip2.jpg)\n\n![](https://history.whrblog.online/2019/04/07/image-bed-1/33-29.JPG)\n\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: 'ce5721b904a63fa5',\n    autoPlay: false\n});\n</script>\n\n* * *\n## 2019.8.22 ##\n夏塔清丽开阔的雪山下，留有着小溪飞扬的身姿，潺潺的流水声在讲述着乌孙古道当年的辉煌。![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1451.JPG)在峡谷中穿行，云卷云舒，光影似武，天山山脉木扎特峰在蓝天下呈现，雪山一面，不枉此行。雪山仿佛近在咫尺，又远在天边。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1465.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1465.JPG) \n\n![](https://i.loli.net/2021/11/02/YPQjd6ftzu9gyHF.jpg)\n\n* * *\n<div id=\"player\"></div>\n<script type=\"text/javascript\" src=\"https://player.dogecloud.com/js/loader\"></script>\n<script type=\"text/javascript\">\nvar player = new DogePlayer({\n    container: document.getElementById('player'),\n    userId: 1131,\n    vcode: '961672c8bb686a62',\n    autoPlay: false\n});\n</script>\n\n抬头，漆黑的幕布上，偶尔璀璨的星辰在倾诉北疆之夜的寂寥。它闪屏一般地规律眨眼，像极了梵高笔下一帧又一帧变化流淌的罗纳河上的星夜，偌大的夜晚只有漫天的星辰懂得它的黑。而今，这样一望无际的夜空里，我猜测大概是藏着上帝对漫漫人世羞赧的怜悯与深沉的爱，让它在深刻的色调里走向永恒，正印证了那句话：每个人的心里都有一团火，路过的人只看到烟。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1583.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1583.JPG)\n\n\n\n* * *\n## 2019.8.23 ##\n八月末的赛里木湖送走了酷暑难耐的夏天，迎来了凉风习习的秋天。寒风起草地黄，应了这句话，这正是一个青黄不接的的季节，白天的日照依旧如往常强烈，而下车时身上携带的热量，经不住湖畔的大风之来势，三两下的吹拂便随之消弭殆尽，只剩下了丝丝凉意不住地往袖口里钻。八月末的赛里木湖周边的景致也略显单薄。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1721.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1721.JPG)\n\n[![大风扬积雪击面](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1813.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1813.JPG) 高原地区，气候出乎意料的多变，正如“东边日出西边雨”，穿越云雨区，阳光依旧。 [![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1825.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1825.JPG) 夕阳慢慢移到了山的后方，光影随时间一分一秒地更迭，暗蓝的天空和旖旎的晚霞流光溢彩，这是夕阳跌落于地平线前给予世人最后的馈赠。\n\n[![](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1918.JPG)](https://p.whrblog.online/2019/07/04/IMAGE-BED-1/IMG_1918.JPG)\n\n* * *\n","tags":["Date","摄影","行者笔记"],"categories":["uncategorized"]},{"title":"树莓派+SSD1306屏幕","url":"/2019/08/07/树莓派ssd1306屏幕/","content":"\n[![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_165053.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_165053.jpg)\n<!-- more -->\n# 启用树莓派的I2C功能\n\nsudo apt-get install -y python-smbus\nsudo apt-get install -y i2c-tools\nsudo raspi-config\n\nInterfacing Options-->I2C-->enable\n\n* * *\n\n# 安装库文件\n\nsudo python -m pip install --upgrade pip setuptools wheel\n\nPIL 库\n\nsudo apt-get install python-pil python3-pil\n\nAdafruit-SSD1306 库\n\ngit clone https://github.com/adafruit/Adafruit\\_Python\\_SSD1306.git\n\n* * *\n\n# 连接屏幕\n\n[![](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1565147846250&di=7ee10e48ad53b034f6f3effa0257bba9&imgtype=0&src=http%3A%2F%2Fupload.semidata.info%2Fnew.eefocus.com%2Farticle%2Fimage%2F2019%2F01%2F11%2F5c380a5770ccf.jpg)](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1565147846250&di=7ee10e48ad53b034f6f3effa0257bba9&imgtype=0&src=http%3A%2F%2Fupload.semidata.info%2Fnew.eefocus.com%2Farticle%2Fimage%2F2019%2F01%2F11%2F5c380a5770ccf.jpg) 屏幕 GND 接树莓派 GND 屏幕 VCC 接树莓派 3V3 屏幕 SDA 接树莓派 SDA 屏幕 SCL 接树莓派 SCL\n\n* * *\n\n# 检测是否识别到 I2C 设备\n\nsudo i2cdetect -y 1\n\n# 运行\n\n在之前克隆的代码中包含了可以直接运行的示例源码\n\nsudo nano ~/Adafruit\\_Python\\_SSD1306/examples/stats.py\n\n修改屏幕类型\n\n\\# 128x32 display with hardware I2C:\n# disp = Adafruit\\_SSD1306.SSD1306\\_128\\_32(rst=RST)\n \n# 128x64 display with hardware I2C:\ndisp = Adafruit\\_SSD1306.SSD1306\\_128\\_64(rst=RST)\n \n# Note you can change the I2C address by passing an i2c\\_address parameter like:\n# disp = Adafruit\\_SSD1306.SSD1306\\_128\\_64(rst=RST, i2c\\_address=0x3C)\n\n运行\n\nsudo python  ~/Adafruit\\_Python\\_SSD1306/examples/stats.py\n\n[![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_161202.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_161202.jpg)\n\nsudo python ~/Adafruit\\_Python\\_SSD1306/examples/image.py\n\n[![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_161458.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190804_161458.jpg)","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"树莓派lot=Node.js+Bylnk+DHT11/DHT22","url":"/2019/07/30/树莓派node-jsbylnk-appdht11-dht22-am2302/","content":"\n# [![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190731_160014.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_20190731_160014.jpg)\n<!-- more -->\n# 安装npm及Bylnk库\n\n \n\nsudo apt install npm -y\nsudo apt-get install build-essential\nsudo npm install -g npm\nsudo npm install -g onoff\nsudo npm install -g blynk-library\n\n# 安装传感器库\n\n*   [bcm2835库](http://www.airspayce.com/mikem/bcm2835/)\n*   [node-dht-sensor](https://github.com/momenso/node-dht-sensor) npm包\n\nwget http://www.airspayce.com/mikem/bcm2835/bcm2835-1.46.tar.gz\ntar zxvf bcm2835-1.46.tar.gz\ncd bcm2835-1.46\n./configure\nmake\nsudo make check\nsudo make install\nsudo npm install -g node-dht-sensor\n\n#  连接传感器\n\n*   GND至GND\n*   DAT信号到GPIO7\n*   VCC至3.3v\n\n# 创建可执行文件\n\ncd ~\ngit clone https://github.com/wanghurui/Blynk-dht11-22.git\n\n或者\n\nvar blynkLib = require('blynk-library');\nvar sensorLib = require('node-dht-sensor');\n\nvar AUTH = 'YOUR\\_AUTH\\_TOKEN';\n\n// Setup Blynk\nvar blynk = new blynkLib.Blynk(AUTH);\n\n// Setup sensor, exit if failed\nvar sensorType = 11; // 11 for DHT11, 22 for DHT22 and AM2302\nvar sensorPin  = 4;  // The GPIO pin number for sensor signal\nif (!sensorLib.initialize(sensorType, sensorPin)) {\n    console.warn('Failed to initialize sensor');\n    process.exit(1);\n}\n\n// Automatically update sensor value every 2 seconds\nsetInterval(function() {\n    var readout = sensorLib.read();\n    blynk.virtualWrite(3, readout.temperature.toFixed(1));\n    blynk.virtualWrite(4, readout.humidity.toFixed(1));\n    \n    console.log('Temperature:', readout.temperature.toFixed(1) + 'C');\n    console.log('Humidity:   ', readout.humidity.toFixed(1)    + '%');\n}, 2000);\n\n将**YOUR\\_AUTH\\_TOKEN**替换为App中的令牌。\n\nsudo NODE\\_PATH =/usr/local/lib/node\\_modules node ./blynk-sensor-test.js\n\n输出应如下所示\n\nOnOff mode\nConnecting to TCP: cloud.blynk.cc 8442\nConnected\nTemperature: 18.0C\nHumidity:    26.0%\nTemperature: 18.0C\nHumidity:    26.0%\n\n可以使用pm2将此程序放在后台守护进程并且开机自启动\n\nnpm install -g pm2\nsudo NODE\\_PATH=/usr/local/lib/node\\_modules pm2 start ./blynk-sensor-test.js\nsudo pm2 save\nsudo pm2 startup\n\n  [![](https://history.whrblog.online/2019/04/07/image-bed-1/20190730071339.png)](https://history.whrblog.online/2019/04/07/image-bed-1/20190730071339.png)","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"2019.7.19","url":"/2019/07/20/2019-7-19/","content":"\n## 何谓友情？何谓缘分？\n\n* * *\n<!-- more -->\n是离别时远隔重洋却心照不宣的默契，是多年来老旧相片里昔日光景的纪念，是与你聊的同一话题时一起旁若无人的开怀大笑，是茫茫人海行色匆匆里曾经彼此熟悉的身影…… 青春的颜色，是真情的颜色；相聚总是太少，真情总被无情错过。 希望多年以后，你仍然能在别人面前自豪的说出：“我是你的朋友”。\n\n* * *\n\n[![](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150444.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150444.jpg) [![](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150244.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150244.jpg) [![](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150439.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150439.jpg) [![](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150314.jpg)](https://history.whrblog.online/2019/04/07/image-bed-1/20190720150314.jpg)\n\n* * *\n\n2019.7.20\n\nWhr","tags":["Date","Hexo","Friends","R.C"],"categories":["uncategorized"]},{"title":"2019.6.29 大嵛山岛笔记","url":"/2019/06/30/2019-6-29-大嵛山岛笔记/","content":"\n大嵛山岛----是闽东最大的列岛，是一个坐落在福鼎东南海域，距离三沙古镇港5海里，他由大嵛山、小嵛山、鸳鸯岛、银屿等十一个大小岛屿组成，大嵛山岛曾被中国国家地理”杂志社评为“中国最美的地方”中“最美的海岛”第八名。其山、湖、草、海在此浓缩。天湖四周山坡平缓，是有“南国天山”之誉的万亩草场。\n\n嵛山岛地理位置特殊，扼闽浙海路之咽喉，是南来北往船只的必经之道，战略意义重大。明朝时期为抵御倭寇骚扰，1389年明政府在嵛山岛设置军事要塞，归北路福宁卫烽火寨管辖，1592年改守备为参将、节制水陆，改中军为嵛山游。清代中叶，嵛山列岛是蔡牵海上起义活动的重要根据地。辛亥革命先驱朱腾芬先生也在此组织义军抗清。\n<!-- more -->\n山势回环，路随山转，岛上的旅游巴士在这蜿蜒曲折的山路上飞驰着。随着海拔的增高，视线内的景物也随之变化，从灌木丛变成了高山草甸，从涓涓的小溪变成了气势滂沱的瀑布。旅游巴士一路颠簸，我们眼中摇摇晃晃的崎岖山路里承载的尽是一行人无尽的好奇与向往，我们驻足停留来到了山腰。[![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0199.JPG)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0199.JPG) 刚涉足这片陌生的土地，无比沉闷的湿气里一股沁人心脾草籽的清香扑面而来 我们沿着盘山步道一点一点向大嵛山山顶登去。我们行走在山脊上，缭绕的雾气被山顶的强风吹散，呼吸着雾气特有的味道，藏在雾霭中的两个天池逐渐拭去混沌，越发清冽。 [![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0265.JPG)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0265.JPG) 天池周围群峰环拱，其状似盂，这可能就是嵛山岛名字的来源吧。在这里恍若置身于“天苍苍，野茫茫，风吹草低见牛羊”的大西北草原。如果不是我们来这里旅行，难以想象在碧波万顷的东海之上竟有如此风云奇诡的意境。 [![](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0227.JPG)](https://history.whrblog.online/2019/04/07/image-bed-1/IMG_0227.JPG) 我极目远眺，它拼命掩面，半伏半隐，挣扎着躲进袅袅的雾霭中去。潮湿的季风将山间的云雾升腾出如海市蜃楼的形状；蓝天上，是上帝的一半明媚一半忧伤。山峦间，是悠悠的水，袅袅的烟，静静的谱写着属于大嵛山的歌……  \n\n2019.6.29","tags":["Date","摄影","行者笔记","Hexo"],"categories":["uncategorized"]},{"title":"用WP-CLI给WordPress更换域名","url":"/2019/03/02/用wp-cli给wordpress更换域名/","content":"\nwp-cli 是一个命令行工具，可以让我们通过命令行安装、更新 WordPress，对 WordPress 执行一些批量操作，响应速度快，使用方便\n<!-- more -->\n![](https://history.whrblog.online/2019/04/07/image-bed-1/kqSUFU.png)\n\n## 安装 wp-cli 工具\n\ncurl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar\nchmod +x wp-cli.phar\nsudo mv wp-cli.phar /usr/local/bin/wp\n\n## 搜索替换 WordPress 数据库中的域名\n\nwp-cli 工具为我们提供了一个搜索替换数据库中字符的命令，**直接在 WordPress 的根目录执行**以下命令即可完成更换 WordPress 域名的操作，该命令支持一些选项方便我们自定义操作，具体查看 wp search-replace 命令的官方说明。\n\nwp search-replace 'old.com' 'new.com'","tags":["IT","折腾","Wordpress"],"categories":["uncategorized"]},{"title":"小米路由器mini/mini青春版 刷入Openwrt固件","url":"/2019/02/19/小米路由器mini刷入lean-r9-1-1固件/","content":"\n[![mmexport1552791022636.jpg](https://history.whrblog.online/2019/04/07/image-bed-1/5c8db64171e04.jpg \"mmexport1552791022636.jpg\")](https://history.whrblog.online/2019/04/07/image-bed-1/5c8db64171e04.jpg)\n\n1.  刷开发版\n2.  打开ssh\n3.  刷入breed\n4.  刷入固件\n\n* * *\n<!-- more -->\n# 0.1小米路由器刷入开发版\n\n## 小米路由器mini\n\n在MiWiFi官网[www.miwifi.com](www1.miwifi.com)，下载 ROM Mini的开发版,下载完毕后放入fat32格式U盘下的根目录，并将包名改为miwifi.bin 断开路由器的电源，将U盘插入路由器的USB接口，用细长的工具按住reset后，接通电源，待路由器指示灯变为黄灯闪烁时，松开reset。 大约3-5分钟后，指示灯变成黄色常亮状态时可以拔掉U盘，此时刷机已经完成正在重启，稍等片刻路由器指示灯变蓝就可以正常使用了。\n\n## 小米路由器mini青春版\n\n由于青春版没有usb的缺陷，只能使用后台的手动上传固件的方式进行刷入开发版 链接: [https://pan.baidu.com/s/1rG3qNVrbPKnj0G3orQU5Mg](https://pan.baidu.com/s/1rG3qNVrbPKnj0G3orQU5Mg) 提取码: i422 下载旧版本的青春版开发版，在后台“常用设置” -->“系统状态”-->“手动上传更新包”完成刷机\n\n* * *\n\n# 0.2开启路由器ssh\n\n将小米路由器插上电源，这里不要让小米路由器联网（不需要小米路由器的Internet口连接另一台路由器的LAN口），连接小米路由器WiFi，打开后台页面[192.168.31.1](192.168.31.1)，配置小米路由器工作模式为“普通路由器工作模式”应该是默认，并且配置WiFi密码以及后台登录密码。 登录后台，在登录后可以在首页上看到小米路由器的sn，通过sn查询路由器ssh登录密码。 用一台可以联网的设备打开[http://www.iptvfans.cn/miwifi/passwd](http://www.iptvfans.cn/miwifi/passwd)复制sn到查询框中即可获取登录密码\n\n![kg4mvQ.png](https://history.whrblog.online/2019/04/07/image-bed-1/kg4mvQ.png)\n\n打开终端：\n\n*   windows下推荐使用putty，在IP处填入小米路由器的ip，也就是192.168.31.1其他不动。然后会弹出一个关于密匙的窗口，点击yes即可。log as后填写root password是之前查询的密码。![mmexport1552791038364.jpg](https://history.whrblog.online/2019/04/07/image-bed-1/5c8db641deadc.jpg \"mmexport1552791038364.jpg\")\n*   Mac OS下的终端可以参考这个[https://jingyan.baidu.com/article/f3e34a1289cda3f5eb6535c0.html](https://jingyan.baidu.com/article/f3e34a1289cda3f5eb6535c0.html)在终端中输入\n    \n    ssh root@192.168.31.1\n    \n    并按下回车后同windows\n\n* * *\n\n# 1.0全盘备份\n\n插入U盘并新建文件夹（青春版请跳过）\n\ncd /extdisks/sda1\nmkdir xiaomi\\_rom\\_backup\n\n备份\n\ncat /proc/mtd\n\n![kg7tBQ.png](https://history.whrblog.online/2019/04/07/image-bed-1/kg7tBQ.png)\n\ndd if=/dev/mtd0 of=/extdisks/sda1/xiaomi\\_rom\\_backup/all.bin\ndd if=/dev/mtd1 of=/extdisks/sda1/xiaomi\\_rom\\_backup/bootloader.bin\ndd if=/dev/mtd2 of=/extdisks/sda1/xiaomi\\_rom\\_backup/config.bin\ndd if=/dev/mtd3 of=/extdisks/sda1/xiaomi\\_rom\\_backup/factory.bin\ndd if=/dev/mtd4 of=/extdisks/sda1/xiaomi\\_rom\\_backup/os1.bin\ndd if=/dev/mtd5 of=/extdisks/sda1/xiaomi\\_rom\\_backup/rootfs.bin\ndd if=/dev/mtd6 of=/extdisks/sda1/xiaomi\\_rom\\_backup/os2.bin\ndd if=/dev/mtd7 of=/extdisks/sda1/xiaomi\\_rom\\_backup/overlay.bin\ndd if=/dev/mtd8 of=/extdisks/sda1/xiaomi\\_rom\\_backup/crash.bin\ndd if=/dev/mtd9 of=/extdisks/sda1/xiaomi\\_rom\\_backup/reserved.bin\ndd if=/dev/mtd10 of=/extdisks/sda1/xiaomi\\_rom\\_backup/bdata.bin\n\n如果是青春版的话请执行\n\ndd if=/dev/mtd0 of=/tmp/all.bin\ndd if=/dev/mtd1 of=/tmp/bootloader.bin\ndd if=/dev/mtd2 of=/tmp/config.bin\ndd if=/dev/mtd3 of=/tmp/factory.bin\ndd if=/dev/mtd4 of=/tmp/os1.bin\ndd if=/dev/mtd5 of=/tmp/rootfs.bin\ndd if=/dev/mtd6 of=/tmp/os2.bin\ndd if=/dev/mtd7 of=/tmp/overlay.bin\ndd if=/dev/mtd8 of=/tmp/crash.bin\ndd if=/dev/mtd9 of=/tmp/reserved.bin\ndd if=/dev/mtd10 of=/tmp/bdata.bin\n\n备份完成后请及时使用winscp把备份文件拷出，避免刷breed时内存不足导致路由器变砖。 输出应该是这样的\n\nroot@XiaoQiang:~# dd if=/dev/mtd0 of=/extdisks/sda1/xiaomi\\_rom\\_backup/all.bin\n32768+0 records in\n32768+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd1 of=/extdisks/sda1/xiaomi\\_rom\\_backup/bootloader.bin\n384+0 records in\n384+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd2 of=/extdisks/sda1/xiaomi\\_rom\\_backup/config.bin\n128+0 records in\n128+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd3 of=/extdisks/sda1/xiaomi\\_rom\\_backup/factory.bin\n128+0 records in\n128+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd4 of=/extdisks/sda1/xiaomi\\_rom\\_backup/os1.bin\n25600+0 records in\n25600+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd5 of=/extdisks/sda1/xiaomi\\_rom\\_backup/rootfs.bin\n22716+1 records in\n22716+1 records out\nroot@XiaoQiang:~# dd if=/dev/mtd6 of=/extdisks/sda1/xiaomi\\_rom\\_backup/os2.bin\n4096+0 records in\n4096+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd7 of=/extdisks/sda1/xiaomi\\_rom\\_backup/overlay.bin\n2048+0 records in\n2048+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd8 of=/extdisks/sda1/xiaomi\\_rom\\_backup/crash.bin\n128+0 records in\n128+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd9 of=/extdisks/sda1/xiaomi\\_rom\\_backup/reserved.bin\n128+0 records in\n128+0 records out\nroot@XiaoQiang:~# dd if=/dev/mtd10 of=/extdisks/sda1/xiaomi\\_rom\\_backup/bdata.bin\n128+0 records in\n128+0 records out\n\n* * *\n\n# 1.1刷入Bootloader\n\ncd /tmp\n\n在电脑上下载好小米路由器mini专用的breed[https://breed.hackpascal.net/breed-mt7620-xiaomi-mini.bin](https://breed.hackpascal.net/breed-mt7620-xiaomi-mini.bin)使用scp工具拷入路由器的/tmp目录中 青春版请使用https://breed.hackpascal.net/breed-mt7688-reset38.bin\n\n*   windows下使用winscp\n*   MacOS/unix/linux使用shell里的scp命令\n*   密码还是之前sn查询的密码\n\nLinux/Unix下详细命令\n\ncd /tmp\nwget https://breed.hackpascal.net/breed-mt7620-xiaomi-mini.bin\nscp ./breed-mt7620-xiaomi-mini.bin root@192.168.31.1:/tmp\n\n刷入Bootloader\n\nmtd -r  write /tmp/breed-mt7620-xiaomi-mini.bin Bootloader\n\n* * *\n\n# 1.2刷入固件\n\n## mini\n\n下载固件[https://1jjklacnz-my.sharepoint.com/personal/alog\\_1\\_jjkl\\_ac\\_nz/\\_layouts/15/download.aspx?share=ETxwSwq7ms9JoISMXlZpPB8BtTJ8lBaX270VraNKh3ZBTA&ithint=.bin](https://1jjklacnz-my.sharepoint.com/personal/alog_1_jjkl_ac_nz/_layouts/15/download.aspx?share=ETxwSwq7ms9JoISMXlZpPB8BtTJ8lBaX270VraNKh3ZBTA&ithint=.bin)\n\n## 青春版\n\n下载固件https://drive.google.com/file/d/1b-PJ9C1JQWO0\\_gmVWNgFckuEbS43eM97/view?usp=sharing 断电关闭路由器 更改电脑适配器设置，并设置IPv4：IP是192.168.1.2，子网掩码：255.255.255.0，默认网关：192.168.1.1 捅路由器上的reset键开机，过一会浏览器打开192.168.1.1，上传你下载的固件。 ![kgbVdH.jpg](https://history.whrblog.online//2019/04/07/image-bed-1/kgbVdH.jpg) ![kgbEee.jpg](https://history.whrblog.online/2019/04/07/image-bed-1/kgbEee.jpg) 刷入方法可以借鉴一下我的[TPlink842硬改篇](http://www.whrblog.online/archives/1111) 等待刷完之后手动重启路由器，打开后台界面后台IP： 192.168.1.1 用户名：root或者是admin 密码： password 你成功打开了新世界的大门","tags":["IT","Linux","miwifi","折腾"],"categories":["uncategorized"]},{"title":"TP link 842 v4.4硬改手记","url":"/2019/01/21/tp-link-842-v4-4硬改手记/","content":"\nTPlink家族的路由器都有一个很大的问题，新路由器买回来十分好用，在用了几年之后各种卡网，各种宕机......早在一年前就萌生了硬改的想法，只是一直忙于学业😌😌😌\n\n* * *\n<!-- more -->\n趁着刚考完试的闲暇时间，买来了flash，ddr和编程器。买的时候犯了一个大错误-\\_-，买flash没有查手册，看着w25q32v以为是32m的flash就下单了，在快递回来的几天左思右想找不到32m的固件，还去论坛询问，后来查手册才发现是4m的flash，可玩性大大降低了。(︶^︶)\n\n* * *\n\n# 0x01\n\n某宝上购买了两块winbond的W25Q32V的flash和HY64的DDR内存，还有一个CH341A的编程器。开始吐槽编程器，有一个晶振竟然是虚焊的，差评...... ![kPbopd.jpg](https://history.whrblog.online/2019/04/07/image-bed-1/kPbopd.md.jpg?raw=true) ![kPqVNF.jpg](https://history.whrblog.online/2019/04/07/image-bed-1/kPqVNF.md.jpg?raw=true)\n\n* * *\n\n# 0x02\n\n开始烧固件，系统是windows7 x64，没有出现不兼容的情况。刷入大H的breed，并在0001fc00写入在路由器背面的MAC地址，不然连网络都没有。店家给的转接板也不能用，无奈用手把flash摁在编程器上4分钟，刷了两次才成功，第一次手抖了一下卡在了83%，回想起论坛上各种spi flash坏道导致的问题，一阵阵冷汗不由自主地冒了出来。 还好没有什么大碍，又读了出来，摁的4分钟刷刷网页很快就过去了，手摁得有点僵，再一次差评.... ![](https://history.whrblog.online/2019/04/07/image-bed-1/kitSw4.md.png)\n\n* * *\n\n# 0x03\n\n把这个66脚的ddr焊到主板上去，我承认我是在外面找人焊的，这个对我来说太困难了，哪怕焊上去也是灯全部亮，系统没有反应，更可能的是焊盘掉了两三个，路由器废了。 后果.jpg ![k3j6II.jpg](http://history.whrblog.online/2019/04/07/image-bed-1/k3j6II.jpg)\n\n* * *\n\n# 0x04\n\n在电脑段设置静态ip，ip地址为192.168.1.1，掩码为255.255.255.0，网关为192.168.1.1 在路由器上电开机前，捅住restart，接上电源，当看到LED灯全部亮起后闪了一下松开，打开浏览器访问192.168.1.1，不出意外的情况下就是之前刷好的breed了 ![kitpTJ.md.png](https://history.whrblog.online/2019/04/07/image-bed-1/kitpTJ.md.png) 在固件中心刷入openwrt固件和art无线修正固件，刷入速度极快。openwrt固件用了恩山AndyX大神的4m精简固件[OpenWrt/LEDE 4M精简迷你固件-Luci界面-SFE加速-SQM分配-UPNP-IPv6-VLAN支持-WIFI计划](https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=270339) art无线修正的文件我上传到了git上[https://github.com/wanghurui/Router-art-firmware](https://github.com/wanghurui/Router-art-firmware) ![](https://history.whrblog.online/2019/04/07/image-bed-1/kiYvOU.md.png) SFE效果如下图，本地网速几乎增加了1m/s ![](https://history.whrblog.online/2019/04/07/image-bed-1/kmDnmD.jpg)\n\n* * *\n\n# 0x05\n\n激动人心的时刻，刷完后的自动重启，在等了大概30s后跳出了下面这个页面 ![kiYjyT.png](https://history.whrblog.online/2019/04/07/image-bed-1/kiYjyT.png) 下图为Luci界面 ![kitPYR.md.png](https://history.whrblog.online//2019/04/07/image-bed-1/kitPYR.md.png) 在刷了机之后，无线性能只能用时间去测量它，掉线的情况应该少了，在家里的Xiaomi TV上测出来的峰值网速可以有5m/s，对于30m的有线通宽带已经心满意足了。 ![kitCk9.png](https://history.whrblog.online/2019/04/07/image-bed-1/kitCk9.png) 由于内存只有4m，而且刷完了之后只有150+k可以使用，一开始想在路由器上实现smartdns和koolproxy的都因为内存不足而放弃。不过我觉得在/tmp目录安装opkg和软件很ok😹😹😹\n\n# 0x06 Bugs\n\n貌似Andy X的固件crontab有问题：我正确配置了crontab设置了每天6点自动重启，可是没有一次成功😐\n\nWed May 29 06:00:43 2019 daemon.info hostapd: wlan0: STA 68:db:ca:23:1f:71 WPA: group key handshake completed (RSN)\nWed May 29 06:00:43 2019 daemon.info hostapd: wlan0: STA b0:65:bd:68:1a:9c WPA: group key handshake completed (RSN)","tags":["IT","Linux","折腾"],"categories":["uncategorized"]},{"title":"Monlor tools 2.0","url":"/2018/11/09/1017/","content":"\n工具箱2.0已经比较完善了, 出于学习的目的, 想重新写新的工具箱, 尝试支持更多的固件. 现有工具箱处于维护状态, 有严重bug可能会更新解决一下.\n<!-- more -->\n如果Koolshare大佬们写的软件中心2.0有希望能移植到小米路由器, 也可以考虑移植而不开发新的工具箱. ![工具箱界面](https://www.monlor.com/images/180727-1.png)\n\n> 工具箱正处于测试状态，安装需要有一定的动手能力。 支持以下的路由器，arm路由: R1D R2D R3D，mips路由: R3 R3P R3G R1CM 目前支持了以下几种插件:\n\n> 1.  [ZeroTier](https://www.zerotier.com)\n> 2.  [KoolProxy](http://koolshare.b0.upaiyun.com/)\n> 3.  [Aria2](http://aria2.github.io/)\n> 4.  [VsFtpd](https://security.appspot.com/vsftpd.html)\n> 5.  [kms](https://github.com/Wind4/vlmcsd)\n> 6.  [Frpc](https://github.com/fatedier/frp)\n> 7.  [Ngrok](https://github.com/dosgo/ngrok-c)\n> 8.  [WebShell](https://github.com/shellinabox/shellinabox)\n> 9.  [TinyProxy](https://github.com/tinyproxy/tinyproxy)\n> 10.  [Entware](https://github.com/Entware/Entware-ng)\n> 11.  [KodExplorer](https://kodcloud.com/)\n> 12.  [EasyExplorer](http://koolshare.cn/thread-129199-1-1.html)\n> 13.  [HttpFile](http://nginx.org/)\n> 14.  [VerySync](http://verysync.com/)\n> 15.  [FastDick](https://github.com/fffonion/Xunlei-Fastdick)\n> 16.  [FireWall](https://www.netfilter.org/)\n> 17.  [JetBrains](http://blog.lanyus.com/archives/174.html)\n> 18.  [QianDao](http://koolshare.cn/thread-127783-1-1.html)\n> 19.  [FileBrowser](https://github.com/filebrowser/filebrowser)\n\n* * *\n\n### 安装方式\n\n#### 插件的安装\n\n1.  离线安装插件，`appmanage.sh add /tmp/kms.tar.gz`安装插件\n2.  在线安装插件，默认下载源coding.net，安装命令`appmanage.sh add kms`\n3.  monlor命令一键安装插件\\[推荐\\]\n\n#### 一键安装命令\n\n`curl -kfsSl https://coding.net/u/monlor/p/Monlor-Tools/git/raw/master/install.sh`\n\n* * *\n\n### 工具箱命令\n\n1.  卸载：`uninstall.sh` （不推荐）\n2.  更新：`update.sh [-f]` (不推荐)\n3.  初始化：`init.sh`\n4.  插件管理：`appmanage.sh addupgradedel appname [-f]`\n5.  工具箱配置：`monlor` (任意界面Ctrl + c可以退出配置)\n6.  在线更新：`sh -c \"$(curl -kfsSl $(uci get monlor.tools.url)/scripts/update.sh)\"`\n7.  在线卸载：`sh -c \"$(curl -kfsSl $(uci get monlor.tools.url)/scripts/uninstall.sh)\"`\n\n* * *\n\n### 目录结构\n\n```\n/\n```\n\n* * *\n\n### 注意事项\n\n1.  如果插件和工具箱都有更新，请务必先更新工具箱！\n2.  工具箱没有web界面，完全靠Shell开发，插件的安装、卸载、配置由配置文件完成。\n3.  安装完成后执行monlor命令配置工具箱，Ctrl + c或者输入exit可以退出。\n4.  关于迅雷快鸟FastDick，请按[Xunlei-Fastdick](https://github.com/fffonion/Xunlei-Fastdick)这里的教程运行swjsq.py并找到运行成功后生成的swjsq\\_wget.sh文件，提取里面的uid,pwd,peerid即可。\n5.  插件列表显示异常运行`rm -rf $(uci get monlor.tools.path)/config/applist.txt`，运行monlor会自动获取插件列表\n6.  提问前请指出你的路由器型号，工具箱版本。如果是插件问题运行`cat /var/log/appname*`命令提交日志给我(appname为插件名，部分插件没有日志)\n\n### Monlor tools已经不再更新，最新工具箱请移步到[http://blog.whrblog.online/archives/1093](http://blog.whrblog.online/archives/1093)","tags":["IT","Linux","miwifi"],"categories":["uncategorized"]},{"title":"SmartDNS","url":"/2018/11/03/smartdns/","content":"\n![](http://https://pymumu.github.io/smartdns/doc/smartdns-banner.png) SmartDNS是一个运行在本地的DNS服务器，SmartDNS接受本地客户端的DNS查询请求，从多个上游DNS服务器获取DNS查询结果，并将访问速度最快的结果返回个客户端，避免DNS污染，提高网络访问速度。\n<!-- more -->\n同时支持指定特定域名IP地址，并高性匹配，达到过滤广告的效果。 与dnsmasq的all-servers不同，smartdns返回的是访问速度最快的解析结果。 支持树莓派，openwrt，华硕路由器等设备。\n\n## 软件效果展示\n\n**阿里DNS** 使用阿里DNS查询百度IP，并检测结果。\n\n```\npi@raspberrypi:~/code/smartdns_build $ nslookup www.baidu.com 223.5.5.5\nServer:         223.5.5.5\nAddress:        223.5.5.5#53\n\nNon-authoritative answer:\nwww.baidu.com   canonical name = www.a.shifen.com.\nName:   www.a.shifen.com\nAddress: 180.97.33.108\nName:   www.a.shifen.com\nAddress: 180.97.33.107\n\npi@raspberrypi:~/code/smartdns_build $ ping 180.97.33.107 -c 2\nPING 180.97.33.107 (180.97.33.107) 56(84) bytes of data.\n64 bytes from 180.97.33.107: icmp_seq=1 ttl=55 time=24.3 ms\n64 bytes from 180.97.33.107: icmp_seq=2 ttl=55 time=24.2 ms\n\n--- 180.97.33.107 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 24.275/24.327/24.380/0.164 ms\npi@raspberrypi:~/code/smartdns_build $ ping 180.97.33.108 -c 2\nPING 180.97.33.108 (180.97.33.108) 56(84) bytes of data.\n64 bytes from 180.97.33.108: icmp_seq=1 ttl=55 time=31.1 ms\n64 bytes from 180.97.33.108: icmp_seq=2 ttl=55 time=31.0 ms\n\n--- 180.97.33.108 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 31.014/31.094/31.175/0.193 ms\n```\n\n**smartdns** 使用SmartDNS查询百度IP，并检测结果。\n\n```\npi@raspberrypi:~/code/smartdns_build $ nslookup www.baidu.com\nServer:         192.168.1.1\nAddress:        192.168.1.1#53\n\nNon-authoritative answer:\nwww.baidu.com   canonical name = www.a.shifen.com.\nName:   www.a.shifen.com\nAddress: 14.215.177.39\n\npi@raspberrypi:~/code/smartdns_build $ ping 14.215.177.39 -c 2\nPING 14.215.177.39 (14.215.177.39) 56(84) bytes of data.\n64 bytes from 14.215.177.39: icmp_seq=1 ttl=56 time=6.31 ms\n64 bytes from 14.215.177.39: icmp_seq=2 ttl=56 time=5.95 ms\n\n--- 14.215.177.39 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 5.954/6.133/6.313/0.195 ms\n\n```\n\n从对比看出，smartdns找到访问www.baidu.com最快的IP地址，这样访问百度比阿里DNS速度快5倍。\n\n## 特性\n\n1.  **多DNS上游服务器** 支持配置多个上游DNS服务器，并同时进行查询，即使其中有DNS服务器异常，也不会影响查询。\n2.  **返回最快IP地址** 支持从域名所属IP地址列表中查找到访问速度最快的IP地址，并返回给客户端，避免DNS污染，提高网络访问速度。\n3.  **支持非标准端口** 支持非53端口查询，支持TCP查询，有效避免DNS污染。\n4.  **特定域名IP地址指定** 支持指定域名的IP地址，达到广告过滤效果，避免恶意网站的效果。\n5.  **域名高性能后缀匹配** 支持域名后缀匹配模式，简化过滤配置，过滤20万条记录时间<1ms\n6.  **Linux多平台支持** 支持标准Linux系统（树莓派），openwrt系统各种固件，华硕路由器原生固件。\n7.  **支持IPV4, IPV6双栈** 支持IPV4，IPV6网络，支持查询A, AAAA记录。\n8.  **高性能，占用资源少** 多线程异步IO模式，cache缓存查询结果。\n\n## 架构\n\n \n\n1.  SmartDNS接收本地网络设备的DNS查询请求，如PC，手机的查询请求。\n2.  SmartDNS将查询请求发送到多个上游DNS服务器，可采用标准UDP查询，非标准端口UDP查询，及TCP查询。\n3.  上游DNS服务器返回域名对应的Server IP地址列表。SmartDNS检测与本地网络访问速度最快的Server IP。\n4.  将访问速度最快的Server IP返回给本地客户端。\n\n## 使用\n\n### 下载配套安装包\n\n* * *\n\n下载配套版本的SmartDNS安装包，对应安装包配套关系如下。\n\n系统\n\n安装包\n\n说明\n\n标准Linux系统(树莓派)\n\nsmartdns.xxxxxxxx.armhf.deb\n\n支持树莓派Raspbian stretch，Debian 9系统。\n\n标准Linux系统(x86\\_64)\n\nsmartdns.xxxxxxxx.x86\\_64..tar.gz\n\n支持x86\\_64系统。\n\n华硕原生固件(optware)\n\nsmartdns.xxxxxxx.mipsbig.ipk\n\n支持MIPS大端架构的系统，如RT-AC55U, RT-AC66U.\n\n华硕原生固件(optware)\n\nsmartdns.xxxxxxx.mipsel.ipk\n\n支持MIPS小端架构的系统，如RT-AC68U。\n\n华硕原生固件(optware)\n\nsmartdns.xxxxxxx.arm.ipk\n\n支持arm小端架构的系统，如RT-AC88U。\n\nopenwrt 15.01\n\nsmartdns.xxxxxxxx.ar71xx.ipk\n\n支持AR71XX MIPS系统。\n\nopenwrt 15.01\n\nsmartdns.xxxxxxxx.ramips\\_24kec.ipk\n\n支持MT762X等小端路由器\n\nopenwrt 15.01(潘多拉)\n\nsmartdns.xxxxxxxx.mipsel\\_24kec\\_dsp.ipk\n\n支持MT7620系列的潘多拉固件\n\nopenwrt LEDE\n\nsmartdns.xxxxxxxx.mips\\_24kc.ipk\n\n支持AR71XX MIPS系统。\n\nopenwrt LEDE\n\nsmartdns.xxxxxxxx.mipsel\\_24kc.ipk\n\n支持MT726X等小端路由器\n\nopenwrt LEDE\n\nsmartdns.xxxxxxxx.x86\\_64.ipk\n\n支持x86\\_64路由器\n\nopenwrt LEDE\n\nsmartdns.xxxxxxxxxxx.arm\\_cortex-a9.ipk\n\n支持arm A9核心CPU的路由器\n\nopenwrt LEDE\n\nsmartdns.xxxxxxxxx.arm\\_cortex-a7\\_neon-vfpv4.ipk\n\n支持arm A7核心CPU的路由器\n\nopenwrt LUCI\n\nluci-app-smartdns.xxxxxxxxx.xxxx.all.ipk\n\nopenwrt管理统一界面\n\n*   openwrt系统CPU架构比较多，上述表格未列出所有支持系统，请查看CPU架构后下载。\n*   merlin梅林固件理论和华硕固件一致，所以根据硬件类型安装相应的ipk包即可。（梅林暂时未验证，有问题提交issue）\n*   CPU架构可在路由器管理界面找到，查看方法： 登录路由器，点击`System`\\->`Software`，点击`Configuration` Tab页面，在opkg安装源中可找到对应软件架构，下载路径中可找到，如下，架构为ar71xx\n    \n    ```\n      src/gz chaos_calmer_base http://downloads.openwrt.org/chaos_calmer/15.05/ar71xx/generic/packages/base\n    ```\n    \n    请在Release页面下载：[此处下载](https://github.com/pymumu/smartdns/releases)\n\n### 标准Linux系统安装（树莓派, X86\\_64系统）\n\n* * *\n\n1.  安装 下载配套安装包`smartdns.xxxxxxxx.armhf.deb`，并上传到Linux系统中。 执行如下命令安装\n    \n    ```\n     dpkg -i smartdns.xxxxxxxx.armhf.deb\n    ```\n    \n2.  修改配置 安装完成后，可配置smartdns的上游服务器信息。具体配置参数参考`配置参数`说明。 一般情况下，只需要增加`server [IP]:port`, `server-tcp [IP]:port`配置项， 尽可能配置多个上游DNS服务器，包括国内外的服务器。配置参数请查看`配置参数`章节。\n    \n    ```\n     vi /etc/smartdns/smartdns.conf\n    ```\n    \n3.  启动服务\n    \n    ```\n     systemctl enable smartdns\n     systemctl start smartdns\n    ```\n    \n4.  将DNS请求转发的SmartDNS解析。 修改本地路由器的DNS服务器，将DNS服务器配置为SmartDNS。\n    *   登录到本地网络的路由器中，配置树莓派分配静态IP地址。\n    *   修改WAN口或者DHCP DNS为树莓派IP地址。 注意： I. 每款路由器配置方法不尽相同，请百度搜索相关的配置方法。 II.华为等路由器可能不支持配置DNS为本地IP，请修改PC端，手机端DNS服务器为树莓派IP。\n5.  检测服务是否配置成功。 使用`nslookup -querytype=ptr 127.0.0.1`查询域名 看命令结果中的`name`项目是否显示为`smartdns`或`主机名`，如`smartdns`则表示生效\n    \n    ```\n     pi@raspberrypi:~/code/smartdns_build $ nslookup -querytype=ptr 127.0.0.1\n     Server:         192.168.1.1\n     Address:        192.168.1.1#53\n    \n     Non-authoritative answer:\n     1.0.0.127.in-addr.arpa  name = smartdns.\n    ```\n    \n\n### openwrt/LEDE\n\n* * *\n\n1.  安装 将软件使用winscp上传到路由器的/root目录，执行如下命令安装\n    \n    ```\n     opkg install smartdns.xxxxxxxx.xxxx.ipk\n     opkg install luci-app-smartdns.xxxxxxxx.xxxx.all.ipk\n    ```\n    \n2.  修改配置 登录openwrt管理页面，打开`Services`\\->`SmartDNS`进行配置。\n    *   在`Upstream Servers`增加上游DNS服务器配置，建议配置多个国内外DNS服务器。\n    *   在`Domain Address`指定特定域名的IP地址，可用于广告屏蔽。\n3.  启用服务 SmartDNS服务生效方法有两种，`一种是直接作为主DNS服务`；`另一种是作为dnsmasq的上游`。 默认情况下，SmartDNS采用第一种方式。如下两种方式根据需求选择即可。\n4.  启用方法一：作为主DNS(默认方案)\n    *   **启用smartdns的53端口重定向** 登录路由器，点击`Services`\\->`SmartDNS`，勾选`Redirect`选项，启用53端口转发。\n    *   **检测转发服务是否配置成功** 使用`nslookup -querytype=ptr 127.0.0.1`查询域名 看命令结果中的`name`项目是否显示为`smartdns`或`主机名`，如`smartdns`则表示生效\n        \n        ```\n          pi@raspberrypi:~/code/smartdns_build $ nslookup -querytype=ptr 127.0.0.1\n          Server:         192.168.1.1\n          Address:        192.168.1.1#53\n        \n          Non-authoritative answer:\n          1.0.0.127.in-addr.arpa  name = smartdns.\n        ```\n        \n    *   **界面提示重定向失败**\n        \n        *   检查iptable，ip6table命令是否正确安装。\n        *   openwrt 15.01系统不支持IPV6重定向，如网络需要支持IPV6，请将DNSMASQ上游改为smartdns，或者将smartdns的端口改为53，并停用dnsmasq。\n        *   LEDE之后系统，请安装IPV6的nat转发驱动。点击`system`\\->`Software`，点击`update lists`更新软件列表后，安装`ip6tables-mod-nat`\n        *   使用如下命令检查路由规则是否生效。\n        \n        ```\n          iptables -t nat -L PREROUTING  grep REDIRECT\n        ```\n        \n        *   如转发功能不正常，请使用方法二：作为DNSMASQ的上游。\n5.  方法二：作为DNSMASQ的上游\n    *   **停用smartdns的53端口重定向** 登录路由器，点击`Services`\\->`SmartDNS`，去勾选`Redirect`选项，停用53端口转发。\n    *   **将dnsmasq的请求发送到smartdns** 登录路由器，点击`Network`\\->`DHCP and DNS`，修改`DNS forwardings(DNS转发)`为：\n        \n        ```\n          /#/127.0.0.1#5353\n        ```\n        \n        其中`#5353`为smartdns的服务端口号，未修改的情况下，默认为5353。\n    *   **检测上游服务是否配置成功** 使用`nslookup`查询`www.baidu.com`域名，查看结果中百度的IP地址是否`只有一个`，如有多个IP地址返回，则表示未生效，请多尝试几个域名检查。\n        \n        ```\n          pi@raspberrypi:~ $ nslookup www.baidu.com 192.168.1.1\n          Server:         192.168.1.1\n          Address:        192.168.1.1#53\n        \n          Non-authoritative answer:\n          www.baidu.com   canonical name = www.a.shifen.com.\n          Name:   www.a.shifen.com\n          Address: 14.215.177.38\n        ```\n        \n6.  启动服务 勾选配置页面中的`Enable(启用)`来启动SmartDNS\n7.  注意：\n    *   如已经安装chinaDNS，建议将chinaDNS的上游配置为SmartDNS。\n    *   SmartDNS默认情况，将53端口的请求转发到SmartDNS的本地端口，由`Redirect`配置选项控制。\n\n### 华硕路由器原生固件/梅林固件\n\n* * *\n\n说明：梅林固件派生自华硕固件，理论上可以直接使用华硕配套的安装包使用。但目前未经验证，如有问题，请提交issue。\n\n1.  准备 在使用此软件时，需要确认路由器是否支持U盘，并准备好U盘一个。\n2.  启用SSH登录 登录管理界面，点击`系统管理`\\->点击`系统设置`，配置`Enable SSH`为`Lan Only`。 SSH登录用户名密码与管理界面相同。\n3.  下载`Download Master` 在管理界面点击`USB相关应用`\\->点击`Download Master`下载。 下载完成后，启用`Download Master`，如果不需要下载功能，此处可以卸载`Download Master`，但要保证卸载前Download Master是启用的。\n4.  安装SmartDNS 将软件使用winscp上传到路由器的`/tmp/mnt/sda1`目录。（或网上邻居复制到sda1共享目录）\n    \n    ```\n     ipkg install smartdns.xxxxxxx.mipsbig.ipk\n    ```\n    \n5.  重启路由器生效服务 待路由器启动后，使用`nslookup -querytype=ptr 127.0.0.1`查询域名 看命令结果中的`name`项目是否显示为`smartdns`或`主机名`，如`smartdns`则表示生效\n    \n    ```\n     pi@raspberrypi:~/code/smartdns_build $ nslookup -querytype=ptr 127.0.0.1\n     Server:         192.168.1.1\n     Address:        192.168.1.1#53\n    \n     Non-authoritative answer:\n     1.0.0.127.in-addr.arpa  name = smartdns.\n    ```\n    \n6.  额外说明 上述过程，smartdns将安装到U盘根目录，采用optware的模式运行。 其目录结构如下： （此处仅列出smartdns相关文件）\n    \n    ```\n     U盘\n     └── asusware.mipsbig\n             ├── bin\n             ├── etc\n                 ├── smartdns\n                      └── smartdns.conf\n                 └── init.d\n                       └── S50smartdns\n             ├── lib\n             ├── sbin\n             ├── usr\n                 └── sbin\n                       └── smartdns\n             ....\n    ```\n    \n    如要修改配置，可以ssh登录路由器，使用vi命令修改\n    \n    ```\n     vi /opt/etc/smartdns/smartdns.conf\n    ```\n    \n    也可以通过网上邻居修改，网上邻居共享目录`sda1`看不到`asusware.mipsbig`目录，但可以直接在`文件管理器`中输入`asusware.mipsbig\\etc\\init.d`访问\n    \n    ```\n     \\\\192.168.1.1\\sda1\\asusware.mipsbig\\etc\\init.d\n    ```\n    \n\n## 配置参数\n\n参数\n\n功能\n\n默认值\n\n配置值\n\n例子\n\nserver-name\n\nDNS服务器名称\n\n操作系统主机名/smartdns\n\n符合主机名规格的字符串\n\nserver-name smartdns\n\nbind\n\nDNS监听端口号\n\n\\[::\\]:53\n\nIP:PORT\n\nbind 192.168.1.1:53\n\ncache-size\n\n域名结果缓存个数\n\n512\n\n数字\n\ncache-size 512\n\nrr-ttl\n\n域名结果TTL\n\n远程查询结果\n\n大于0的数字\n\nrr-ttl 600\n\nrr-ttl-min\n\n允许的最小TTL值\n\n远程查询结果\n\n大于0的数字\n\nrr-ttl-min 60\n\nrr-ttl-max\n\n允许的最大TTL值\n\n远程查询结果\n\n大于0的数字\n\nrr-ttl-max 600\n\nlog-level\n\n设置日志级别\n\nerror\n\nerror,warn,info,debug\n\nlog-level error\n\nlog-file\n\n日志文件路径\n\n/var/log/smartdns.log\n\n路径\n\nlog-file /var/log/smartdns.log\n\nlog-size\n\n日志大小\n\n128K\n\n数字+K,M,G\n\nlog-size 128K\n\nlog-num\n\n日志归档个数\n\n2\n\n数字\n\nlog-num 2\n\nconf-file\n\n附加配置文件\n\n无\n\n文件路径\n\nconf-file /etc/smartdns/smartdns.more.conf\n\nserver\n\n上游UDP DNS\n\n无\n\n\\[ip\\]\\[:port\\]，可重复\n\nserver 8.8.8.8:53\n\nserver-tcp\n\n上游TCP DNS\n\n无\n\n\\[IP\\]\\[:port\\]，可重复\n\nserver-tcp 8.8.8.8:53\n\naddress\n\n指定域名IP地址\n\n无\n\naddress /domain/ip\n\naddress /www.example.com/1.2.3.4\n\nbogus-nxdomain\n\n假冒IP地址过滤\n\n无\n\n\\[ip\\]，可重复\n\nbogus-nxdomain 1.2.3.4\n\nforce-AAAA-SOA\n\n强制AAAA地址返回SOA\n\nno\n\n\\[yesno\\]\n\nforce-AAAA-SOA yes\n\n转自github 原文链接[https://pymumu.github.io/smartdns/](https://pymumu.github.io/smartdns/)","tags":["IT","Linux","折腾","Hexo"],"categories":["uncategorized"]},{"title":"Pi上传CPU温度到oneNet","url":"/2018/07/22/pi上传cpu温度到onenet/","content":"\n\n<!-- more -->\n## 参考代码\n\n\\# -\\*- coding:utf-8 -\\*-\n# File: cputemp.py\n#向平台已经创建的数据流发送数据点\nimport urllib2\nimport json\nimport time\nimport datetime\n\n\n\nAPIKEY = 'xxxxxxxxxxx'  #改成你的APIKEY\n\ndef get\\_temp():\n        # 打开文件 \n        file = open(\"/sys/class/thermal/thermal\\_zone0/temp\") \n        # 读取结果，并转换为浮点数 \n        temp = float(file.read()) / 1000 \n        # 关闭文件 \n        file.close() \n        # 向控制台打印结果 \n        print \"CPU的温度值为: %.3f\" %temp \n        # 返回温度值\n        return temp\n        \n        \ndef http\\_put():\n    temperature = get\\_temp() #获取CPU温度并上传\n    CurTime = datetime.datetime.now()\n    url='http://api.heclouds.com/devices/xxxxx/datapoints' #改成你自己的①\n    values={'datastreams':\\[{\"id\":\"temp\",\"datapoints\":\\[{\"at\":CurTime.isoformat(),\"value\":temperature}\\]}\\]}\n\n    print \"当前的ISO时间为： %s\" %CurTime.isoformat()\n    print \"上传的温度值为: %.3f\" %temperature\n\n    jdata = json.dumps(values)                  # 对数据进行JSON格式化编码\n    #打印json内容\n    print jdata\n    request = urllib2.Request(url, jdata)\n    request.add\\_header('api-key', APIKEY)\n    request.get\\_method = lambda:'POST'          # 设置HTTP的访问方式\n    request = urllib2.urlopen(request)\n    return request.read()\n\nwhile True:\n        time.sleep(60)\n        resp = http\\_put()\n        print \"OneNET请求结果:\\\\n %s\" %resp\n        time.sleep(60)\n\n##### 注：①为设备API地址\n\n![1](https://s1.ax1x.com/2018/07/20/P8PJvq.jpg)\n\n##### 执行效果\n\n![2](https://s1.ax1x.com/2018/07/20/P8P88s.md.png)\n\n###### 转自https://open.iot.10086.cn/bbs/thread-2533-1-1.html 有改动","tags":["Hexo"],"categories":["uncategorized"]},{"title":"自己动手建造WordPress全站Ajax","url":"/2018/07/06/自己动手建造wordpress全站ajax/","content":"\n全站 ajax 加载网站的用户体验是很奇妙的，全程浏览网站期间看不到任何浏览器刷新的迹象，点击网站上的链接，如果网站的速度可以的话，会给人一种瞬间加载的顺滑感觉，同时不失有高大上的感觉。 现在我看到很多 WordPress 网站已经部署上了全站 ajax 加载代码，效果也不错，所以我也在主题中设置了全站局部刷新的 ajax 代码。\n<!-- more -->\n全站 ajax 看似技术复杂，但是实际上操作起来非常简易，原因是已经有大神写好了相关的函数，任何开发者只要稍微修改一下参数，就可以轻松改造自己的网站。 全 站 ajax 代码的来源是从 WordPress 插件中提取出来的，作者是英国的卢克和威廉姆斯。这款代码适用范围非常广，不仅 WordPress 网站可以使用，只要结构统一完整的网站都可以使用，只需要简单的几部就可以改造完成。\n\nvar ajaxhome='';\nvar ajaxcontent = 'content';\nvar ajaxsearch\\_class = 'searchform';\nvar ajaxignore\\_string = new String('#, /wp-, .pdf, .zip, .rar, /goto');\nvar ajaxignore = ajaxignore\\_string.split(', ');\nvar ajaxloading\\_code = 'loading';\nvar ajaxloading\\_error\\_code = 'error';\nvar ajaxreloadDocumentReady = false;\nvar ajaxtrack\\_analytics = false\nvar ajaxscroll\\_top = true\nvar ajaxisLoad = false;\nvar ajaxstarted = false;\nvar ajaxsearchPath = null;\nvar ajaxua = jQuery.browser;\njQuery(document).ready(function() {\n    ajaxloadPageInit(\"\");\n});\nwindow.onpopstate = function(event) {\n    if (ajaxstarted === true && ajaxcheck\\_ignore(document.location.toString()) == true) {\n        ajaxloadPage(document.location.toString(),1);\n    }\n};\nfunction ajaxloadPageInit(scope){\n    jQuery(scope + \"a\").click(function(event){\n        if (this.href.indexOf(ajaxhome) >= 0 && ajaxcheck\\_ignore(this.href) == true){\n            event.preventDefault();\n            this.blur();\n            var caption = this.title  this.name  \"\";\n            var group = this.rel  false;\n            try {\n                ajaxclick\\_code(this);\n            } catch(err) {\n            }\n            ajaxloadPage(this.href);\n        }\n    });\n    jQuery('.' + ajaxsearch\\_class).each(function(index) {\n        if (jQuery(this).attr(\"action\")) {\n            ajaxsearchPath = jQuery(this).attr(\"action\");;\n            jQuery(this).submit(function() {\n                submitSearch(jQuery(this).serialize());\n                return false;\n            });\n        }\n    });\n    if (jQuery('.' + ajaxsearch\\_class).attr(\"action\")) {} else {\n    }\n}\nfunction ajaxloadPage(url, push, getData){\n    if (!ajaxisLoad){\n        if (ajaxscroll\\_top == true) {\n            jQuery('html,body').animate({scrollTop: 0}, 1500);\n        }\n        ajaxisLoad = true;\n        ajaxstarted = true;\n        nohttp = url.replace(\"http://\",\"\").replace(\"https://\",\"\");\n        firstsla = nohttp.indexOf(\"/\");\n        pathpos = url.indexOf(nohttp);\n        path = url.substring(pathpos + firstsla);\n        if (push != 1) {\n            if (typeof window.history.pushState == \"function\") {\n                var stateObj = { foo: 1000 + Math.random()\\*1001 };\n                history.pushState(stateObj, \"ajax page loaded...\", path);\n            } else {\n            }\n        }\n        if (!jQuery('#' + ajaxcontent)) {\n        }\n        jQuery('#' + ajaxcontent).append(ajaxloading\\_code);\n        jQuery('#' + ajaxcontent).fadeTo(\"slow\", 0.4,function() {\n            jQuery('#' + ajaxcontent).fadeIn(\"slow\", function() {\n                jQuery.ajax({\n                    type: \"GET\",\n                    url: url,\n                    data: getData,\n                    cache: false,\n                    dataType: \"html\",\n                    success: function(data) {\n                        ajaxisLoad = false;\n                        datax = data.split('<title>');\n                        titlesx = data.split('</title>');\n                        if (datax.length == 2  titlesx.length == 2) {\n                            data = data.split('<title>')\\[1\\];\n                            titles = data.split('</title>')\\[0\\];\n                            jQuery(document).attr('title', (jQuery(\"<div/>\").html(titles).text()));\n                        } else {\n                        }\n                        if (ajaxtrack\\_analytics == true) {\n                            if(typeof \\_gaq != \"undefined\") {\n                                if (typeof getData == \"undefined\") {\n                                    getData = \"\";\n                                } else {\n                                    getData = \"?\" + getData;\n                                }\n                                \\_gaq.push(\\['\\_trackPageview', path + getData\\]);\n                            }\n                        }\n                        data = data.split('id=\"' + ajaxcontent + '\"')\\[1\\];\n                        data = data.substring(data.indexOf('>') + 1);\n                        var depth = 1;\n                        var output = '';\n                        while(depth > 0) {\n                            temp = data.split('</div>')\\[0\\];\n                            i = 0;\n                            pos = temp.indexOf(\"<div\");\n                            while (pos != -1) {\n                                i++;\n                                pos = temp.indexOf(\"<div\", pos + 1);\n                            }\n                            depth=depth+i-1;\n                            output=output+data.split('</div>')\\[0\\] + '</div>';\n                            data = data.substring(data.indexOf('</div>') + 6);\n                        }\n                        document.getElementById(ajaxcontent).innerHTML = output;\n                        jQuery('#' + ajaxcontent).css(\"position\", \"absolute\");\n                        jQuery('#' + ajaxcontent).css(\"left\", \"20000px\");\n                        jQuery('#' + ajaxcontent).show();\n                        ajaxloadPageInit(\"#\" + ajaxcontent + \" \");\n                        if (ajaxreloadDocumentReady == true) {\n                            jQuery(document).trigger(\"ready\");\n                        }\n                        try {\n                            ajaxreload\\_code();\n                        } catch(err) {\n                        }\n                        jQuery('#' + ajaxcontent).hide();\n                        jQuery('#' + ajaxcontent).css(\"position\", \"\");\n                        jQuery('#' + ajaxcontent).css(\"left\", \"\");\n                        jQuery('#' + ajaxcontent).fadeTo(\"slow\", 1, function() {});\n                    },\n                    error: function(jqXHR, textStatus, errorThrown) {\n                        ajaxisLoad = false;\n                        document.title = \"Error loading requested page!\";\n                        document.getElementById(ajaxcontent).innerHTML = ajaxloading\\_error\\_code;\n                    }\n                });\n            });\n        });\n    }\n}\nfunction submitSearch(param){\n    if (!ajaxisLoad){\n        ajaxloadPage(ajaxsearchPath, 0, param);\n    }\n}\nfunction ajaxcheck\\_ignore(url) {\n    for (var i in ajaxignore) {\n        if (url.indexOf(ajaxignore\\[i\\]) >= 0) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction ajaxreload\\_code() {\n    //add code here   \n}\nfunction ajaxclick\\_code(thiss) {\n    jQuery('ul.nav li').each(function() {\n        jQuery(this).removeClass('current-menu-item');\n    });\n    jQuery(thiss).parents('li').addClass('current-menu-item');\n}\n\n代码部分需要根据自己的实际修改一小部分： 1、第一行 ajaxhome 填写网站的访问网址； 2、第二行 ajaxcontent 填写网站文章的容器id名称，即异步加载的部分； 3、第三行 ajaxsearch\\_class 填写网站搜索框的容器名称，一般都是“searchform”； 4、第四行 ajaxignore\\_string 是忽略使用ajax加载的链接，比如说feed源等等； 5、第六行 ajaxloading\\_code 加载时显示的内容，可以设定动画； 6、第七行 ajaxloading\\_error\\_code 加载失败时显示的内容，可以设定动画。   只要按照上述要求修改好代码，单独存放为 JS 文件并且引入网页之中，效果立竿见影。有木有很神奇的感觉。 ajax异步加载影响其他jQuery特效： 部署上 ajax 异步加载代码后，会出现一个问题，首次打开网站后，jQuery 动画都会正常运行，但是点击网页执行了 ajax 异步加载之后，所有的动画都会失效。 这是因为进行异步加载后 jQuery 代码无法获取元素，特效自然消失，为解决这个问题，还需要对 jQuery 代码进行改造。 解决方式是使用 `live()` 事件，`live()`事件的用法如下\n\n$(selector).live(event,data,function)\n\nevent 用来替换 click()、hover() 等动作；data 可选，是参数；function 是需要执行的动作。 举个例子，一个 `click()` 事件改写为 `live()` 事件，原本代码是这样：\n\n$(\".menu-item\").click(function(){$(\".topmenu\").fadeOut(500)});\n\n修改之后\n\n(\".menu-item\").live(\"click\",function(){$(\".topmenu\").fadeOut(500)});\n\n    原文出自KRUNK ZHOU 原文链接:[https://krunk.cn/kblog325/](https://krunk.cn/kblog325/)","tags":["IT","折腾"],"categories":["uncategorized"]},{"title":"GitHub文件加速","url":"/2018/06/23/whr-uptime/","categories":["uncategorized"]},{"title":"pm2让hexo博客在后台运行","url":"/2018/06/23/pm2让hexo博客在后台运行/","content":"\n估计有好多人和我一样，在linux上部署成功hexo这个开源博客的时候，很高兴的用$ hexo server在服务上跑了起来。都遇到了 hexo 进程无法一直常驻后台。 ssh 一关，博客进程就死掉了。这可就扎心了，因为我们不可能一直本地开着ssh吧。 我也尝试过很多办法，比如screen，windows X system …… 于是经过一番大肆搜索，官方说用$ hexo s & 但是我在用的时候还是进程莫名奇妙的死掉了\n<!-- more -->\n# **安装pm2**\n\nnpm  install -g pm2\n\n# **写一个执行脚本**\n\n在博客根目录下面创建一个**hexo\\_run.js**\n\n//run\nconst { exec } = require('child\\_process')\nexec('hexo server',(error, stdout, stderr) => {\n        if(error){\n                console.log('exec error: ${error}')\n                return\n        }\n        console.log('stdout: ${stdout}');\n        console.log('stderr: ${stderr}');\n})\n\n# **运行脚本**\n\n在根目录下\n\n```bash\npm2 start hexo_run.js\n```\n\n多么完美的后台","tags":["IT","Linux","折腾","Hexo","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"树莓派打开powersave","url":"/2018/06/06/树莓派打开powersave/","content":"\npowersave顾名思义，减少功耗，这个功能在有些供电不足的情况下十分好用，可以减少树莓派宕机的次数。\n<!-- more -->\n举个栗子我的一台供电不足树莓派上搭了个web server，再叫几个好伙伴访问一下，写两篇文章或者评论什么的，第一个访客还没有什么问题，第二个一来，503了。。。 通过powersave功能可以将Pi的CPU主频降到最低\n\nsudo -i\n\necho powersave > /sys/devices/system/cpu/cpu0/cpufreq/scaling\\_governor\n\n然后\n\nsudo cat/sys/devices/system/cpu/cpu0/cpufreq/scaling\\_cur\\_freq\n\n我的Orangepi的主频已经降到了480mhz了，毕竟windowsX system玩的少，在shell里面这点主频足够了 编辑/etc/rc.local把降频功能加入到自启动项目中\n\necho powersave > /sys/devices/system/cpu/cpu0/cpufreq/scaling\\_governor\n\n  完美节能","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"我为什么写博客","url":"/2018/05/20/我为什么写博客/","content":"\n一个选择 我知道现在可能说这话有点不合时宜，毕竟博客时代都已经过去了，再号召大家用过就好像时的东西是不是有点逆流而上？\n<!-- more -->\n我曾经也问过自己这个问题，但是我觉得，博客时代过去跟我们要开博客是没有多大关系的，就好像你的读书时代已经过去你就不再读书一样。 判断一件事情值不值得去做有一个方法：在一张白纸的左边写不值得做的原因，然后在右边写值得做的原因，写完一比较，一权衡，自然能够得出结果。 大家都成年人了，你会觉得这样思考分析总结的过程才是正确的思考的方法吧？ 所以，我在这里列出要写（独立）博客的原因，供大家去选择，然后填在你白纸的右边。 注意，我不是给你一个建议，而是提供一个选择，这个选择蕴藏着我也不知道的可能。 博客内容 写博客不难，你可以当作是生活的记录，但是这样的记录没有任何的意义。写要对得住写本身，写出来的东西应该是思考的结果。我认为，如果你要开一个博客，博客的内容应该是这样的： 1. 不是生活杂记、不是流水账、不是牢骚、不是抱怨、不是心情琐记……；2. 有目的地写，要务实，追求质量；3. 承认真实的自己，不要吹嘘，不要装逼，无需讨好读者；4. 记录自己学习、思考、总结的过程；5. 分享你的故事、所得、感想、经验； 值得写的原因 以下是一个清单，可以根据自己的情况匹配，然后选择。 重新认识自己 是不是很久没有跟自己对话了？ 你可以尝试从回答一些问题开始，将你过去要回避的问题写下来，例如就可以从这个九个问题开始： 1、请你介绍一下你自己，你是个什么样的人？ 2、你有什么理想吗？这个理想是怎么形成的？ 3、你理想的伴侣关系是什么样的？你自己在这个伴侣关系中扮演什么样的角色？要承担什么样的责任？ 4、你理想的事业是什么，你正在做的工作符合你的事业理想吗？这份工作对你的意义是什么？ 5、你对亲子关系怎么看？对你来说，什么是一个理想的父亲（母亲），你期望自己成为这样一个理想父亲（母亲）吗？ 6、你对钱怎么看，你认为赚到多少钱是足够的？如果你明天一早醒来，已经有足够的钱，你将会如何继续安排自己的生活？ 7、对你来说，什么是理想的性生活？什么是理想的性道德，在你的性道德观中，什么样的性生活是禁忌的，需要避免的，什么样的性生活是美好的，需要得到鼓励和发展的？ 8、你的择友标准是什么？什么样的人你会愿意交往，什么样的人你会拒绝和他交往？ 9、你对死亡怎么看？你希望自己活到多少岁，你准备怎么度过从现在到死亡的这段时间？如果你要立遗嘱，这份遗嘱会怎么写？ 以上的这九个问题摘自《很少人能顺畅回答这9个问题——心理治疗刚开始医生常常会先问你的 》by 李孟潮。 这些问题的答案你可以选择不发，但是我强烈地建议写下来，只有在写的时候你才可以慎重地思考这些问题，而不会回避跳过或者留下空白，这是接受自己的第一步。 提供持续学习的动力 例如，我为自己设限每天写一千字，信息的不断输出给我带来恐惧，我害怕有一天我写无可写，于是我不停地阅读，通过个人的知识管理促使自己不断学习，提高核心竞争力。 详细的知识管理可以看我的这篇文章：《个人知识管理的方法》，回复「知识」可见 积累更多的知识 写并不是单纯的写。 例如你写着写着，你突然忘记了一个概念，于是上网找，找回来这个概念的时候，你重温这个概念，可能还会顺便看了一下这个概念的其他东西。 例如你需要获取第一手的资料，寻找信息来源本身就是一个知识积累的过程，同时，你慢慢就学会了鉴别知识：什么是没有用的心灵鸡汤，什么是不值得关注的吐槽名人，还有，在这个过程中，你还养成你的心智。 提高将事情讲清楚的能力 很多东西你以为懂了，但当你在写下来的时候，你就觉得无从下手了。 如果一件事情你不能讲清楚，十有八九你还没有完全理解。 将事情写下来，慢慢就可以提高你的逻辑思维能力，分析能力，写会迫使你在你脑中搭建一个有条理的框架。例如我写这篇文章一样，我就将值得写博客的原因一点一点地罗列出来，事情就更加清晰，你也可以更好的思考问题。 分享带来的连锁反应 “通过分享，你获得了直接而快速的回报，你最终或许会发现你已将版权和“保留所有权利”抛诸脑后。新的经济学准则是：参与你作品的人越多，回报越高。在分享主义里，如果你愿意你可以保留所有权，但是我乐于分享。” by 毛向辉 《分享主义：一场思维革命》 互联网精神其中最重要的就是分享主义，基于分享主义，你可以享受到社会化及互联网给你带来的种种便利和好处，你分享了一个知识，你就成为了互联网中的一个点，这个点的大小由你自己来决定，互联网的大潮会将你的这个点推送到它所能触及的每个角落，让需要的人得到，同时，你的这个点也会继续扩大，连接到整个网络，这个点有可能连接成一张网，而你就是这张网的中心。 帮你找到志同道合的人 在微博，在朋友圈，你可能找不到跟你志同道合的人，而在博客，你可以通过看他的几篇文章就迅速地理解认同这个人，即使你没有见过这个人，但你也可以通过这种关联来相互学习。 如果你在一个领域有相当的了解，你将这些内容发在网络上，网络上跟你志趣相投的人也会被你吸引过来，根据吸引力法则，你是怎样的人你就被怎么样的人吸引，这就是博客所能赋予你的魅力。 即使博客没有被他人关注，我们依然可以找到同好，你可以自己将博文转载到其他站点，人们会通过搜索引擎找到你，有邮件、微博等工具，我们不乏与他人交流的途径。by Gabriel Weinberg《Why I blog》 记录成长 隔一段时间，你再回头看你写的博客，你会发现自己正在通过这样的方式在不断的成长，这种成长在自己眼里是一种财富，在别人眼里是一张地图，你得到了收获，不断修正自己的错误，别人得到了指引，避免走弯路。 更多的情况是当你回望自己的时候你会发现自己是一个傻逼，so what，that is what I am！ 培养持续做一件事情的能力 开始是坚持，后来是习惯，接着喜欢。以后当有人对你说，「你写那么多有用的东西，你真的很厉害啊！」你可以笑而不语，也可以大声说道：「你妹，你不知道我开始的时候多么痛苦！」 让你长久地去跑步，你可能做不到；让你每个月看一本书，你也可能做不到；但让你持续地写一个博客，你可以做得到。 你不相信？你不试试你怎么知道？ 默默地持续做一件事是一种难得的能力，也是一种难得的品质。 讨论反思 每人都会有思维的盲点，就好像这篇文章一样，可能你觉得我可能说得不对，你可以反驳我，我欢迎这种讨论，因为讨论的过程中会产生各种的思维的碰撞，这种碰撞会让你反思，也会激发出你新的灵感，这种讨论反思给自己的带来巨大的受益。 互联网给你的反馈就是让你承受更多，接受更多，成为一个更好的人。 搜寻到你意想不到东西 世界不止是你的家，你的公司，你的朋友圈，你应该去发现一个更大的世界，通过写博客，你会知道世界上还有很多人像你一样在写博客，这些人和知识正在世界的某个角落在等着你。 例如，在写这篇文章的过程中，我才知道了Gabriel Weinberg，我才要将阳志平的博客重读一遍。写的过程会让你有很多新的发现，这些新的发现都值得你去再写下来，总结分享出去。 一个人在做一件属于自己的事 很多你认为自己很牛逼的事情都是自己一个人做出来。 别人在刷微博，你在看书，别人在看穿越剧，你在学英文，别人在去唱K，你在写个人总结。吃饭也要找同伴，出游要找同伴，看电影要找同伴，你上一次一个人在做一件属于自己的事是在什么时候？ 如果你想要清晰地思考，就必须远离人群。但是走得越远，你的处境就会越困难，收到的阻力也会越大。因为你没有迎合社会习俗，而是一步步地与它背道而驰。如果自己就是潮水的一部分 ，怎么能看见潮流的方向呢？你只能永远保持质疑，问自己，什么话是我不能说的？为什么？——Paul Graham《不能说的话》 互联网的身份识别： 一个长期的价值博客是一份很好的简历。这里的“简历”并非是狭义上的求职简历，毕竟现在还没有到价值博客的时代，很多人写博客都是到处转载或者干脆碎碎念，正因此面试官未必拿个人博客当成了解一个人的更可靠窗口。 这里的“简历”是指一个让别人了解自己的窗口，虽然我们未必做得到像罗永浩、Keso这样的博客，个人的影响力已经足以支撑出一份事业（牛博和5gme），但至少你会因此而结识更多的人，你的博客价值越高，你结识的人就越牛，跟牛人交流又会让你的眼界得到极大的开阔，打开一扇又一扇你原本不知道的门，于是你就变得更牛… 这是一个良性循环。by 刘未鹏 最后 你可能想不到在白纸的左边（不值得写博客的原因）写什么了，想不到写个「博客时代已经过去」或者「我没有时间」也可以，但与此同时，你也可以用那些时间去思考一下「怎么做到长期写一个价值博客」。 如果你不想思考，也可以回复「价值」看看别人的建议。 转自知乎 你为什么写博客","tags":["Date","行者笔记"],"categories":["uncategorized"]},{"title":"树莓派WIFI自动重连","url":"/2018/05/09/树莓派wifi自动重连/","content":"\npython代码autowifi.py，放在/home/pi目录下\n<!-- more -->\n#!/usr/bin/python\nimport os, time\n\nwhile True:\n    if '192' not in os.popen('ifconfig  grep 192').read():\n        print '\\\\n\\*\\*\\*\\*\\*\\* wifi is down, restart... \\*\\*\\*\\*\\*\\*\\\\n'\n        os.system('sudo /etc/init.d/networking restart')\n    time.sleep(5\\*60) #5 minutes\n\nshell脚本autowifi.sh，也放在/home/pi目录下\n\n#!/bin/sh\npython /home/pi/autowifi.py &\n\n开机自动启动以上脚本：在终端窗口执行以下命令即可\n\nsudo cp -f /home/pi/autowifi.sh /etc/init.d/\nsudo chmod +x /etc/init.d/autowifi.sh\nsudo chown root:root /etc/init.d/autowifi.sh \nsudo update-rc.d autowifi.sh defaults \n\n脚本会每5分钟检测一次，若wifi断线，则自动重新连接 如果出现 \"insserv: warning: script 'xxxx' missing LSB tags and overrides\" 移除wolfram-engine\n\nsudo apt-get remove wolfram-engine\n\n  转自创客社区 原文链接[http://bbs.nxez.com/thread-99-1-1.html](http://bbs.nxez.com/thread-99-1-1.html)","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"论破解大疆限高","url":"/2018/05/08/论破解大疆限高/","content":"\n作为一个过来人讲，DJI这种机器破限高没啥意义。 但是有人会说，站得高望得远啊。\n<!-- more -->\n因为大疆的机载图传天线是向四周发射的。你要飞的高且有图传，必须飞的远。 但是飞到一千三四百高的时候电量就报警了，要求返航了，受到天气温度，电池寿命的影响，有时候飞到破千 飞机就嚷嚷着要返航回来了。 如果你光头顶的话，一没有图传，二直升的效率低于斜线上升。一上去连片刻停留的没有就下来了有啥意义。 所以DJI的机机破高没意义，向往挑战的心理解，但是损人不利己的事情咱千万别干。\n\n整理来自Arkbird fpv群","tags":["Date","行者笔记","R.C"],"categories":["uncategorized"]},{"title":"JS实现仿饿了么在浏览器标签页失去焦点时网页标题改变","url":"/2018/04/17/js实现仿饿了么在浏览器标签页失去焦点时网页标题/","content":"\nS实现浏览器标签页失去焦点时网页Title的改变 这个 API 本身非常简单，由以下三部分组成。\n<!-- more -->\ndocument.hidden：表示页面是否隐藏的布尔值。页面隐藏包括 页面在后台标签页中 或者 浏览器最小化 document.visibilityState：表示下面 4 个可能状态的值 hidden：页面在后台标签页中或者浏览器最小化 visible：页面在前台标签页中 prerender：页面在屏幕外执行预渲染处理 document.hidden 的值为 true unloaded：页面正在从内存中卸载 Visibilitychange事件：当文档从可见变为不可见或者从不可见变为可见时，会触发该事件。 这样，我们可以监听 Visibilitychange 事件，当该事件触发时，获取 document.hidden 的值，根据该值进行页面一些事件的处理。 记住：必须是基于支持H5的浏览器才可以\n\n* * *\n\nvar OriginTitile = document.title;\nvar titleTime;\n    document.addEventListener('visibilitychange', function() {\n        if (document.hidden) {\n            document.title = '(つェ⊂)我藏好了哦~ ' + OriginTitile;\n            clearTimeout(titleTime);\n        }\n        else {\n            document.title = '(\\*´∇｀\\*) 被你发现啦~ ' + OriginTitile;\n            titleTime = setTimeout(function() {\n                document.title = OriginTitile;\n            }, 2000);\n        }\n    });\n\n* * *\n\n最后在Wordpress中使用Custom Javascript插件启用 本文来源于KRUNK BLOG( [http://86k.xyz](http://86k.xyz/))，","tags":["IT","Date","折腾"],"categories":["uncategorized"]},{"title":"树莓派创建自定义HDMI模式","url":"/2018/02/22/树莓派创建自定义hdmi模式/","content":"\n我们经常使用HDMI连接树莓派，但是有时候树莓派HDMI导致屏幕不能显现，让人很烦\n<!-- more -->\n在config.txt中使用以下配置字符串指定新模式\n\nhdmi\\_cvt=<width> <height> <framerate> <aspect> <margins> <interlace><rb> \nwidth            width in pixels\nheight           height in pixels\nframerate        framerate in Hz aspect aspect ratio 1=4:3, 2=14:9, 3=16:9, 4=5:4, 5=16:10, 6=15:9\nmargins          0=margins disabled, 1=margins enabled\ninterlace        0=progressive, 1=interlaced\nrb               0=normal, 1=reduced blanking\n\n前三个参数是必需的。其余的是可选的。如果未指定，则方面默认为16：9 使自定义模式成为默认模式。 请注意。不能保证您的显示器将支持由此产生的分辨率/帧速率。 但是，如果您目前正在以非原生分辨率运行显示器，那么这可能值得一试。","tags":["IT","Linux","折腾","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"树莓派用自带的网卡搭建热点","url":"/2018/02/17/树莓派用自带的网卡搭建热点/","content":"\n主要用到的软件有hostapd、dnsmasq\n<!-- more -->\n`sudo apt-get install hostapd dnsmasq` 然后在/etc/dnsmasq.conf末加入（自己修改IP和网段，这个文件是已存在的，很详细的配置文件，但是所有行都加入了#号注释掉） `interface=wlan0 dhcp-range=10.0.0.2,10.0.0.5,12h` 然后新建/etc/hostapd/hostapd.conf，加入 `interface=wlan0 hw_mode=g channel=10 auth_algs=1 wpa=2 wpa_key_mgmt=WPA-PSK wpa_pairwise=CCMP rsn_pairwise=CCMP wpa_passphrase=wifi密码 ssid=wifi名字` 接着修改/etc/sysctl.conf，更改（如果有这一行，把#号去掉就行） `net.ipv4.ip_forward=1` 最后，将下面脚本加入到/etc/rc.local的exit 0前 `ifconfig wlan0 down ifconfig wlan0 10.0.0.1 netmask 255.255.255.0 up iwconfig wlan0 power off service dnsmasq restart hostapd -B /etc/hostapd/hostapd.conf & > /dev/null 2>&1 sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT` 重启，就可以看到热点了。 转自[周半仙的博客](http://zhoubanxian.cn)","tags":["IT","Linux","Raspi/Orapi"],"categories":["uncategorized"]},{"title":"小米路由器monlor tools插件","url":"/2018/02/02/小米路由器monlor-tools插件/","content":"\n### 小米路由器Shell工具箱，monlor大神制作，主要参考了小米的Misstar Tools制作，仅学习之用！\n\n博主参与调试\n<!-- more -->\n工具箱正处于测试状态，更新比较频繁，安装要有一定的动手能力，出问题会用U盘刷固件。 arm路由: R1D R2D R3D , mips路由: R3 R3P R3G R1CM 目前支持了以下几种插件: 1. ShadowSocks 　　　影梭                        #成功 2. KoolProxy　　　　 去广告 3. Aria2　                       下载神器 4. VsFtpd　                    ftp服务器 5. kms                             Windows激活工具 6. Frpc                            内网穿透(占用资源较多，建议arm路由使用) 7. Ngrok                         内网穿透(比较轻量级) 8. WebShell　               网页ssh 9. TinyProxy                 http代理 10. Entware　               opkg软件包工具(仅支持arm路由) 11. KodExplorer　       可道云，在线文档管理器(依赖于Entware，仅支持arm路由) 12. EasyExplorer　      文件传输同步工具(仅支持arm路由) 13. HttpFile                     http文件查看工具(依赖于Entware，仅支持arm路由) 工具箱已经开发到了web界面，但是web界面插件不完全，插件的安装、卸载、配置由shell完成。 安装完成后执行monlor命令配置工具箱，Ctrl + c或者输入exit可以退出。 才疏学浅，但有一颗学习和折腾的心！\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/IMG_20180202_211731.jpg)\n\n### 安装方式\n\ncurl命令\n\n```\nsh -c \"$(curl -kfsSl https://coding.net/u/monlor/p/Monlor-Tools/git/raw/master/install.sh)\" && source /etc/profile &> /dev/null\n```\n\n### 工具箱命令\n\n1\\. 卸载：uninstall.sh 2. 更新：update.sh \\[-f\\] 3. 初始化：init.sh 4. 插件管理：appmanage.sh addupgradedel appname \\[-f\\] 5. 工具箱配置：monlor (任意界面Ctrl + c可以退出配置)\n\n### Web界面预览\n\n[![PZnpXF.md.png](https://s1.ax1x.com/2018/07/06/PZnpXF.md.png)](https://imgchr.com/i/PZnpXF) [![PZnS6U.md.png](https://s1.ax1x.com/2018/07/06/PZnS6U.md.png)](https://imgchr.com/i/PZnS6U) [![PZmzlT.md.png](https://s1.ax1x.com/2018/07/06/PZmzlT.md.png)](https://imgchr.com/i/PZmzlT)  \n\n### 注意事项\n\n1\\. 如果插件和工具箱都有更新，请务必先更新工具箱！ 2. 工具箱没有web界面，完全靠Shell开发，插件的安装、卸载、配置由配置文件完成。 3. 安装完成后执行monlor命令配置工具箱，Ctrl + c或者输入exit可以退出。 4. ss插件推荐使用aes-256-cfb或rc4-md5加密方式，较新的加密方式可能不支持\n\n## 目录结构\n\n/ --- /etc --- /monlor        --- /apps/ --- 插件安装位置        --- /config/ --- 工具箱配置文件        --- /scripts/ --- 工具箱脚本 --- /tmp        --- /messages --- 系统日志，工具箱日志 --- /userdisk        --- /data/ --- 硬盘目录 --- /extdisks/        --- /sd\\*/ --- 外接盘目录     _**这篇文章已经没有实效性，最新版monlor tools请移步到**__**[http://blog.whrblog.online/archives/1017](http://blog.whrblog.online/archives/1017)**_","tags":["IT","miwifi","折腾"],"categories":["uncategorized"]},{"title":"用Ardunio和ESP8266模块做一个云温度传感器","url":"/2017/08/11/217/","content":"\n# 前言\n\n前段时间用ESP8266模块+温度、湿度、气压传感器做了个云传感器。炫了几天装B后，就被群友索要教程。\n\n写这个教程，我其实是非常犹豫的，因为涉及到的知识点比较多，要写一大堆东西，极其占用时间。\n\n如果你是个高中生，或者是个大学新生，或者没接触过类似的东西，你会发现要独立完成全套的软硬件编程和设计，要学的东西有点多……\n<!-- more -->\n这样也导致了我这个教程，我也不知道该怎么写，能显得通俗易懂……\n\n两年前，我刚接触单片机的时候，就做过类似的东西，一个STC的51单片机STC15W408AS，一个ESP8266-12E模块，加一个DS18B20温度传感器。\n\n单片机获取传感器的实时温度，然后用AT命令和ESP8266模块通信，ESP模块负责把数据通过GET方式传给一台阿里云服务器。云服务器有一个Eclipes做的HttpServer的页面，数据存入MySql数据库，最后再做一个小网页展示最新1000条数据记录。\n\nESP模块连WIFI需要的SSID和密码，通过一个安卓手机APP实现，APP当时是用了APICloud这个APP快速开发工具做的。不得不说，做一些简单的APP，这种快速开发工具真的很赞，一个代码，能同时在线打包Android和IOS两种安装包。不过当时APICloud很恶心的一点，就是各种收费插件，显示全部无线路由器名字列表的插件都要收费。好了，不吐槽这个了。当时我还用过另外一个APP快速开发工具：APPCan。这个倒是没有那么多的收费插件，但是这个工具的Tcp协议有问题，官方暂时也没有修改的打算，所以只好放弃，转用APICloud。\n\n以上这种方式，开发速度非常快捷。我在拿到ESP8266模块后不到一个星期就完成了。\n\n当然，这个项目也没任何核心技术和难度，我当时接触单片机和硬件还不到两个月呢。\n\n两年后，无意间看到了有人用Arduino配合Esp8266的开发库在完成类似的事情，网上也有很多类似的教程。\n\nArduino我一直没有买过任何开发板，因为我51单片机都不算太精通，我还打算重点学习STM32的使用方法，所以根本没关注过Arduino，尽管它非常火。\n\n但是ESP8266模块我这里有一大堆啊，自己买了好多块，去年还在乐鑫免费申请了好多块，于是我根据别人的教程帖子，下载了ArduinoIDE和ESP8266最新版本2.3.0的开发板，接上串口线随便烧录了几个例程，居然很顺利的就完成了。\n\n顺便说一句，ArduinoIDE的文本编辑功能做的真的很差劲，连编译器最简单的文字自动补完功能都没有，全部的代码都要一个一个字符敲进去，反正是弱爆了。\n\n而且ESP8266的开发板还不能自动更新，据说被墙了，只有去下载压缩包，手工更新。\n\n不过很多小的开发库，自动更新都没问题的。\n\n当然我还是喜欢自己到GIT上手工搜索开发库，手工安装。哈哈。\n\n![](hto://www.whrblog.online/wp-content/uploads/2018/02/word-image-105.png)\n\n反正不管怎么说，这些都是小坑，一个晚上都趟过去了。Arduino用的应该是C++语言。反正C就这个样子，根据例子写就是了，没啥好说的。\n\nArduino烧录ESP8266模块的固件真是非常方便，成功率基本是100%，还是全自动的。程序写好后，按住按键，让GPIO0接地，烧录器插到USB口，松开按键，选择“上传”，然后等一会就烧录成功了。\n\n如果遇到烧录失败，把USB转TTL模块拔了重新插上就可以了，当然GPIO0要接地。\n\n我这里用的是烧录STC单片机用的那种带３.3 V输出的USB转TTL的烧录器，烧录速度还可以，关键是这种烧录器我家里有好几个，根本不用重新购买。\n\n总之一句话，硬件都是现成的，我只要安心编程就好。\n\n# 我们要做的东西\n\n先展示一下硬件，我用洞洞板搭建和焊接的。正面还凑合看。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-106.png)\n\n反面很难看，飞线的，想好看不去打板子是没戏的。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-107.png)\n\n然后还有一个小网站来配合它。当然这个网站我们要自己做。\n\n后面我再介绍怎么完成它。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-108.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-109.png)\n\n为了酷一点，我们还要做一个图表来展示。图表里面能显示24小时的数据折线图。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-110.png)\n\n上面看看很简单吧，可是这一套东西，如果要自己独立实现，嘿嘿，你要软件和硬件都懂一点才行。\n\n# 硬件准备\n\n先说一下我们需要准备哪些硬件。当然，我做这个的时候，纯粹是一时兴起，所以我只会用我手头上现有的模块和元件，不会去额外购买的。\n\n1、ESP8266模块。这里我用的是2年前购买的安信可公司的ESP8266-12E。\n\n你也可以用ESP8266-12F，或者用乐鑫公司的ESP-WROOM-02模块。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-111.png)\n\n下图就是ESP-WROOM-02模块，这个模块我手上很多，乐鑫搞活动的时候我去申请的。但是没用过，因为没转接板，飞线太难看。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-112.png)\n\n两个模块的引脚顺序是不一样的，我这里就不再介绍ESP-WROOM-02模块了，百度上很多资料，程序肯定能通用。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-113.png)\n\n2、ESP8266的转接板。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-114.png)\n\n这里说一句，转接板不是必需的，但是有了它，明显搭建ESP8266最小系统的时候省事多了。\n\n顺便说一句，安信可的GPIO5和GPIO4引脚顺序搞不清楚，他们给的原理图和实物居然是相反的，害我浪费了好多时间才发现。后来干脆重画了他的最小系统的原理图。\n\n3、AMS1117 3.3V模块\n\n因为ESP8266的供电是3.3V的，所以必须要有一个降压芯片。\n\n其实这个芯片很费电，静态电流就有8mA，如果你打算用电池供电，一定不要选它。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-115.png)\n\n实在是便宜，淘宝育松店的价格还要低个２毛钱，所以我也懒得自己焊了。\n\n４、DS18B20温度传感器\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-116.png)\n\n这种传感器温度实在不准确，DS18B20的温度精度是正负0.5°，马马虎虎了。\n\n而且离发热元件距离比较近的时候，温度有明显上升。\n\n如果你追求精度，我建议你买下面这种封装在不锈钢管里面的。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-117.png)\n\n5、湿度计传感器DHT12\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-118.png)\n\n你也可以买DHT11 ，代码通用的。\n\n但是11和12价格基本一样的情况下，我为啥不买个精度稍微高点的DHT12呢？\n\n这里多说一句，DHT12也带温度的，精度也是正负0.5°，干嘛还要上DS18B20呢？\n\n我只想说，第一，这个温度误差绝对不止是0.5°，第二，多学一种硬件用法。\n\n6、气压传感器BMP280\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-119.png)\n\n你也可以用BMP180，精度稍差点而已，价格基本一样。\n\nBMP280，可以测量温度和气压。温度也不是那么精确，主要还是测量气压的。\n\n气压的误差大概是正负1hPa。我们知道，大气压强大概是100000Pa左右，有时候会用hPa做单位，1hPa=100Pa。\n\n还有一种型号BME280，这个传感器温度、湿度、气压全带了。可惜价格比较贵，温度和湿度它精度也不高，就算了。\n\n7、IIC接口的0.96英寸，OLED 12864显示屏。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-120.png)\n\n个人感觉白色字体的比较好看。\n\n为啥用IIC接口的呢，因为占用的IO引脚少，SPI接口的要4~5个IO引脚呢。\n\n8、一块5\\*7cm的洞洞板，一个微动开关，一个单刀小开关，一个microUsb插座，一个蓝色发光LED，4根杜邦针，几个圆孔插座和4口杜邦插座啥的，还有若干个1K和10K电阻用来做上拉和限流啥的，其实个人测试，不接也行……当然最好接上……\n\n9、一个USB转TTL的烧录器\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-121.png)\n\n这个烧录器，其实是烧录51单片机用的……我想大家手头应该有好几个吧，因为我手头就有4、5个……用的时候还老是找不到……越买越多……\n\n记得把电源线，插到3.3V的位置，5V会烧了ESP8266模块。\n\n还有那种3、4块钱的简易版本烧录器，我不建议使用，因为它的3.3V电流很小，容易烧录失败。反正用这种8块钱的烧录器，烧录的波特率如果不高于115200的话，我基本没失败过。记得安装驱动程序， 要不没法用。\n\n# 搭建软件环境\n\n光有硬件还不行啊，还要有软件，要不我怎么写代码，怎么烧录固件呢？\n\n这次我们不用额外单片机，直接用ESP8266模块内置那个牛逼32位单片机。根据官方文档，这个单片机只用了大概几分之一的资源用来控制WIFI，所以我们还有大量的内存和存储空间，用来做我们自己的事情。\n\n这里感谢万能的Arduino，兼容超级多的32位单片机，也感谢为ESP8266写Arduino开发库的哥们，你真是太闲了，还有空写这个，有工资吗？\n\n首先我们要下载一个最新版本的Arduino，版本号1.8.3。你可以到Arduino的官方网站去下载，也可以下载我的打包文件。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-122.png)\n\n这个兼容Win7和Win10系统，我这里是Win7 64位版本的。Win10也肯定没问题。\n\n反正就是一直Next，不要更改路径，安装在C盘就可以了。最后在桌面会生成一个图标，这个就表示你安装成功了。 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-123.png)\n\n你可以打开看看，这个时候你还不能直接对ESP8266模块进行编程，因为我们还要安装ESP8266的开发板的库。\n\n本来可以直接在开发板管理器里面直接下载更新的，不过它好像被限制了，禁止进入境，所以你得下载安装包，手工更新。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-124.png) 上面的图是我安装好的时候，显示的版本号2.3.0的ESP8266开发板。这个我也帮大家打包好了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-125.png) 随便解压到任何一个目录，里面只有一个目录 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-126.png) 。\n\n把这个目录拷贝到下面的目录下面：\n\nC:\\\\Users\\\\Administrator\\\\AppData\\\\Local\\\\\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-127.png)\n\n某个同学说，哎呀，我C盘没有Users目录啊， ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-128.png) 这个就是Users目录。\n\n用户目录下面，再打开 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-129.png) 目录。\n\n某个同学又说了，哎呀，我的 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-130.png) 目录下面，没有 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-131.png) 目录啊。\n\n是啊，这个目录是隐藏的，所以呢，打开文件夹选项，把它改成不隐藏的。\n\n某个同学说，文件夹选项我也找不到啊，所以啊，看下图啊，实在不行百度啊。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-132.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-133.png)\n\n写教程就这点麻烦，很多常识你不写，很多人都看不懂，所以大家要学会百度。。。。\n\n最后打开AppData目录下面的 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-134.png) 目录，把刚才的 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-135.png) 文件夹整个拷贝进去。\n\n最后 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-136.png) 文件下面是这些东西就可以了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-137.png)\n\n事情还没完，再打开Arduino IDE，在文件菜单下面的首选项里面，\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-138.png)\n\n把里面的内容，弄成和我下面的图一样就可以了。\n\n具体的配置，可以参考下面这个网址，我也是从里面学的。\n\n[http://www.geek-workshop.com/thread-26170-1-1.html](http://www.geek-workshop.com/thread-26170-1-1.html)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-139.png)\n\n附加开发板管理器网址： 填入下面的地址，然后点“好”保存。\n\nhttp://arduino.esp8266.com/stable/package\\_esp8266com\\_index.json\n\n下面的还有一个参数配置，应该和下面的保存一致。\n\nC:\\\\Users\\\\Administrator\\\\AppData\\\\Local\\\\Arduino15\\\\preferences.txt\n\n如果不一样，就再检查一下你刚才拷贝的 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-140.png) 文件夹，里面应该有个 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-141.png) 文件的。\n\n反正搞了半天，重启一下Arduino，看看“工具”“开发板”“开发板管理器” ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-142.png)\n\n如果开发板安装好了，应该有2.3.0 INSTALLED 之类的显示。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-143.png)\n\n或者干脆把开发板往下拉，看看有没有ESP8266的，类似于下图：\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-144.png)\n\n如果你用的是ESP8266-12E，你可以选 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-145.png) 作为你的默认开发板。\n\n如果你用的是老款的ESP8266-01啥的，你就老老实实选通用的开发板 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-146.png)\n\n当然12E的模块，也可以选通用的。\n\n总算把软件环境搭好了，妈的，写了半天，真心累啊。\n\n# 搭建ESP8266的最小环境\n\n首先你要把ESP8266的最小系统搭建起来，否则没法烧录和测试。\n\n看看下面的ESP8266最小系统原理图。有转接板的，你可以焊上杜邦针，用杜邦线搭个最小环境。然后把烧录器接到电脑上，写个小程序测试一下。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-147.png)\n\n我还是用安信可的模块做说明，乐鑫的模块请对照引脚，自己搭建。\n\n乐鑫模块的EN脚，等同于安信可模块的CH\\_PD引脚，也就是使能脚。其他名字基本一样，请一一对照。\n\n这里再啰嗦几句吧。\n\n首先，CH\\_PD和REST要上拉，也就是通过1K~10K电阻接到3.3V。\n\n其次，GPIO15要下拉，也就是通过电阻接到GND上。\n\n烧录器的TX接到ESP8266的RXD引脚。\n\n烧录器的RX接到ESP8266的TXD引脚。\n\n（注意了，Tx要接Rx，Rx要接Tx，这个是常识，别Tx接Tx，Rx接Rx，还在QQ上反复追问我为什么？我又不是百度！！）\n\n烧录器的电源也接到ESP8266上，注意要3.3V电，别5V电接过来。\n\nGPIO0是烧录脚，也就是上电的时候，如果这个引脚悬空或者上拉，那么正常进入程序空间运行程序。如果这个引脚接地了，那么进入烧录模式，烧录器通过串口可以重新烧录里面的固件。\n\n# 烧录ESP8266测试\n\n打开Arduino，选择一个自带的ESP8266的例子。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-148.png)\n\n把代码往下拉，找到下面红框的代码，改成你家里的wifi的SSID和密码。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-149.png)\n\n不改代码也行，反正我们就是看看能不能烧录固件而已。\n\n打开“工具”，把开发板选得和我一样的。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-150.png)\n\n当然，如果你不是12E的模块，你选 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-151.png) 也行。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-152.png)\n\n――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――\n\n把你的ESP8266最小系统，接到烧录器上。4根线（3.3V，GND，Tx，Rx）别接错了。\n\n按住GPIO0引脚上的微动开关，让GPIO0引脚接地，然后把烧录器插到电脑的USB接口上，松手就可以了，没必要一直按着。\n\n最后点一下这个红框里的箭头，也就是上传按键。 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-153.png)\n\n大概会先花个半分钟编译固件，\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-154.png) ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-155.png)\n\n只要代码没语法错误，基本就不会失败。\n\n然后再花个半分钟烧录啥的。烧录时会有进度条显示。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-156.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-157.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-158.png)\n\n到了100%就表示烧录好了。\n\n如果显示错误信息，尝试把烧录器拔下来，按住烧录开关，重新插一次USB插口，再点上传按键。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-159.png)\n\n要是你卡在这一步，呵呵，我也是爱莫能助了。\n\n我写了这么多东西，任何一点错误都有可能导致你烧录失败，根本没法判断哪里出错了。也许你接线错了，也许你连烧录器的驱动都没安装，反正种种可能，你自己查吧。\n\n做这种东西，掉各种坑里才是正常，一帆风顺非常罕见。细心很重要，耐心更重要。\n\n在我写这篇教程前，我已经帮大家填平了很多坑了……\n\n我本人也掉过无数次的坑，常常有半夜忽然恍然大悟，然后爬起来填坑的经历。\n\n# 正式焊接硬件\n\n上面的步骤都通过了，你可以进行下一步的工作了。否则焊了个硬件，没法烧录固件，岂不是浪费？\n\n本来打算把我的焊接图拍下的，后来想想看算了，除非打板，否则洞洞板拍焊接图毫无意义，还容易误导大家。所以大家还是看原理图吧。另外，我建议大家全部的模块都用插座，这样以后拆起来也方便。你看我全部的模块都是用的插座，都不是直接焊死的。图上好像都被挡住了，反正我基本都用的插座……\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-160.png)\n\n# 原理图\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-161.png)\n\n在文档里面，原理图不是很清晰，所以大家可以去看PDF版本的。\n\n原理图看不明白，不知道怎么焊接实物的，我觉得你还是先打打基础比较好……\n\n我也是先画出原理图，才焊接的实物。\n\n原理图的硬件很简单，一个ESP8266模块，一个DS18B20温度传感器，一个4.7K或者10K的上拉电阻，一个IIC接口的0.9英寸的OLED（这个可有可无，实时显示的，不影响数据上传云服务器），一个5V转3.3V的稳压芯片ASM1117 3.3。\n\n如果考虑用18650锂电池供电，而非外接5V电源供电，还要考虑加上锂电池保护芯片和锂电池充电芯片，外加一个小开关。\n\n为了简单，其实是偷懒，这里就不做电池供电的设计了。而且ESP模块，耗电量蛮大的，一块2200mAh的电池，我估计最多24小时就要没电……所以用电池，除了特殊场合的应用，真心不是啥好想法。\n\n实测电流，居然只有80mA左右，还是在上传数据的时候，其它时间电流只有20mA左右。看来哪怕用充电宝供电，都可以坚持非常长的时间。\n\n实测：用使用了好几年的5000mAh的充电宝供电，大概工作了56个小时。\n\n看来以前用官方的AT命令固件，运算量蛮大的，造成非常耗电。\n\n自己写的Arduino代码，没那么多功能，所以耗电量大大下降，真是意外之喜。\n\n不过我建议用5V 手机充电器供电就可以了。\n\n以前老式的塞班手机充电器，500~800mA的，家里还好几个，废物利用了。\n\n# 下载传感器和OLED屏的库文件\n\n这里的内容实际应该放到软件环境搭建里面的，可是我忘了。\n\n所以就放在这里吧。\n\nArduino的官方库里面，是没有常用传感器的库的，需要你去Git上下载。\n\n当然，我帮你下载好了。你拷贝一下就OK了。\n\nArduino的库文件可以放到两个地方。\n\n官方常用库的存放目录是：C:\\\\Program Files (x86)\\\\Arduino\\\\libraries\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-162.png)\n\n你可以把库文件的目录拷贝到这个文件夹下面。\n\n实际上，第三方库文件的存放目录，一般是下面这个：\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-163.png)\n\n也就是操作系统“文档”目录下的“Arduino”目录下的” libraries”目录。\n\n因为我安装的是克隆版的盗版Win7，所以文档被放到D盘了。\n\n如果你是正版操作系统，这个文档应该在C盘下面。\n\n反正不管怎么样，你随便选一个目录，把我们用到的传感器和OLED的库，拷贝进去，然后重启Arduino就可以了。\n\n其实你也可以在Arduino的库管理器里面在线更新：（这个功能没有被屏蔽掉）\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-164.png)\n\n搜一下模块或者芯片的名字，基本都能找到现成的库，而且还不止一个，让你不知道用哪个好。\n\n不过毕竟乱，我还是建议去Git里面搜，然后手工下载安装。\n\n在GIT里面，有个adafruit的元件库，里面有3400多个元件库，我想你很难找不到你要的库了……\n\n[https://github.com/search?utf8=%E2%9C%93&q=adafruit&type](https://github.com/search?utf8=%E2%9C%93&q=adafruit&type)\\=\n\n而且这个adafruit的库，里面的底层代码写的都比较规范，我喜欢手工下载它的库，不想用其它人的库了。\n\n有人可能不会在GIT里面下载东西，其实很简单。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-165.png)\n\n看到绿色的按钮了吗？点开，点Download ZIP 就可以下载库的压缩包了。\n\n下载的压缩包，你可以用Arduino的项目---加载库---添加一个.ZIP库，添加到库里面。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-166.png)\n\n也可以把压缩包解压后，拷贝到上面说的两个库文件的目录之一下面，重启Arduino即可。\n\n说句题外话：\n\n比如我用温度传感器的库来读取温度，先包含一下库的头文件，定义一下引脚，然后新建一个传感器的类，最后几句代码就非常简单的实现了温度的读取。\n\nDS18B20的底层代码，都封装成库了，用户根本不用关心底层怎么实现的，只要看看示例，复制一下代码就可以搞定。\n\n我以前用51单片机，换个型号，底层代码的延时基本都要重新改过，并且一一测试，真是折腾死了。Arduino这种方式，简直太方便了，难怪会这么火。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-167.png)\n\n# 如何看示例\n\nArduino全部库里面基本都有示例代码。\n\n示例代码可以非常快的帮助我们学会该种库的使用。\n\n我以前常说，你不会写，你还不会抄吗？\n\n示例代码就是让我们来抄的，其实我做的这个东西，全部的代码，有一大半都是我拼凑的各种示例代码修改来的。\n\n要学Arduino，你必须知道怎么看示例。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-168.png)\n\n其他的我不多说了。\n\n如果你有心，可以把我们这个东西用到的各种模块的示例都测试一遍。\n\nArduino的代码，基本都带串口数据同步输出功能，右上角就是。 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-169.png)\n\n一直串口定义和数据打印非常方便，二是单片机资源丰富，不在乎串口哪点资源消耗。\n\n不像51单片机那样，数据基本不会同步到串口输出，因为很占单片机的资源（增加固件大小，占用计算时间，占用定时器，破坏时序啥的）。\n\n所以你可以通过串口，很轻松的看到输出的数据。当然注意程序定义的串口的波特率和你选择的波特率要一样。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-170.png)\n\n注意程序里面定义的波特率和串口监视器的波特率要一样。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-171.png)\n\n常用的波特率是9600和115200。\n\n波特率的概念请自己去百度。不同波特率之间不能通信，或者通信数据会全部错误。\n\n# 软件设计流程\n\n用Arduino自带的例子烧录过几次后，确认Esp8266的开发板可用后，我就打算修改我以前的项目，做个不用外置单片机的云传感器出来。\n\n但是我这里还有几个问题需要解决，否则还是没法完成我这个项目。\n\n1、用ESP8266模块读取DS18B20、DHT12、BMP280等传感器的数据。\n\n通过下载各种传感器的开发库，用库自带的例子逐一读取数据 ，全部成功。我要做的就是把代码拼凑起来，同时要合理分配ESP8266少的可怜的几个IO口。\n\n还要查阅ESP8266的官方文档，确定每个引脚的功能。\n\n比如IIC用的SDA和SCL引脚，ESP8266是默认GPIO4和GPIO5引脚，别的引脚不能用。\n\n2、温度、湿度、气压、PM25等数据，通过OLED显示出来。\n\n主要是美观大方，不能简单的堆叠显示数据。\n\nOLED的显示界面，我修改了好几次才满意。还加上了信号强度显示和数据上传成功次数显示。\n\nPM25的数据，想通过EPS8266的ADC引脚读取，但是PM25模块比较大，接上去不美观，放弃了，以后有需要再接。而且ADC我测试，感觉精度不高，大概有0.1V的差距，不知道问题出在哪里，以后再研究。\n\n3、简单的WIFI设置页面。\n\n我需要一个简单web页面来设置ESP8266连接WIFI的SSID和密码。\n\n还要设置上传数据的公网服务器的网址或者IP，还有它的端口。\n\n我可不想再做２个APP（一个Android的，一个IOS的）来搞定这种事情。虽然我以前做过这种APP，但是我觉得这次要让ESP8266当Web服务器来搞定它。\n\n网上和实例代码，都是在程序里面写死的，这个不符合我的要求。\n\n百度了一个日本人的例子，里面用了Flash文件读写库来保存参数，非常有抄袭的价值。\n\n本来打算用JSON代码来传递数据，他用的是Flash内存里面文件保存和读取方式来传输SSID和密码，也是没问题的，而且代码更简单。\n\n当ESP8266上电时，3秒内按一下按键，则进入了WIFI设置模式。\n\nESP会变成AP，我们可以通过手机WIFI或者笔记本的WIFI看到它。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-172.png)\n\n连上ESP的WIFI，密码是11111111，然后打开浏览器，输入192.168.4.1，则进入设置页面。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-173.png)\n\n输入WIFI的SSID，密码，还有你服务器的网址，端口，点提交就Ok了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-174.png)\n\n当然，在执行这些操作的时候，我们的云传感器的OLED也要同步显示相同的信息。\n\n照片我就不拍了。\n\n４、数据上传服务器\n\n既然是云传感器，那么数据肯定要上传到云服务器上的。\n\n以前我是用AT命令连接云服务器的，现在AT命令没法用了，要自己写代码了。\n\n这个好像更简单，Arduino自带的例子里面有实例，网上 的代码也很多，测试过以后没有问题，也搞定了。\n\n当然，对我来说简单。\n\n我们知道，HTTP协议里面，常见的两种方法：GET和POST。\n\nGET常用来发送请求（Request）。当然它也可以带参数。\n\n网页的地址常见到：[http://xxxx.com?a1=10&a2=20&a3=30](http://xxxx.com?a1=10&a2=20&a3=30)\n\n这里就是一个GET，它还带了a1,a2,a3 三个参数。\n\nWeb服务器可以解析网址，从而把a1,a2,a3 的值保存到数据库里。\n\n这种也是最简单的HTTP的数据上传方式。\n\n但是也不保险，因为很容易就可以在网页里，通过构造网址，手工传一些错误数据进来。\n\n如果你用AT命令或者代码上传数据的话，\n\n你还要构造一个简单GET包，类似于下面：\n\n\"GET \" + url + \" HTTP/1.1\\\\r\\\\n\" +\n\n\"Host: \" + host + \"\\\\r\\\\n\" +\n\n\"User-Agent: BuildFailureDetectorESP8266\\\\r\\\\n\" +\n\n\"Connection: close\\\\r\\\\n\\\\r\\\\n\"\n\n具体的去百度吧，东西太多，没法讲。\n\n这里User-Agent可以省略掉，不加也不影响服务器端的数据解析。\n\n除了GET外，我们还可以构造POST包。\n\nPOST和GET的区别在于POST可以传输大量的数据，GET的传输的数据大小是有限制滴。\n\nPOST的网址后面也可以跟参数，还要跟一个data包。\n\n然后Web服务器是数据解析方式也略有区别。\n\n总体而言，GET简单，POST复杂点，GET不安全，POST安全点。\n\n后面我会专门为GET和POST做个章节。这种东西，玩WIFI不能不掌握啊。\n\n5、建立一个云网址\n\n我需要一个云服务器来保存我的数据。还需要一个小网址来展示我的数据。\n\n实际上这些内容很多，我放到后面来说。\n\n当然，你也可以使用网上那些免费的云数据库，不过需要注册一个用户名，还要输入一个复杂的IDKey啥的，还要研究人家的数据上传协议。\n\n我最讨厌约束，我想要有自己的云服务器，自己的协议，最简单的那种。\n\n首先我要做一个小网站，这个网站的功能很简单，要解析云传感器发来的数据，并且保存到数据库里面。还能根据时间查询数据，数据要能下载为Excel文档，最好还要带一张酷炫点的曲线图表。\n\n两种方案：1、Linux系统，MySQL5.7数据库，Java或者PHP编程或者Python啥的， Nginx或者Apache代理。\n\n2、Windows2008系统，SqlServer2008数据库，.Net V4.0环境，IIS7.5代理啥的。\n\n随便选一种吧，小网站，几个页面而已。我不想开虚拟机，所以果断方案2。\n\n先下载安装一个VS2012，再安装一个SQLServer2008数据库，建一张简单的表。\n\n你说你不会用数据库，也不建表？也看不懂表结构？\n\n这里我不想多讲欸，跳过吧，后面我们用脚本建库就好了。哎，写到这里，我明显开始偷懒了。\n\nVS2012做一个简单查询，图表之类的，用百度的开源图表Echarts。\n\n[http://echarts.baidu.com/](http://echarts.baidu.com/)\n\n不知道的可以去看看，做的不错，现在国内网站的图表，基本都是这个，很赞。\n\n我们只要折线图，所以下载一个最小版本就可以了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-175.png)\n\n然后找个有类似图表的网站，查看网页源代码后，公然进行抄袭。\n\n数据大家都是用Ajax进行传输，前台的代码基本一样，改改文字就行了。\n\n它好像用的是Java，我用的.Net，不过没关系，后台代码我比它还简单。\n\n建立一个 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-176.png) ，专门负责从数据库里面查询数据，然后发给前台的脚本，让前台的jQuery代码填充图表。\n\n再建立一个 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-177.png) ，负责解析云传感器发来的数据，保存到SQLServer数据库里面。\n\n具体的代码就不讲了，太多太多，没法讲……后面有时间我单开教程讲吧。最后你们自己去百度，看看怎么写小网站，怎么搭建网站，怎么玩数据库，怎么写SQL……\n\n可是大部分人都不想学这些，都只是想做个传感器而已……\n\n# 拥有自己的云\n\n其实我不缺公网服务器的，公司有几台闲置的公网服务器，我都可以拿来私用，但是没法给大家共享。所以，我要抛弃公司的服务器，和大家一起拥有自己的私有云。\n\n先看看国内有哪家公司比较厚道，会给我们一个自己的云呢？\n\n有钱鹅公司的理念一直是：不充钱，你怎么能变强呢？\n\n有意思公司的理念一直是：充了钱，你也不一定能变强。\n\n找不到公司的理念一直是：花了钱，你也不一定能治好病。\n\n招财猫公司的理念一直是：花了钱，你也不一定能买到真的。\n\n综合来说，只有去招财猫公司的网站找一下了。\n\n首先，我们要购买一个自己的域名。域名最好也是免费的。\n\n其次，我们要找一个免费的或者非常便宜的云服务器。\n\n1、申请自己云服务器的域名。\n\n先来到招财猫公司的网站：\n\n[https://www.aliyun.com/](https://www.aliyun.com/)\n\n随便注册一个用户名和密码，或者用你的招财猫账号和密码登录。\n\n然后来到域名注册的地方\n\n[https://wanwang.aliyun.com/domain/searchresult/?keyword=fsdfds&suffix=.top](https://wanwang.aliyun.com/domain/searchresult/?keyword=fsdfds&suffix=.top)\n\n找一下 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-178.png) 这种域名。\n\n当然，com域名你是别想了，top和xin之类的还凑合。\n\n.win是最便宜的，因为工信部到现在没法备案这种域名，所以还是换个别的吧。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-179.png)\n\n我选择了 mysensor.top\n\n也就是我的传感器，没人注册，1元拿下，哈哈。\n\n可惜还要备案。经过漫长的审核和等待，20天的样子，终于备案成功了。。。。。\n\n最坑爹的是，拍照片要购买招财猫公司的幕布，这个价格是15元，还不能退货。\n\n到手后，我发现根本不是布，只是一张有招财猫字样的海报纸。\n\n好吧，这是我买过最贵的海报了，果然你花了钱也不一定能买到真的……\n\n所谓的1元域名，最后要花16元……\n\n其他的基本就没花钱了，就是从申请到域名备案完成，等了大半个月。\n\n在浙江，你的网站不仅要工信部备案，公安机关也要备案。具体方式看阿里的说明吧。\n\n大家别忘了在自己的网站下面加备案的备案号啥的。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-180.png)\n\n2、购买一个自己的云\n\n经过仔细的查找，最便宜，性能最差劲的云服务器，1年的价格也要近300块钱\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-181.png)\n\n我有300块钱干嘛不好呢？云不能吃也不能喝，装B效果也非常有限。\n\n好吧，云服务器方案取消，去买一个最便宜的网站空间吧。\n\n最后6块钱买了个假云！！\n\n申请云空间的时候，请选择 Windows2008系统，SqlServer2008数据库，IIS7.5，.net V4.0之类的环境。\n\n不要选择Linux，MySQL之类的。不过后面也能随时更换好像。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-182.png)\n\n[https://cp.aliyun.com/login](https://cp.aliyun.com/login)\n\n看到6块钱了吧。\n\n1年6块钱的云，你还想怎么样？？想要真正的云服务器？\n\n招财猫公司的理念再跟着我念一遍……\n\n[https://wanwang.aliyun.com/hosting/free?spm=0.0.0.0.xkJ5oL](https://wanwang.aliyun.com/hosting/free?spm=0.0.0.0.xkJ5oL)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-183.png)\n\n200M网页空间+20M的数据库空间+10G的月流量。\n\n我们只是存个云传感器数据而已，20M数据库空间大概够我们存20万条数据了，马马虎虎吧。\n\n200M的网页空间根本用不了，能和数据库空间互换一下就好了……\n\n在线支付6元大洋后，我们就可以拥有了自己空间。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-184.png)\n\n貌似还不错，各种环境都搭配好了，直接通过FTP把网页和数据库备份文件拷贝过去就可以了。\n\n打开我的电脑，随便打开一个文件夹。然后在上面的地址栏里面输入\n\nftp://你的FTP地址/\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-185.png)\n\n鼠标右键，选择 登录，输入用户名和密码，保存密码，省的每次都输入。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-186.png)\n\n你说你不知道你的FTP地址？？\n\n进[https://cp.aliyun.com/login](https://cp.aliyun.com/login)登录后，进入控制台页面，就可以看到你的FTP地址了。\n\n密码啥的，你自己记牢了。\n\n# 域名解析\n\n1、赶紧去备案你的域名。\n\n当然你也可以不备案，一直用临时域名。比如，我的临时域名：\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-187.png)\n\n这个域名每隔4个小时，就要重新登录一下。不过通过GET方式上传数据不受影响。\n\n2、域名解析。\n\n在[https://cp.aliyun.com](https://cp.aliyun.com)的控制台，找到域名绑定。\n\n其实这里不绑定也没啥关系应该，主要是找到你的云空间的站点地址。\n\n比如，我的站点地址是：60.205.47.232\n\n这里添加域名，把你刚才申请的域名给添加进去。\n\n要添加2个，一个带”www.”，一个不带”www.”。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-188.png)\n\n复制一下这个地址，然后去阿里云的域名解析那里，新建A记录。\n\n先进[https://www.aliyun.com/](https://www.aliyun.com/)\n\n然后登录你注册域名的账户。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-189.png)\n\n登录后，点一下上面的控制台。选择左边的“域名与网站（万网）”，进入“域名”\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-190.png)\n\n找到你的域名，然后点“解析”，进入域名解析。哎，我都不想写了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-191.png)\n\n这里对于新手来说，可以点一下新手引导设置啥的，或者直接加A记录。\n\n所谓的A就是Adress，也就是地址的意思。\n\n把刚才我们6块钱云空间的IP地址，复制进去。类似于我下面的图。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-192.png)\n\n说个常识，域名是不带“www.”这个4个字符的。\n\n比如我申请的域名是mysensor.top\n\n而不是[www.mysensor.top](http://www.mysensor.top)。\n\n当然，你用上面2个都能访问我的网站。\n\n因为我A记录里面，www和@我都添加过。否则你只能访问其中一个。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-193.png)\n\n你要填加2个A记录，主机记录分边是@和www\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-194.png)\n\n好了，绑定好以后，你应该在几分钟后就能通过域名访问你的云了。\n\n但是几个小时后，这个就会失效，因为你得备案。给你几个小时，只是让你验证一下域名解析是否好用而已。\n\n备案请自己完成，比较繁琐。当然你也可以不备案，只用临时域名。\n\n# 配置自己的云\n\n域名都配置好了，我们的云空间也要把网站搭建起来。\n\n1、配置数据库\n\n网站需要接入SQLServer2008数据库。\n\n为了简单易用，数据库里面只有1张表，tbl\\_Data\n\n进入我们的云主机控制台，[https://cp.aliyun.com](https://cp.aliyun.com)\n\n选择“数据库信息”\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-195.png)\n\n最右边有个“管理”，进入数据库管理网页，著名的DMS。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-196.png)\n\n数据库名字，后面有个：1433，表示端口号。\n\n1433是SQLServer的默认端口，这里应该不用你做任何更改。\n\n你输入用户名和密码就可以了。\n\n先打开建表的SQL脚本文件， ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-197.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-198.png)\n\n先把USE \\[xxxxxx\\] 里面的xxxxx改成你的数据库的名字\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-199.png)\n\n也就是你的数据库的用户名后面加\\_db\n\n然后点一下 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-200.png)\n\n把脚本复制到下面的空白处，\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-201.png)\n\n执行完成后，左边的数据库下面，就应该有1张表了，名字是tbl\\_Data\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-202.png)\n\n我截图里面有4张，是其他的测试库，这些都不用管。\n\n表名字前的dbo表示的是表的拥有者是数据库的普通用户。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-203.png)\n\n表tbl\\_Data就是我们的云传感器的数据表。\n\n里面有7个字段，Id是流水号，也是主键。类型是int，也就是整数的意思。\n\n这个Id的数值是自动增长的，是标志种子。\n\nEspId是Esp8266模块的Mac地址，类型是可变字符，最多16个字符。\n\nTemp是存放温度数据的字段，依然用可变字符类型存储，最多10个字符。\n\nHumi是湿度，Pressure是气压，PM25就是PM2.5的数据，UpTime是上传时间，这个字段是依靠默认值getdate()，直接从数据库获取的，不需要自己填写。\n\n数据库的种类非常多，常见的就是10几种吧。所以你有兴趣可以全部掌握。而且很多知识都是相通的。\n\n最后要做的事情，就是修改网站配置文件里面数据库的信息。打开网页的目录，里面有个 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-204.png) ，用记事本打开。\n\n里面有一段配置，你需要自己修改。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-205.png)\n\n你要改4个地方：\n\n数据库的地址： ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-206.png)\n\n把=后面的地址，改成你自己的。你的地址，在云空间的控制台哪里可以找到。\n\n记得后面有个；，不要给删掉了。\n\n数据库的名字： ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-207.png)\n\n\\=后面就是数据库的名字，刚才我们说了半天了。\n\n数据库的用户名： ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-208.png)\n\n数据库的密码： ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-209.png)\n\n把这些都修改好后，保存文本文件。\n\n2、拷贝网站到云空间\n\n把网页目录里面的东西，全部通过FTP，拷贝到你云空间下面。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-210.png)\n\n我的FTP下面的文件非常多，很多其他的网页，我就不截全图了。\n\n其他的一些设置，可以看看.net版本啥的，是不是4.0。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-211.png)\n\n最后浏览器里面输入你的临时域名，看看能不能打开网站。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-212.png)\n\n如果遇到上面的页面，输入FTP的用户名和FTP密码，4个小时内有效。\n\n如果能看到下面的页面，就表示OK了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-213.png)\n\n当然，你如果没有备案啥的，下面的备案号之类的，你可以打开文件删掉。\n\n也就是DataList.aspx文件里面，最下面的地方。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-214.png)\n\n对了，别忘了你的云传感器，重新上电启动，启动的时候，按一下按键进入WIFI配置。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-215.png)\n\nHost里面请填入你的临时域名。Port是80。\n\n最后提交后，重启你的云传感器。\n\n然后打开你的云网站，点一下开始查询。 ![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-216.png)\n\n如果有数据，那么恭喜你，你终于成功了。。。。。。\n\n万里长征基本完成了。\n\n因为我们的云只有20M的数据库空间，所以我只会保留最后20万条数据。其他的记录，都会自动删除。\n\n可以用数据库的触发器删除，也可以加在网站的源代码里面。\n\n为了方便大家，我还是加到源代码里面。基本的思路，就是每上传10000条记录，则调用SQL删除多余的数据。\n\n这个教程是我2年多来，写的最累，也是最长的教程。\n\n其实是个很简单的东西，ESP8266连WIFI，往云上传东西嘛。\n\n教程写了这么多，还有很多的知识，都是一笔带过。可是我已经没法再详细了……\n\n大家能学到的知识依然很少，走马观花的看看而已。\n\n浅雪 2017年8月5日星期六\n\n# GET和POST简介\n\n这里我简单说一下GET和POST的包结构。详细的说明你们自己去百度。\n\n一个标准的GET包，基本就是下面这个样子的。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-217.png)\n\n必须以GET开头，你不要写成Get、get之类的，大小写需要统一，不要自找麻烦。\n\n因为根据相关规定，HTTP的方法，也就是GET、POST之类的是区分大小写。\n\n剩下的那些Header，比如Accept、HOST、Connection之类的包括网站的地址啥的，都是不区分大小写的。\n\nGET后面跟着的是相对地址和参数。\n\n相对地址不说了，应该能看明白，就是网址的子目录或者其它文档。\n\n参数这里详细说一下。\n\nGET的作用，就是从服务器获取某些东西的意思。\n\n你要获取哪些东西，是可以自己通过参数来制定的。\n\n举个例子：GET /xxxx.html?stuid=abc&name=张三&class=一年级 HTTP/1.1\n\n这里有3个参数，stuid，name，class，他们之间通过&符号分隔开。\n\n第一个参数和相对地址之间，通过？分隔。\n\n参数名称和参数值之间，通过=分隔。\n\nHTTP/1.1和前面的参数，通过空格 来分割。\n\n另外，GET后面的那堆东西，不是全部必须的，但是有些是不能省略的。比如我红线标出来的这些。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-218.png)\n\nGET肯定是不能省略的，GET后面的参数也可以不要，但是 /必须要一个，这个是你要GET的路径。比如GET / HTTP/1.1，表示你要GET根目录下的默认文档。\n\nHTTP/1.1是绝对不能省略的，它告诉服务器你们之间打算用HTTP/1.1通信协议。\n\nHost也是绝对不能省略的，它是GET的对象的网址。这个也可以是一个IP地址。\n\nConnection加不加都行，它的状态常用的有Close和Keep-Alive，也就是每次通信后，是否关闭连接或者保持连接。如果你不加，就让服务器自己看着办。\n\n这里说个题外话，GET包的每行后面其实都有2个看不见的符号：/r/n ，也就是回车+换行。服务器也是根据/r/n来分隔每行的。\n\nPOST包的结构和GET基本相似\n\n只不过把GET换成了POST，还多了2个东西：一个是Content-Length，这个是要发送的数据的字节长度。还一个就是要发送的数据，当然数据也可以不要。\n\n你要发送的数据，可以是文本，也可以是文件、图片、视频啥的。\n\n对于POST包来说，安全性比GET包更高一点。\n\n你可以在网页上用手工构造一个GET包，但是你很难构造一个POST包。\n\n我喜欢用GET，后面带一些参数，来上传数据。因为GET包比较简单。\n\n当然，你也可以用POST，后面带一些参数来上传数据，基本和GET一样简单。\n\n但是，最后还是把数据放到POST的数据包里。\n\n数据包里面，你可以把你的数据，自由的组合。你可以用数据１,数据2,数据3……\n\n之类的方式，通过逗号来做分割符，服务器收到包后，把包转为字符串，然后在分割字符串。也可以通过JSON来处理，或者XML来处理。\n\nJSON和XML不知道的，都自己去百度。服务器端要处理JSON或者XML数据，都要安装对应的插件，简单的数据，你也可以挑战自己的通过文本处理来解析，哈哈。\n\n如果你以后用ESP8266模块做服务器处理JSON数据，那么尽量要使用ESP8266JSON之类的第三方库才行。\n\n# GET和POST实例\n\n说了那么多，不给例子的都是耍流氓。\n\n我平常看学习文档，最恨那种没例子的，新手根本不知道怎么入门。\n\n鉴于我们是使用ESP8266模块进行开发的，我这里用ESP8266模块自带的AT命令来给出例子。\n\n如果你的ESP8266模块自己烧录了Arduino代码，那么里面的AT命令固件就被你覆盖掉了，所以你最好使用原装的模块，里面默认的固件都是AT命令固件。\n\n这里最好使用转接板，要不USB转TTL烧录器，不太好接到ESP8266上去。\n\n或者你花钱买那种转接板上自带ch340芯片的转接板，这样连烧录器都省掉了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-219.png)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-220.png)\n\n[https://item.taobao.com/item.htm?spm=a1z0d.6639537.1997196601.33.7be0196r5S7P0&id=531515702108](https://item.taobao.com/item.htm?spm=a1z0d.6639537.1997196601.33.7be0196r5S7P0&id=531515702108)\n\n这个玩意的正面带一个esp8266模块，反面就是ch340芯片和稳压芯片，还带一个烧录开关，反正做的挺全面的。\n\n比那种5毛钱一个的单独转接板，要方便一点。不过我手头上很多esp8266模块了，还有好多烧录器，我也懒的买这种，不花冤枉钱。我用的是下面这种，就接4根线：3.3V，GND，RX，TX。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-221.png)\n\n如果你打算买这种模块，最好买两个。一个用来做Arduino开发，一个用来测试AT命令。要不你烧录了Arduino的固件，里面有AT命令的固件就没了。当然你也可以重新从官方下载带AT的固件烧回去，不过就很麻烦了。\n\n可能有人不懂啥叫AT命令，其实很简单，你也可以去百度一下：\n\nAT命令就是用标准串口来收发的指令集。它以”AT”开头，+命令，/r/n（回车换行符）结束。\n\n这样，对设备的控制就大大简化了，转换成简单的串口数据通信了。\n\n还很多设备都支持AT命令，不单单是ESP8266。比如常见的蓝牙串口模块。\n\n当然，它们的指令都是AT开头，回车换行符结尾而已，中间的命令基本都不一样。\n\n为了配合GET和POST的测试，我还要往我的云里面加一个测试页面，让大家更方便的测试。\n\n首先呢，我先在VS2012里面新建一个没有显示页面的文档： test.ashx\n\n然后里面判断一下请求的类型，再读取2个简单参数：id和name\n\n如果请求是POST，那么再读取一下POST的data数据，把它转成字符串显示。\n\n先用浏览器测试一下GET方式。\n\n打开浏览器，在地址栏输入：mysensor.top/test.ashx\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-222.png)\n\n再输入2个参数：\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-223.png)\n\n为啥不加GET、HTTP/1.1和HOST之类的东西了呢，因为浏览器发送GET包的时候，会自动帮你补全的，你加了反而不对了。我们自己发包的时候，就要加这些东西了。\n\n如果是POST怎么测试呢？找个在线测试工具\n\n[http://www.sojson.com/httpRequest/](http://www.sojson.com/httpRequest/)\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-224.png)\n\n再看看返回值\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-225.png)\n\n这可以看到，在线POST测试工具，把参数也给当data发出来了。其实，data里面的东西和参数是互不干扰的。\n\n下面我们用ESP8266模块+烧录器，通过AT命令和串口，来测试GET和POST。\n\n首先你要准备一个USB转TTL的烧录器，推荐8块钱的那款，输出电流较大。\n\n然后准备一个ESP8266模块，最好带转接板，杜邦针焊好。\n\n接线方式很简单，不会的可以翻到上面“搭建ESP8266的最小环境”那里去看看。\n\n这里我们要用到一个工具，串口助手。其实这个玩意并不好，只不过人都懒，能用就可以。不过这个小工具，虽然有各种小bug，也算是超值了，全国都在用。后来作者也更新了新版本，对应的功能和广告也更多了，我下载了但是也懒得去用新版本的。\n\n把烧录器插到电脑上，驱动程序安装好，就可以打开串口助手了。\n\n选择一下串口，ESP8266-12E模块的波特率默认是115200。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-226.png)\n\n发送新行一定要打勾。\n\n我前面说了，AT命令是以换行符来判断命令的结束的。\n\nESP8266的AT命令手册里面，有详细和全面的AT命令，这里我就不多说了。\n\n我只说我们用到的几个。\n\n首先看看你的ESP8266模块是否能正常工作。\n\n输入：AT\n\n然后点发送。\n\n注意，命令后面不要有空格，否则会返回Error。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-227.png)\n\n如果你能收到ESP8266的回应，说明你们模块正常工作，可以进行下一步的操作。\n\n依次输入以下AT命令：\n\nAT+CWMODE=1\n\n这个命令是把ESP模块设置为Station模式，也就是客户端模式。\n\nAT+CWJAP=\"SSID\",\"password\"\n\n输入你家的WiFi的SSID和密码，让ESP8266模块能连上WIFI。\n\n上面这2条命令，输一遍就可以了，它能够自动保存。\n\n当连上WIFI后，你可以发送AT+CIFSR 来看看是否真的连上WIFI了。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-228.png)\n\n当基本的设置完成后，我们就可以创建一个TCP的客户端，去发送GET命令了。\n\n有人问，为啥要创建一个TCP的客户端啊\n\n原因很简单，GET和POST只是网络封包的类型，你只有在客户端里面才能把它们发送到服务器端。\n\n我们上面可以通过网页直接写GET，但是ESP8266模块里面，可放不下浏览器，只能自己构造包来发送。\n\n依次输入\n\nAT+CIPSTART=\"TCP\",\"mysensor.top\",80\n\n和服务器建立TCP连接，服务器地址：mysensor.top，端口：80。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-229.png)\n\nAT+CIPMODE=1\n\n设置透传模式\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-230.png)\n\nAT+CIPSEND\n\n开始发送数据\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-231.png)\n\n当你看到>符号的时候，就表示可以往服务器发送GET或者POST包啦。\n\n先发一个GET包\n\nGET /test.ashx?id=123456&name=xiaowang HTTP/1.1\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-232.png)\n\n点了发送，可是没收到返回数据。\n\n没收到数据就是对的，应为你的包还没发完呢，继续发。\n\nHost:mysensor.top\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-233.png)\n\n好了，一个最简单的GET包已经发好了。\n\n可是告诉服务器我不发了，结束了，你可以给我返回数据了呢？\n\n很简单，再发一个换行符就可以啦。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-234.png)\n\n下面不要放任何东西，直接发送一个换行符。\n\n看看我们收到的数据。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-235.png)\n\n比用浏览器发GET，多了一大堆东西。浏览器会帮你过滤掉这些没用的东西，而直接给你显示数据。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-236.png)\n\n发一个GET封包是不是很简单呢？\n\n难者不会，会者不难。\n\n我们再继续测试发POST包。\n\n把刚才的GET包，稍微改一下。\n\n我们先不发data，只发id和name两个参数看看。\n\nPOST /test.ashx?id=123456&name=xiaowang HTTP/1.1\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-237.png)\n\nHost:mysensor.top\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-238.png)\n\n因为对于POST包，数据长度必须要有，也就是data，因为我们这次不发data，所以长度为0。\n\nContent-Length:0\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-239.png)\n\n再发一条空指令，表示发包结束。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-240.png)\n\n再看看我们收到的数据。和GET基本一样。\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-241.png)\n\n现在我们把data加上，再看看结果。注意我的发送顺序。\n\nPOST /test.ashx?id=123456&name=xiaowang HTTP/1.1\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-242.png)\n\nHost:mysensor.top\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-243.png)\n\nContent-Length:10\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-244.png)\n\n发送一条空语句\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-245.png)\n\n发送我们的data\n\n1234567890\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-246.png)\n\n发送完data后，会立刻收到服务器发来的数据：\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-247.png)\n\n在这里，我们可以看到，data数据和参数id、name，并没有混到一起。\n\n如果我不想让别人看到我的id和name，我完全可以把id和name放到data里面发送。\n\n比如下面这样：\n\nPOST /test.ashx HTTP/1.1\n\nHost:mysensor.top\n\nContent-Length:15\n\n发送新行\n\n123456,xiaowang\n\n![](http://www.whrblog.online/wp-content/uploads/2018/02/word-image-248.png)\n\n这样，id和name就被塞到data里面发送了。别人看不到你的数据，也不知道你的数据格式，安全性就提高了。\n\n而且data里面不仅可以放字符串，还能放图片，放文件，放很多东西……\n\n在我的Arduino代码里，我是用GET来传输数据给服务器的，因为这样做简单。\n\n我也可以改成POST的，毕竟网上POST的例子不多。在Arduino里，需要自己建一个client，去连服务器。然后往client里面丢封包，和AT命令其实也差不多。\n\n我看到一些免费的物联网，他们的POST协议，最后的data，是要组合成JSON的格式来存放数据的，都是一样的道理。","tags":["浅雪的DIY"],"categories":["uncategorized"]}]